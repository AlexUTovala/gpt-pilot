Module(body=[Import(names=[alias(name='contextlib')]), Import(names=[alias(name='ssl')]), Import(names=[alias(name='typing')]), ImportFrom(module='ctypes', names=[alias(name='WinDLL')], level=0), ImportFrom(module='ctypes', names=[alias(name='WinError')], level=0), ImportFrom(module='ctypes', names=[alias(name='POINTER'), alias(name='Structure'), alias(name='c_char_p'), alias(name='c_ulong'), alias(name='c_void_p'), alias(name='c_wchar_p'), alias(name='cast'), alias(name='create_unicode_buffer'), alias(name='pointer'), alias(name='sizeof')], level=0), ImportFrom(module='ctypes.wintypes', names=[alias(name='BOOL'), alias(name='DWORD'), alias(name='HANDLE'), alias(name='LONG'), alias(name='LPCSTR'), alias(name='LPCVOID'), alias(name='LPCWSTR'), alias(name='LPFILETIME'), alias(name='LPSTR'), alias(name='LPWSTR')], level=0), ImportFrom(module='typing', names=[alias(name='TYPE_CHECKING'), alias(name='Any')], level=0), ImportFrom(module='_ssl_constants', names=[alias(name='_set_ssl_context_verify_mode')], level=1), Assign(targets=[Name(id='HCERTCHAINENGINE', ctx=Store())], value=Name(id='HANDLE', ctx=Load())), Assign(targets=[Name(id='HCERTSTORE', ctx=Store())], value=Name(id='HANDLE', ctx=Load())), Assign(targets=[Name(id='HCRYPTPROV_LEGACY', ctx=Store())], value=Name(id='HANDLE', ctx=Load())), ClassDef(name='CERT_CONTEXT', bases=[Name(id='Structure', ctx=Load())], keywords=[], body=[Assign(targets=[Name(id='_fields_', ctx=Store())], value=Tuple(elts=[Tuple(elts=[Constant(value='dwCertEncodingType'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='pbCertEncoded'), Name(id='c_void_p', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='cbCertEncoded'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='pCertInfo'), Name(id='c_void_p', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='hCertStore'), Name(id='HCERTSTORE', ctx=Load())], ctx=Load())], ctx=Load()))], decorator_list=[]), Assign(targets=[Name(id='PCERT_CONTEXT', ctx=Store())], value=Call(func=Name(id='POINTER', ctx=Load()), args=[Name(id='CERT_CONTEXT', ctx=Load())], keywords=[])), Assign(targets=[Name(id='PCCERT_CONTEXT', ctx=Store())], value=Call(func=Name(id='POINTER', ctx=Load()), args=[Name(id='PCERT_CONTEXT', ctx=Load())], keywords=[])), ClassDef(name='CERT_ENHKEY_USAGE', bases=[Name(id='Structure', ctx=Load())], keywords=[], body=[Assign(targets=[Name(id='_fields_', ctx=Store())], value=Tuple(elts=[Tuple(elts=[Constant(value='cUsageIdentifier'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='rgpszUsageIdentifier'), Call(func=Name(id='POINTER', ctx=Load()), args=[Name(id='LPSTR', ctx=Load())], keywords=[])], ctx=Load())], ctx=Load()))], decorator_list=[]), Assign(targets=[Name(id='PCERT_ENHKEY_USAGE', ctx=Store())], value=Call(func=Name(id='POINTER', ctx=Load()), args=[Name(id='CERT_ENHKEY_USAGE', ctx=Load())], keywords=[])), ClassDef(name='CERT_USAGE_MATCH', bases=[Name(id='Structure', ctx=Load())], keywords=[], body=[Assign(targets=[Name(id='_fields_', ctx=Store())], value=Tuple(elts=[Tuple(elts=[Constant(value='dwType'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='Usage'), Name(id='CERT_ENHKEY_USAGE', ctx=Load())], ctx=Load())], ctx=Load()))], decorator_list=[]), ClassDef(name='CERT_CHAIN_PARA', bases=[Name(id='Structure', ctx=Load())], keywords=[], body=[Assign(targets=[Name(id='_fields_', ctx=Store())], value=Tuple(elts=[Tuple(elts=[Constant(value='cbSize'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='RequestedUsage'), Name(id='CERT_USAGE_MATCH', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='RequestedIssuancePolicy'), Name(id='CERT_USAGE_MATCH', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='dwUrlRetrievalTimeout'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='fCheckRevocationFreshnessTime'), Name(id='BOOL', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='dwRevocationFreshnessTime'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='pftCacheResync'), Name(id='LPFILETIME', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='pStrongSignPara'), Name(id='c_void_p', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='dwStrongSignFlags'), Name(id='DWORD', ctx=Load())], ctx=Load())], ctx=Load()))], decorator_list=[]), If(test=Name(id='TYPE_CHECKING', ctx=Load()), body=[Assign(targets=[Name(id='PCERT_CHAIN_PARA', ctx=Store())], value=Subscript(value=Name(id='pointer', ctx=Load()), slice=Name(id='CERT_CHAIN_PARA', ctx=Load()), ctx=Load()))], orelse=[Assign(targets=[Name(id='PCERT_CHAIN_PARA', ctx=Store())], value=Call(func=Name(id='POINTER', ctx=Load()), args=[Name(id='CERT_CHAIN_PARA', ctx=Load())], keywords=[]))]), ClassDef(name='CERT_TRUST_STATUS', bases=[Name(id='Structure', ctx=Load())], keywords=[], body=[Assign(targets=[Name(id='_fields_', ctx=Store())], value=Tuple(elts=[Tuple(elts=[Constant(value='dwErrorStatus'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='dwInfoStatus'), Name(id='DWORD', ctx=Load())], ctx=Load())], ctx=Load()))], decorator_list=[]), ClassDef(name='CERT_CHAIN_ELEMENT', bases=[Name(id='Structure', ctx=Load())], keywords=[], body=[Assign(targets=[Name(id='_fields_', ctx=Store())], value=Tuple(elts=[Tuple(elts=[Constant(value='cbSize'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='pCertContext'), Name(id='PCERT_CONTEXT', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='TrustStatus'), Name(id='CERT_TRUST_STATUS', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='pRevocationInfo'), Name(id='c_void_p', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='pIssuanceUsage'), Name(id='PCERT_ENHKEY_USAGE', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='pApplicationUsage'), Name(id='PCERT_ENHKEY_USAGE', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='pwszExtendedErrorInfo'), Name(id='LPCWSTR', ctx=Load())], ctx=Load())], ctx=Load()))], decorator_list=[]), Assign(targets=[Name(id='PCERT_CHAIN_ELEMENT', ctx=Store())], value=Call(func=Name(id='POINTER', ctx=Load()), args=[Name(id='CERT_CHAIN_ELEMENT', ctx=Load())], keywords=[])), ClassDef(name='CERT_SIMPLE_CHAIN', bases=[Name(id='Structure', ctx=Load())], keywords=[], body=[Assign(targets=[Name(id='_fields_', ctx=Store())], value=Tuple(elts=[Tuple(elts=[Constant(value='cbSize'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='TrustStatus'), Name(id='CERT_TRUST_STATUS', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='cElement'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='rgpElement'), Call(func=Name(id='POINTER', ctx=Load()), args=[Name(id='PCERT_CHAIN_ELEMENT', ctx=Load())], keywords=[])], ctx=Load()), Tuple(elts=[Constant(value='pTrustListInfo'), Name(id='c_void_p', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='fHasRevocationFreshnessTime'), Name(id='BOOL', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='dwRevocationFreshnessTime'), Name(id='DWORD', ctx=Load())], ctx=Load())], ctx=Load()))], decorator_list=[]), Assign(targets=[Name(id='PCERT_SIMPLE_CHAIN', ctx=Store())], value=Call(func=Name(id='POINTER', ctx=Load()), args=[Name(id='CERT_SIMPLE_CHAIN', ctx=Load())], keywords=[])), ClassDef(name='CERT_CHAIN_CONTEXT', bases=[Name(id='Structure', ctx=Load())], keywords=[], body=[Assign(targets=[Name(id='_fields_', ctx=Store())], value=Tuple(elts=[Tuple(elts=[Constant(value='cbSize'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='TrustStatus'), Name(id='CERT_TRUST_STATUS', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='cChain'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='rgpChain'), Call(func=Name(id='POINTER', ctx=Load()), args=[Name(id='PCERT_SIMPLE_CHAIN', ctx=Load())], keywords=[])], ctx=Load()), Tuple(elts=[Constant(value='cLowerQualityChainContext'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='rgpLowerQualityChainContext'), Name(id='c_void_p', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='fHasRevocationFreshnessTime'), Name(id='BOOL', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='dwRevocationFreshnessTime'), Name(id='DWORD', ctx=Load())], ctx=Load())], ctx=Load()))], decorator_list=[]), Assign(targets=[Name(id='PCERT_CHAIN_CONTEXT', ctx=Store())], value=Call(func=Name(id='POINTER', ctx=Load()), args=[Name(id='CERT_CHAIN_CONTEXT', ctx=Load())], keywords=[])), Assign(targets=[Name(id='PCCERT_CHAIN_CONTEXT', ctx=Store())], value=Call(func=Name(id='POINTER', ctx=Load()), args=[Name(id='PCERT_CHAIN_CONTEXT', ctx=Load())], keywords=[])), ClassDef(name='SSL_EXTRA_CERT_CHAIN_POLICY_PARA', bases=[Name(id='Structure', ctx=Load())], keywords=[], body=[Assign(targets=[Name(id='_fields_', ctx=Store())], value=Tuple(elts=[Tuple(elts=[Constant(value='cbSize'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='dwAuthType'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='fdwChecks'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='pwszServerName'), Name(id='LPCWSTR', ctx=Load())], ctx=Load())], ctx=Load()))], decorator_list=[]), ClassDef(name='CERT_CHAIN_POLICY_PARA', bases=[Name(id='Structure', ctx=Load())], keywords=[], body=[Assign(targets=[Name(id='_fields_', ctx=Store())], value=Tuple(elts=[Tuple(elts=[Constant(value='cbSize'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='dwFlags'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='pvExtraPolicyPara'), Name(id='c_void_p', ctx=Load())], ctx=Load())], ctx=Load()))], decorator_list=[]), Assign(targets=[Name(id='PCERT_CHAIN_POLICY_PARA', ctx=Store())], value=Call(func=Name(id='POINTER', ctx=Load()), args=[Name(id='CERT_CHAIN_POLICY_PARA', ctx=Load())], keywords=[])), ClassDef(name='CERT_CHAIN_POLICY_STATUS', bases=[Name(id='Structure', ctx=Load())], keywords=[], body=[Assign(targets=[Name(id='_fields_', ctx=Store())], value=Tuple(elts=[Tuple(elts=[Constant(value='cbSize'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='dwError'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='lChainIndex'), Name(id='LONG', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='lElementIndex'), Name(id='LONG', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='pvExtraPolicyStatus'), Name(id='c_void_p', ctx=Load())], ctx=Load())], ctx=Load()))], decorator_list=[]), Assign(targets=[Name(id='PCERT_CHAIN_POLICY_STATUS', ctx=Store())], value=Call(func=Name(id='POINTER', ctx=Load()), args=[Name(id='CERT_CHAIN_POLICY_STATUS', ctx=Load())], keywords=[])), ClassDef(name='CERT_CHAIN_ENGINE_CONFIG', bases=[Name(id='Structure', ctx=Load())], keywords=[], body=[Assign(targets=[Name(id='_fields_', ctx=Store())], value=Tuple(elts=[Tuple(elts=[Constant(value='cbSize'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='hRestrictedRoot'), Name(id='HCERTSTORE', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='hRestrictedTrust'), Name(id='HCERTSTORE', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='hRestrictedOther'), Name(id='HCERTSTORE', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='cAdditionalStore'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='rghAdditionalStore'), Name(id='c_void_p', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='dwFlags'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='dwUrlRetrievalTimeout'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='MaximumCachedCertificates'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='CycleDetectionModulus'), Name(id='DWORD', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='hExclusiveRoot'), Name(id='HCERTSTORE', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='hExclusiveTrustedPeople'), Name(id='HCERTSTORE', ctx=Load())], ctx=Load()), Tuple(elts=[Constant(value='dwExclusiveFlags'), Name(id='DWORD', ctx=Load())], ctx=Load())], ctx=Load()))], decorator_list=[]), Assign(targets=[Name(id='PCERT_CHAIN_ENGINE_CONFIG', ctx=Store())], value=Call(func=Name(id='POINTER', ctx=Load()), args=[Name(id='CERT_CHAIN_ENGINE_CONFIG', ctx=Load())], keywords=[])), Assign(targets=[Name(id='PHCERTCHAINENGINE', ctx=Store())], value=Call(func=Name(id='POINTER', ctx=Load()), args=[Name(id='HCERTCHAINENGINE', ctx=Load())], keywords=[])), Assign(targets=[Name(id='X509_ASN_ENCODING', ctx=Store())], value=Constant(value=1)), Assign(targets=[Name(id='PKCS_7_ASN_ENCODING', ctx=Store())], value=Constant(value=65536)), Assign(targets=[Name(id='CERT_STORE_PROV_MEMORY', ctx=Store())], value=Constant(value=b'Memory')), Assign(targets=[Name(id='CERT_STORE_ADD_USE_EXISTING', ctx=Store())], value=Constant(value=2)), Assign(targets=[Name(id='USAGE_MATCH_TYPE_OR', ctx=Store())], value=Constant(value=1)), Assign(targets=[Name(id='OID_PKIX_KP_SERVER_AUTH', ctx=Store())], value=Call(func=Name(id='c_char_p', ctx=Load()), args=[Constant(value=b'1.3.6.1.5.5.7.3.1')], keywords=[])), Assign(targets=[Name(id='CERT_CHAIN_REVOCATION_CHECK_END_CERT', ctx=Store())], value=Constant(value=268435456)), Assign(targets=[Name(id='CERT_CHAIN_REVOCATION_CHECK_CHAIN', ctx=Store())], value=Constant(value=536870912)), Assign(targets=[Name(id='CERT_CHAIN_POLICY_IGNORE_ALL_NOT_TIME_VALID_FLAGS', ctx=Store())], value=Constant(value=7)), Assign(targets=[Name(id='CERT_CHAIN_POLICY_IGNORE_INVALID_BASIC_CONSTRAINTS_FLAG', ctx=Store())], value=Constant(value=8)), Assign(targets=[Name(id='CERT_CHAIN_POLICY_ALLOW_UNKNOWN_CA_FLAG', ctx=Store())], value=Constant(value=16)), Assign(targets=[Name(id='CERT_CHAIN_POLICY_IGNORE_INVALID_NAME_FLAG', ctx=Store())], value=Constant(value=64)), Assign(targets=[Name(id='CERT_CHAIN_POLICY_IGNORE_WRONG_USAGE_FLAG', ctx=Store())], value=Constant(value=32)), Assign(targets=[Name(id='CERT_CHAIN_POLICY_IGNORE_INVALID_POLICY_FLAG', ctx=Store())], value=Constant(value=128)), Assign(targets=[Name(id='CERT_CHAIN_POLICY_IGNORE_ALL_REV_UNKNOWN_FLAGS', ctx=Store())], value=Constant(value=3840)), Assign(targets=[Name(id='CERT_CHAIN_POLICY_ALLOW_TESTROOT_FLAG', ctx=Store())], value=Constant(value=32768)), Assign(targets=[Name(id='CERT_CHAIN_POLICY_TRUST_TESTROOT_FLAG', ctx=Store())], value=Constant(value=16384)), Assign(targets=[Name(id='AUTHTYPE_SERVER', ctx=Store())], value=Constant(value=2)), Assign(targets=[Name(id='CERT_CHAIN_POLICY_SSL', ctx=Store())], value=Constant(value=4)), Assign(targets=[Name(id='FORMAT_MESSAGE_FROM_SYSTEM', ctx=Store())], value=Constant(value=4096)), Assign(targets=[Name(id='FORMAT_MESSAGE_IGNORE_INSERTS', ctx=Store())], value=Constant(value=512)), Assign(targets=[Name(id='CERT_CHAIN_POLICY_VERIFY_MODE_NONE_FLAGS', ctx=Store())], value=BinOp(left=BinOp(left=BinOp(left=BinOp(left=BinOp(left=BinOp(left=BinOp(left=BinOp(left=Name(id='CERT_CHAIN_POLICY_IGNORE_ALL_NOT_TIME_VALID_FLAGS', ctx=Load()), op=BitOr(), right=Name(id='CERT_CHAIN_POLICY_IGNORE_INVALID_BASIC_CONSTRAINTS_FLAG', ctx=Load())), op=BitOr(), right=Name(id='CERT_CHAIN_POLICY_ALLOW_UNKNOWN_CA_FLAG', ctx=Load())), op=BitOr(), right=Name(id='CERT_CHAIN_POLICY_IGNORE_INVALID_NAME_FLAG', ctx=Load())), op=BitOr(), right=Name(id='CERT_CHAIN_POLICY_IGNORE_WRONG_USAGE_FLAG', ctx=Load())), op=BitOr(), right=Name(id='CERT_CHAIN_POLICY_IGNORE_INVALID_POLICY_FLAG', ctx=Load())), op=BitOr(), right=Name(id='CERT_CHAIN_POLICY_IGNORE_ALL_REV_UNKNOWN_FLAGS', ctx=Load())), op=BitOr(), right=Name(id='CERT_CHAIN_POLICY_ALLOW_TESTROOT_FLAG', ctx=Load())), op=BitOr(), right=Name(id='CERT_CHAIN_POLICY_TRUST_TESTROOT_FLAG', ctx=Load()))), Assign(targets=[Name(id='wincrypt', ctx=Store())], value=Call(func=Name(id='WinDLL', ctx=Load()), args=[Constant(value='crypt32.dll')], keywords=[])), Assign(targets=[Name(id='kernel32', ctx=Store())], value=Call(func=Name(id='WinDLL', ctx=Load()), args=[Constant(value='kernel32.dll')], keywords=[])), FunctionDef(name='_handle_win_error', args=arguments(posonlyargs=[], args=[arg(arg='result', annotation=Name(id='bool', ctx=Load())), arg(arg='_', annotation=Name(id='Any', ctx=Load())), arg(arg='args', annotation=Name(id='Any', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[If(test=UnaryOp(op=Not(), operand=Name(id='result', ctx=Load())), body=[Raise(exc=Call(func=Name(id='WinError', ctx=Load()), args=[], keywords=[]))], orelse=[]), Return(value=Name(id='args', ctx=Load()))], decorator_list=[], returns=Name(id='Any', ctx=Load())), Assign(targets=[Name(id='CertCreateCertificateChainEngine', ctx=Store())], value=Attribute(value=Name(id='wincrypt', ctx=Load()), attr='CertCreateCertificateChainEngine', ctx=Load())), Assign(targets=[Attribute(value=Name(id='CertCreateCertificateChainEngine', ctx=Load()), attr='argtypes', ctx=Store())], value=Tuple(elts=[Name(id='PCERT_CHAIN_ENGINE_CONFIG', ctx=Load()), Name(id='PHCERTCHAINENGINE', ctx=Load())], ctx=Load())), Assign(targets=[Attribute(value=Name(id='CertCreateCertificateChainEngine', ctx=Load()), attr='errcheck', ctx=Store())], value=Name(id='_handle_win_error', ctx=Load())), Assign(targets=[Name(id='CertOpenStore', ctx=Store())], value=Attribute(value=Name(id='wincrypt', ctx=Load()), attr='CertOpenStore', ctx=Load())), Assign(targets=[Attribute(value=Name(id='CertOpenStore', ctx=Load()), attr='argtypes', ctx=Store())], value=Tuple(elts=[Name(id='LPCSTR', ctx=Load()), Name(id='DWORD', ctx=Load()), Name(id='HCRYPTPROV_LEGACY', ctx=Load()), Name(id='DWORD', ctx=Load()), Name(id='c_void_p', ctx=Load())], ctx=Load())), Assign(targets=[Attribute(value=Name(id='CertOpenStore', ctx=Load()), attr='restype', ctx=Store())], value=Name(id='HCERTSTORE', ctx=Load())), Assign(targets=[Attribute(value=Name(id='CertOpenStore', ctx=Load()), attr='errcheck', ctx=Store())], value=Name(id='_handle_win_error', ctx=Load())), Assign(targets=[Name(id='CertAddEncodedCertificateToStore', ctx=Store())], value=Attribute(value=Name(id='wincrypt', ctx=Load()), attr='CertAddEncodedCertificateToStore', ctx=Load())), Assign(targets=[Attribute(value=Name(id='CertAddEncodedCertificateToStore', ctx=Load()), attr='argtypes', ctx=Store())], value=Tuple(elts=[Name(id='HCERTSTORE', ctx=Load()), Name(id='DWORD', ctx=Load()), Name(id='c_char_p', ctx=Load()), Name(id='DWORD', ctx=Load()), Name(id='DWORD', ctx=Load()), Name(id='PCCERT_CONTEXT', ctx=Load())], ctx=Load())), Assign(targets=[Attribute(value=Name(id='CertAddEncodedCertificateToStore', ctx=Load()), attr='restype', ctx=Store())], value=Name(id='BOOL', ctx=Load())), Assign(targets=[Name(id='CertCreateCertificateContext', ctx=Store())], value=Attribute(value=Name(id='wincrypt', ctx=Load()), attr='CertCreateCertificateContext', ctx=Load())), Assign(targets=[Attribute(value=Name(id='CertCreateCertificateContext', ctx=Load()), attr='argtypes', ctx=Store())], value=Tuple(elts=[Name(id='DWORD', ctx=Load()), Name(id='c_char_p', ctx=Load()), Name(id='DWORD', ctx=Load())], ctx=Load())), Assign(targets=[Attribute(value=Name(id='CertCreateCertificateContext', ctx=Load()), attr='restype', ctx=Store())], value=Name(id='PCERT_CONTEXT', ctx=Load())), Assign(targets=[Attribute(value=Name(id='CertCreateCertificateContext', ctx=Load()), attr='errcheck', ctx=Store())], value=Name(id='_handle_win_error', ctx=Load())), Assign(targets=[Name(id='CertGetCertificateChain', ctx=Store())], value=Attribute(value=Name(id='wincrypt', ctx=Load()), attr='CertGetCertificateChain', ctx=Load())), Assign(targets=[Attribute(value=Name(id='CertGetCertificateChain', ctx=Load()), attr='argtypes', ctx=Store())], value=Tuple(elts=[Name(id='HCERTCHAINENGINE', ctx=Load()), Name(id='PCERT_CONTEXT', ctx=Load()), Name(id='LPFILETIME', ctx=Load()), Name(id='HCERTSTORE', ctx=Load()), Name(id='PCERT_CHAIN_PARA', ctx=Load()), Name(id='DWORD', ctx=Load()), Name(id='c_void_p', ctx=Load()), Name(id='PCCERT_CHAIN_CONTEXT', ctx=Load())], ctx=Load())), Assign(targets=[Attribute(value=Name(id='CertGetCertificateChain', ctx=Load()), attr='restype', ctx=Store())], value=Name(id='BOOL', ctx=Load())), Assign(targets=[Attribute(value=Name(id='CertGetCertificateChain', ctx=Load()), attr='errcheck', ctx=Store())], value=Name(id='_handle_win_error', ctx=Load())), Assign(targets=[Name(id='CertVerifyCertificateChainPolicy', ctx=Store())], value=Attribute(value=Name(id='wincrypt', ctx=Load()), attr='CertVerifyCertificateChainPolicy', ctx=Load())), Assign(targets=[Attribute(value=Name(id='CertVerifyCertificateChainPolicy', ctx=Load()), attr='argtypes', ctx=Store())], value=Tuple(elts=[Name(id='c_ulong', ctx=Load()), Name(id='PCERT_CHAIN_CONTEXT', ctx=Load()), Name(id='PCERT_CHAIN_POLICY_PARA', ctx=Load()), Name(id='PCERT_CHAIN_POLICY_STATUS', ctx=Load())], ctx=Load())), Assign(targets=[Attribute(value=Name(id='CertVerifyCertificateChainPolicy', ctx=Load()), attr='restype', ctx=Store())], value=Name(id='BOOL', ctx=Load())), Assign(targets=[Name(id='CertCloseStore', ctx=Store())], value=Attribute(value=Name(id='wincrypt', ctx=Load()), attr='CertCloseStore', ctx=Load())), Assign(targets=[Attribute(value=Name(id='CertCloseStore', ctx=Load()), attr='argtypes', ctx=Store())], value=Tuple(elts=[Name(id='HCERTSTORE', ctx=Load()), Name(id='DWORD', ctx=Load())], ctx=Load())), Assign(targets=[Attribute(value=Name(id='CertCloseStore', ctx=Load()), attr='restype', ctx=Store())], value=Name(id='BOOL', ctx=Load())), Assign(targets=[Attribute(value=Name(id='CertCloseStore', ctx=Load()), attr='errcheck', ctx=Store())], value=Name(id='_handle_win_error', ctx=Load())), Assign(targets=[Name(id='CertFreeCertificateChain', ctx=Store())], value=Attribute(value=Name(id='wincrypt', ctx=Load()), attr='CertFreeCertificateChain', ctx=Load())), Assign(targets=[Attribute(value=Name(id='CertFreeCertificateChain', ctx=Load()), attr='argtypes', ctx=Store())], value=Tuple(elts=[Name(id='PCERT_CHAIN_CONTEXT', ctx=Load())], ctx=Load())), Assign(targets=[Name(id='CertFreeCertificateContext', ctx=Store())], value=Attribute(value=Name(id='wincrypt', ctx=Load()), attr='CertFreeCertificateContext', ctx=Load())), Assign(targets=[Attribute(value=Name(id='CertFreeCertificateContext', ctx=Load()), attr='argtypes', ctx=Store())], value=Tuple(elts=[Name(id='PCERT_CONTEXT', ctx=Load())], ctx=Load())), Assign(targets=[Name(id='CertFreeCertificateChainEngine', ctx=Store())], value=Attribute(value=Name(id='wincrypt', ctx=Load()), attr='CertFreeCertificateChainEngine', ctx=Load())), Assign(targets=[Attribute(value=Name(id='CertFreeCertificateChainEngine', ctx=Load()), attr='argtypes', ctx=Store())], value=Tuple(elts=[Name(id='HCERTCHAINENGINE', ctx=Load())], ctx=Load())), Assign(targets=[Name(id='FormatMessageW', ctx=Store())], value=Attribute(value=Name(id='kernel32', ctx=Load()), attr='FormatMessageW', ctx=Load())), Assign(targets=[Attribute(value=Name(id='FormatMessageW', ctx=Load()), attr='argtypes', ctx=Store())], value=Tuple(elts=[Name(id='DWORD', ctx=Load()), Name(id='LPCVOID', ctx=Load()), Name(id='DWORD', ctx=Load()), Name(id='DWORD', ctx=Load()), Name(id='LPWSTR', ctx=Load()), Name(id='DWORD', ctx=Load()), Name(id='c_void_p', ctx=Load())], ctx=Load())), Assign(targets=[Attribute(value=Name(id='FormatMessageW', ctx=Load()), attr='restype', ctx=Store())], value=Name(id='DWORD', ctx=Load())), FunctionDef(name='_verify_peercerts_impl', args=arguments(posonlyargs=[], args=[arg(arg='ssl_context', annotation=Attribute(value=Name(id='ssl', ctx=Load()), attr='SSLContext', ctx=Load())), arg(arg='cert_chain', annotation=Subscript(value=Name(id='list', ctx=Load()), slice=Name(id='bytes', ctx=Load()), ctx=Load())), arg(arg='server_hostname', annotation=BinOp(left=Name(id='str', ctx=Load()), op=BitOr(), right=Constant(value=None)))], kwonlyargs=[], kw_defaults=[], defaults=[Constant(value=None)]), body=[Expr(value=Constant(value='Verify the cert_chain from the server using Windows APIs.')), Assign(targets=[Name(id='pCertContext', ctx=Store())], value=Constant(value=None)), Assign(targets=[Name(id='hIntermediateCertStore', ctx=Store())], value=Call(func=Name(id='CertOpenStore', ctx=Load()), args=[Name(id='CERT_STORE_PROV_MEMORY', ctx=Load()), Constant(value=0), Constant(value=None), Constant(value=0), Constant(value=None)], keywords=[])), Try(body=[For(target=Name(id='cert_bytes', ctx=Store()), iter=Subscript(value=Name(id='cert_chain', ctx=Load()), slice=Slice(lower=Constant(value=1)), ctx=Load()), body=[Expr(value=Call(func=Name(id='CertAddEncodedCertificateToStore', ctx=Load()), args=[Name(id='hIntermediateCertStore', ctx=Load()), BinOp(left=Name(id='X509_ASN_ENCODING', ctx=Load()), op=BitOr(), right=Name(id='PKCS_7_ASN_ENCODING', ctx=Load())), Name(id='cert_bytes', ctx=Load()), Call(func=Name(id='len', ctx=Load()), args=[Name(id='cert_bytes', ctx=Load())], keywords=[]), Name(id='CERT_STORE_ADD_USE_EXISTING', ctx=Load()), Constant(value=None)], keywords=[]))], orelse=[]), Assign(targets=[Name(id='leaf_cert', ctx=Store())], value=Subscript(value=Name(id='cert_chain', ctx=Load()), slice=Constant(value=0), ctx=Load())), Assign(targets=[Name(id='pCertContext', ctx=Store())], value=Call(func=Name(id='CertCreateCertificateContext', ctx=Load()), args=[BinOp(left=Name(id='X509_ASN_ENCODING', ctx=Load()), op=BitOr(), right=Name(id='PKCS_7_ASN_ENCODING', ctx=Load())), Name(id='leaf_cert', ctx=Load()), Call(func=Name(id='len', ctx=Load()), args=[Name(id='leaf_cert', ctx=Load())], keywords=[])], keywords=[])), Assign(targets=[Name(id='cert_enhkey_usage', ctx=Store())], value=Call(func=Name(id='CERT_ENHKEY_USAGE', ctx=Load()), args=[], keywords=[])), Assign(targets=[Attribute(value=Name(id='cert_enhkey_usage', ctx=Load()), attr='cUsageIdentifier', ctx=Store())], value=Constant(value=1)), Assign(targets=[Attribute(value=Name(id='cert_enhkey_usage', ctx=Load()), attr='rgpszUsageIdentifier', ctx=Store())], value=Call(func=BinOp(left=Name(id='c_char_p', ctx=Load()), op=Mult(), right=Constant(value=1)), args=[Name(id='OID_PKIX_KP_SERVER_AUTH', ctx=Load())], keywords=[])), Assign(targets=[Name(id='cert_usage_match', ctx=Store())], value=Call(func=Name(id='CERT_USAGE_MATCH', ctx=Load()), args=[], keywords=[])), Assign(targets=[Attribute(value=Name(id='cert_usage_match', ctx=Load()), attr='Usage', ctx=Store())], value=Name(id='cert_enhkey_usage', ctx=Load())), Assign(targets=[Name(id='chain_params', ctx=Store())], value=Call(func=Name(id='CERT_CHAIN_PARA', ctx=Load()), args=[], keywords=[])), Assign(targets=[Attribute(value=Name(id='chain_params', ctx=Load()), attr='RequestedUsage', ctx=Store())], value=Name(id='cert_usage_match', ctx=Load())), Assign(targets=[Attribute(value=Name(id='chain_params', ctx=Load()), attr='cbSize', ctx=Store())], value=Call(func=Name(id='sizeof', ctx=Load()), args=[Name(id='chain_params', ctx=Load())], keywords=[])), Assign(targets=[Name(id='pChainPara', ctx=Store())], value=Call(func=Name(id='pointer', ctx=Load()), args=[Name(id='chain_params', ctx=Load())], keywords=[])), If(test=BinOp(left=Attribute(value=Name(id='ssl_context', ctx=Load()), attr='verify_flags', ctx=Load()), op=BitAnd(), right=Attribute(value=Name(id='ssl', ctx=Load()), attr='VERIFY_CRL_CHECK_CHAIN', ctx=Load())), body=[Assign(targets=[Name(id='chain_flags', ctx=Store())], value=Name(id='CERT_CHAIN_REVOCATION_CHECK_CHAIN', ctx=Load()))], orelse=[If(test=BinOp(left=Attribute(value=Name(id='ssl_context', ctx=Load()), attr='verify_flags', ctx=Load()), op=BitAnd(), right=Attribute(value=Name(id='ssl', ctx=Load()), attr='VERIFY_CRL_CHECK_LEAF', ctx=Load())), body=[Assign(targets=[Name(id='chain_flags', ctx=Store())], value=Name(id='CERT_CHAIN_REVOCATION_CHECK_END_CERT', ctx=Load()))], orelse=[Assign(targets=[Name(id='chain_flags', ctx=Store())], value=Constant(value=0))])]), Try(body=[Expr(value=Call(func=Name(id='_get_and_verify_cert_chain', ctx=Load()), args=[Name(id='ssl_context', ctx=Load()), Constant(value=None), Name(id='hIntermediateCertStore', ctx=Load()), Name(id='pCertContext', ctx=Load()), Name(id='pChainPara', ctx=Load()), Name(id='server_hostname', ctx=Load())], keywords=[keyword(arg='chain_flags', value=Name(id='chain_flags', ctx=Load()))]))], handlers=[ExceptHandler(type=Attribute(value=Name(id='ssl', ctx=Load()), attr='SSLCertVerificationError', ctx=Load()), body=[AnnAssign(target=Name(id='custom_ca_certs', ctx=Store()), annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load()), slice=Name(id='bytes', ctx=Load()), ctx=Load()), op=BitOr(), right=Constant(value=None)), value=Call(func=Attribute(value=Name(id='ssl_context', ctx=Load()), attr='get_ca_certs', ctx=Load()), args=[], keywords=[keyword(arg='binary_form', value=Constant(value=True))]), simple=1), If(test=Name(id='custom_ca_certs', ctx=Load()), body=[Expr(value=Call(func=Name(id='_verify_using_custom_ca_certs', ctx=Load()), args=[Name(id='ssl_context', ctx=Load()), Name(id='custom_ca_certs', ctx=Load()), Name(id='hIntermediateCertStore', ctx=Load()), Name(id='pCertContext', ctx=Load()), Name(id='pChainPara', ctx=Load()), Name(id='server_hostname', ctx=Load())], keywords=[keyword(arg='chain_flags', value=Name(id='chain_flags', ctx=Load()))]))], orelse=[Raise()])])], orelse=[], finalbody=[])], handlers=[], orelse=[], finalbody=[Expr(value=Call(func=Name(id='CertCloseStore', ctx=Load()), args=[Name(id='hIntermediateCertStore', ctx=Load()), Constant(value=0)], keywords=[])), If(test=Name(id='pCertContext', ctx=Load()), body=[Expr(value=Call(func=Name(id='CertFreeCertificateContext', ctx=Load()), args=[Name(id='pCertContext', ctx=Load())], keywords=[]))], orelse=[])])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='_get_and_verify_cert_chain', args=arguments(posonlyargs=[], args=[arg(arg='ssl_context', annotation=Attribute(value=Name(id='ssl', ctx=Load()), attr='SSLContext', ctx=Load())), arg(arg='hChainEngine', annotation=BinOp(left=Name(id='HCERTCHAINENGINE', ctx=Load()), op=BitOr(), right=Constant(value=None))), arg(arg='hIntermediateCertStore', annotation=Name(id='HCERTSTORE', ctx=Load())), arg(arg='pPeerCertContext', annotation=Name(id='c_void_p', ctx=Load())), arg(arg='pChainPara', annotation=Name(id='PCERT_CHAIN_PARA', ctx=Load())), arg(arg='server_hostname', annotation=BinOp(left=Name(id='str', ctx=Load()), op=BitOr(), right=Constant(value=None))), arg(arg='chain_flags', annotation=Name(id='int', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='ppChainContext', ctx=Store())], value=Constant(value=None)), Try(body=[Assign(targets=[Name(id='ppChainContext', ctx=Store())], value=Call(func=Name(id='pointer', ctx=Load()), args=[Call(func=Name(id='PCERT_CHAIN_CONTEXT', ctx=Load()), args=[], keywords=[])], keywords=[])), Expr(value=Call(func=Name(id='CertGetCertificateChain', ctx=Load()), args=[Name(id='hChainEngine', ctx=Load()), Name(id='pPeerCertContext', ctx=Load()), Constant(value=None), Name(id='hIntermediateCertStore', ctx=Load()), Name(id='pChainPara', ctx=Load()), Name(id='chain_flags', ctx=Load()), Constant(value=None), Name(id='ppChainContext', ctx=Load())], keywords=[])), Assign(targets=[Name(id='pChainContext', ctx=Store())], value=Attribute(value=Name(id='ppChainContext', ctx=Load()), attr='contents', ctx=Load())), Assign(targets=[Name(id='ssl_extra_cert_chain_policy_para', ctx=Store())], value=Call(func=Name(id='SSL_EXTRA_CERT_CHAIN_POLICY_PARA', ctx=Load()), args=[], keywords=[])), Assign(targets=[Attribute(value=Name(id='ssl_extra_cert_chain_policy_para', ctx=Load()), attr='cbSize', ctx=Store())], value=Call(func=Name(id='sizeof', ctx=Load()), args=[Name(id='ssl_extra_cert_chain_policy_para', ctx=Load())], keywords=[])), Assign(targets=[Attribute(value=Name(id='ssl_extra_cert_chain_policy_para', ctx=Load()), attr='dwAuthType', ctx=Store())], value=Name(id='AUTHTYPE_SERVER', ctx=Load())), Assign(targets=[Attribute(value=Name(id='ssl_extra_cert_chain_policy_para', ctx=Load()), attr='fdwChecks', ctx=Store())], value=Constant(value=0)), If(test=Name(id='server_hostname', ctx=Load()), body=[Assign(targets=[Attribute(value=Name(id='ssl_extra_cert_chain_policy_para', ctx=Load()), attr='pwszServerName', ctx=Store())], value=Call(func=Name(id='c_wchar_p', ctx=Load()), args=[Name(id='server_hostname', ctx=Load())], keywords=[]))], orelse=[]), Assign(targets=[Name(id='chain_policy', ctx=Store())], value=Call(func=Name(id='CERT_CHAIN_POLICY_PARA', ctx=Load()), args=[], keywords=[])), Assign(targets=[Attribute(value=Name(id='chain_policy', ctx=Load()), attr='pvExtraPolicyPara', ctx=Store())], value=Call(func=Name(id='cast', ctx=Load()), args=[Call(func=Name(id='pointer', ctx=Load()), args=[Name(id='ssl_extra_cert_chain_policy_para', ctx=Load())], keywords=[]), Name(id='c_void_p', ctx=Load())], keywords=[])), If(test=Compare(left=Attribute(value=Name(id='ssl_context', ctx=Load()), attr='verify_mode', ctx=Load()), ops=[Eq()], comparators=[Attribute(value=Name(id='ssl', ctx=Load()), attr='CERT_NONE', ctx=Load())]), body=[AugAssign(target=Attribute(value=Name(id='chain_policy', ctx=Load()), attr='dwFlags', ctx=Store()), op=BitOr(), value=Name(id='CERT_CHAIN_POLICY_VERIFY_MODE_NONE_FLAGS', ctx=Load()))], orelse=[]), If(test=UnaryOp(op=Not(), operand=Attribute(value=Name(id='ssl_context', ctx=Load()), attr='check_hostname', ctx=Load())), body=[AugAssign(target=Attribute(value=Name(id='chain_policy', ctx=Load()), attr='dwFlags', ctx=Store()), op=BitOr(), value=Name(id='CERT_CHAIN_POLICY_IGNORE_INVALID_NAME_FLAG', ctx=Load()))], orelse=[]), Assign(targets=[Attribute(value=Name(id='chain_policy', ctx=Load()), attr='cbSize', ctx=Store())], value=Call(func=Name(id='sizeof', ctx=Load()), args=[Name(id='chain_policy', ctx=Load())], keywords=[])), Assign(targets=[Name(id='pPolicyPara', ctx=Store())], value=Call(func=Name(id='pointer', ctx=Load()), args=[Name(id='chain_policy', ctx=Load())], keywords=[])), Assign(targets=[Name(id='policy_status', ctx=Store())], value=Call(func=Name(id='CERT_CHAIN_POLICY_STATUS', ctx=Load()), args=[], keywords=[])), Assign(targets=[Attribute(value=Name(id='policy_status', ctx=Load()), attr='cbSize', ctx=Store())], value=Call(func=Name(id='sizeof', ctx=Load()), args=[Name(id='policy_status', ctx=Load())], keywords=[])), Assign(targets=[Name(id='pPolicyStatus', ctx=Store())], value=Call(func=Name(id='pointer', ctx=Load()), args=[Name(id='policy_status', ctx=Load())], keywords=[])), Expr(value=Call(func=Name(id='CertVerifyCertificateChainPolicy', ctx=Load()), args=[Name(id='CERT_CHAIN_POLICY_SSL', ctx=Load()), Name(id='pChainContext', ctx=Load()), Name(id='pPolicyPara', ctx=Load()), Name(id='pPolicyStatus', ctx=Load())], keywords=[])), Assign(targets=[Name(id='error_code', ctx=Store())], value=Attribute(value=Name(id='policy_status', ctx=Load()), attr='dwError', ctx=Load())), If(test=Name(id='error_code', ctx=Load()), body=[Assign(targets=[Name(id='error_message_buf', ctx=Store())], value=Call(func=Name(id='create_unicode_buffer', ctx=Load()), args=[Constant(value=1024)], keywords=[])), Assign(targets=[Name(id='error_message_chars', ctx=Store())], value=Call(func=Name(id='FormatMessageW', ctx=Load()), args=[BinOp(left=Name(id='FORMAT_MESSAGE_FROM_SYSTEM', ctx=Load()), op=BitOr(), right=Name(id='FORMAT_MESSAGE_IGNORE_INSERTS', ctx=Load())), Constant(value=None), Name(id='error_code', ctx=Load()), Constant(value=0), Name(id='error_message_buf', ctx=Load()), Call(func=Name(id='sizeof', ctx=Load()), args=[Name(id='error_message_buf', ctx=Load())], keywords=[]), Constant(value=None)], keywords=[])), If(test=Compare(left=Name(id='error_message_chars', ctx=Load()), ops=[LtE()], comparators=[Constant(value=0)]), body=[Assign(targets=[Name(id='error_message', ctx=Store())], value=JoinedStr(values=[Constant(value='Certificate chain policy error '), FormattedValue(value=Name(id='error_code', ctx=Load()), conversion=-1, format_spec=JoinedStr(values=[Constant(value='#x')])), Constant(value=' ['), FormattedValue(value=Attribute(value=Name(id='policy_status', ctx=Load()), attr='lElementIndex', ctx=Load()), conversion=-1), Constant(value=']')]))], orelse=[Assign(targets=[Name(id='error_message', ctx=Store())], value=Call(func=Attribute(value=Attribute(value=Name(id='error_message_buf', ctx=Load()), attr='value', ctx=Load()), attr='strip', ctx=Load()), args=[], keywords=[]))]), Assign(targets=[Name(id='err', ctx=Store())], value=Call(func=Attribute(value=Name(id='ssl', ctx=Load()), attr='SSLCertVerificationError', ctx=Load()), args=[Name(id='error_message', ctx=Load())], keywords=[])), Assign(targets=[Attribute(value=Name(id='err', ctx=Load()), attr='verify_message', ctx=Store())], value=Name(id='error_message', ctx=Load())), Assign(targets=[Attribute(value=Name(id='err', ctx=Load()), attr='verify_code', ctx=Store())], value=Name(id='error_code', ctx=Load())), Raise(exc=Name(id='err', ctx=Load()), cause=Constant(value=None))], orelse=[])], handlers=[], orelse=[], finalbody=[If(test=Name(id='ppChainContext', ctx=Load()), body=[Expr(value=Call(func=Name(id='CertFreeCertificateChain', ctx=Load()), args=[Attribute(value=Name(id='ppChainContext', ctx=Load()), attr='contents', ctx=Load())], keywords=[]))], orelse=[])])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='_verify_using_custom_ca_certs', args=arguments(posonlyargs=[], args=[arg(arg='ssl_context', annotation=Attribute(value=Name(id='ssl', ctx=Load()), attr='SSLContext', ctx=Load())), arg(arg='custom_ca_certs', annotation=Subscript(value=Name(id='list', ctx=Load()), slice=Name(id='bytes', ctx=Load()), ctx=Load())), arg(arg='hIntermediateCertStore', annotation=Name(id='HCERTSTORE', ctx=Load())), arg(arg='pPeerCertContext', annotation=Name(id='c_void_p', ctx=Load())), arg(arg='pChainPara', annotation=Name(id='PCERT_CHAIN_PARA', ctx=Load())), arg(arg='server_hostname', annotation=BinOp(left=Name(id='str', ctx=Load()), op=BitOr(), right=Constant(value=None))), arg(arg='chain_flags', annotation=Name(id='int', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='hChainEngine', ctx=Store())], value=Constant(value=None)), Assign(targets=[Name(id='hRootCertStore', ctx=Store())], value=Call(func=Name(id='CertOpenStore', ctx=Load()), args=[Name(id='CERT_STORE_PROV_MEMORY', ctx=Load()), Constant(value=0), Constant(value=None), Constant(value=0), Constant(value=None)], keywords=[])), Try(body=[For(target=Name(id='cert_bytes', ctx=Store()), iter=Name(id='custom_ca_certs', ctx=Load()), body=[Expr(value=Call(func=Name(id='CertAddEncodedCertificateToStore', ctx=Load()), args=[Name(id='hRootCertStore', ctx=Load()), BinOp(left=Name(id='X509_ASN_ENCODING', ctx=Load()), op=BitOr(), right=Name(id='PKCS_7_ASN_ENCODING', ctx=Load())), Name(id='cert_bytes', ctx=Load()), Call(func=Name(id='len', ctx=Load()), args=[Name(id='cert_bytes', ctx=Load())], keywords=[]), Name(id='CERT_STORE_ADD_USE_EXISTING', ctx=Load()), Constant(value=None)], keywords=[]))], orelse=[]), Assign(targets=[Name(id='cert_chain_engine_config', ctx=Store())], value=Call(func=Name(id='CERT_CHAIN_ENGINE_CONFIG', ctx=Load()), args=[], keywords=[])), Assign(targets=[Attribute(value=Name(id='cert_chain_engine_config', ctx=Load()), attr='cbSize', ctx=Store())], value=Call(func=Name(id='sizeof', ctx=Load()), args=[Name(id='cert_chain_engine_config', ctx=Load())], keywords=[])), Assign(targets=[Attribute(value=Name(id='cert_chain_engine_config', ctx=Load()), attr='hExclusiveRoot', ctx=Store())], value=Name(id='hRootCertStore', ctx=Load())), Assign(targets=[Name(id='pConfig', ctx=Store())], value=Call(func=Name(id='pointer', ctx=Load()), args=[Name(id='cert_chain_engine_config', ctx=Load())], keywords=[])), Assign(targets=[Name(id='phChainEngine', ctx=Store())], value=Call(func=Name(id='pointer', ctx=Load()), args=[Call(func=Name(id='HCERTCHAINENGINE', ctx=Load()), args=[], keywords=[])], keywords=[])), Expr(value=Call(func=Name(id='CertCreateCertificateChainEngine', ctx=Load()), args=[Name(id='pConfig', ctx=Load()), Name(id='phChainEngine', ctx=Load())], keywords=[])), Assign(targets=[Name(id='hChainEngine', ctx=Store())], value=Attribute(value=Name(id='phChainEngine', ctx=Load()), attr='contents', ctx=Load())), Expr(value=Call(func=Name(id='_get_and_verify_cert_chain', ctx=Load()), args=[Name(id='ssl_context', ctx=Load()), Name(id='hChainEngine', ctx=Load()), Name(id='hIntermediateCertStore', ctx=Load()), Name(id='pPeerCertContext', ctx=Load()), Name(id='pChainPara', ctx=Load()), Name(id='server_hostname', ctx=Load()), Name(id='chain_flags', ctx=Load())], keywords=[]))], handlers=[], orelse=[], finalbody=[If(test=Name(id='hChainEngine', ctx=Load()), body=[Expr(value=Call(func=Name(id='CertFreeCertificateChainEngine', ctx=Load()), args=[Name(id='hChainEngine', ctx=Load())], keywords=[]))], orelse=[]), Expr(value=Call(func=Name(id='CertCloseStore', ctx=Load()), args=[Name(id='hRootCertStore', ctx=Load()), Constant(value=0)], keywords=[]))])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='_configure_context', args=arguments(posonlyargs=[], args=[arg(arg='ctx', annotation=Attribute(value=Name(id='ssl', ctx=Load()), attr='SSLContext', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='check_hostname', ctx=Store())], value=Attribute(value=Name(id='ctx', ctx=Load()), attr='check_hostname', ctx=Load())), Assign(targets=[Name(id='verify_mode', ctx=Store())], value=Attribute(value=Name(id='ctx', ctx=Load()), attr='verify_mode', ctx=Load())), Assign(targets=[Attribute(value=Name(id='ctx', ctx=Load()), attr='check_hostname', ctx=Store())], value=Constant(value=False)), Expr(value=Call(func=Name(id='_set_ssl_context_verify_mode', ctx=Load()), args=[Name(id='ctx', ctx=Load()), Attribute(value=Name(id='ssl', ctx=Load()), attr='CERT_NONE', ctx=Load())], keywords=[])), Try(body=[Expr(value=Yield())], handlers=[], orelse=[], finalbody=[Assign(targets=[Attribute(value=Name(id='ctx', ctx=Load()), attr='check_hostname', ctx=Store())], value=Name(id='check_hostname', ctx=Load())), Expr(value=Call(func=Name(id='_set_ssl_context_verify_mode', ctx=Load()), args=[Name(id='ctx', ctx=Load()), Name(id='verify_mode', ctx=Load())], keywords=[]))])], decorator_list=[Attribute(value=Name(id='contextlib', ctx=Load()), attr='contextmanager', ctx=Load())], returns=Subscript(value=Attribute(value=Name(id='typing', ctx=Load()), attr='Iterator', ctx=Load()), slice=Constant(value=None), ctx=Load()))], type_ignores=[])