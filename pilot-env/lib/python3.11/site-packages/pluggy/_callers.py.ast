Module(body=[Expr(value=Constant(value='\nCall loop machinery\n')), ImportFrom(module='__future__', names=[alias(name='annotations')], level=0), ImportFrom(module='typing', names=[alias(name='cast')], level=0), ImportFrom(module='typing', names=[alias(name='Generator')], level=0), ImportFrom(module='typing', names=[alias(name='Mapping')], level=0), ImportFrom(module='typing', names=[alias(name='Sequence')], level=0), ImportFrom(module='typing', names=[alias(name='Tuple')], level=0), ImportFrom(module='typing', names=[alias(name='Union')], level=0), ImportFrom(module='_hooks', names=[alias(name='HookImpl')], level=1), ImportFrom(module='_result', names=[alias(name='_raise_wrapfail')], level=1), ImportFrom(module='_result', names=[alias(name='HookCallError')], level=1), ImportFrom(module='_result', names=[alias(name='Result')], level=1), Assign(targets=[Name(id='Teardown', ctx=Store())], value=Subscript(value=Name(id='Union', ctx=Load()), slice=Tuple(elts=[Subscript(value=Name(id='Tuple', ctx=Load()), slice=Subscript(value=Name(id='Generator', ctx=Load()), slice=Tuple(elts=[Constant(value=None), Subscript(value=Name(id='Result', ctx=Load()), slice=Name(id='object', ctx=Load()), ctx=Load()), Constant(value=None)], ctx=Load()), ctx=Load()), ctx=Load()), Subscript(value=Name(id='Generator', ctx=Load()), slice=Tuple(elts=[Constant(value=None), Name(id='object', ctx=Load()), Name(id='object', ctx=Load())], ctx=Load()), ctx=Load())], ctx=Load()), ctx=Load())), FunctionDef(name='_multicall', args=arguments(posonlyargs=[], args=[arg(arg='hook_name', annotation=Name(id='str', ctx=Load())), arg(arg='hook_impls', annotation=Subscript(value=Name(id='Sequence', ctx=Load()), slice=Name(id='HookImpl', ctx=Load()), ctx=Load())), arg(arg='caller_kwargs', annotation=Subscript(value=Name(id='Mapping', ctx=Load()), slice=Tuple(elts=[Name(id='str', ctx=Load()), Name(id='object', ctx=Load())], ctx=Load()), ctx=Load())), arg(arg='firstresult', annotation=Name(id='bool', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Execute a call into multiple python functions/methods and return the\n    result(s).\n\n    ``caller_kwargs`` comes from HookCaller.__call__().\n    ')), Assign(targets=[Name(id='__tracebackhide__', ctx=Store())], value=Constant(value=True)), AnnAssign(target=Name(id='results', ctx=Store()), annotation=Subscript(value=Name(id='list', ctx=Load()), slice=Name(id='object', ctx=Load()), ctx=Load()), value=List(elts=[], ctx=Load()), simple=1), Assign(targets=[Name(id='exception', ctx=Store())], value=Constant(value=None)), Assign(targets=[Name(id='only_new_style_wrappers', ctx=Store())], value=Constant(value=True)), Try(body=[AnnAssign(target=Name(id='teardowns', ctx=Store()), annotation=Subscript(value=Name(id='list', ctx=Load()), slice=Name(id='Teardown', ctx=Load()), ctx=Load()), value=List(elts=[], ctx=Load()), simple=1), Try(body=[For(target=Name(id='hook_impl', ctx=Store()), iter=Call(func=Name(id='reversed', ctx=Load()), args=[Name(id='hook_impls', ctx=Load())], keywords=[]), body=[Try(body=[Assign(targets=[Name(id='args', ctx=Store())], value=ListComp(elt=Subscript(value=Name(id='caller_kwargs', ctx=Load()), slice=Name(id='argname', ctx=Load()), ctx=Load()), generators=[comprehension(target=Name(id='argname', ctx=Store()), iter=Attribute(value=Name(id='hook_impl', ctx=Load()), attr='argnames', ctx=Load()), ifs=[], is_async=0)]))], handlers=[ExceptHandler(type=Name(id='KeyError', ctx=Load()), body=[For(target=Name(id='argname', ctx=Store()), iter=Attribute(value=Name(id='hook_impl', ctx=Load()), attr='argnames', ctx=Load()), body=[If(test=Compare(left=Name(id='argname', ctx=Load()), ops=[NotIn()], comparators=[Name(id='caller_kwargs', ctx=Load())]), body=[Raise(exc=Call(func=Name(id='HookCallError', ctx=Load()), args=[JoinedStr(values=[Constant(value='hook call must provide argument '), FormattedValue(value=Name(id='argname', ctx=Load()), conversion=114)])], keywords=[]))], orelse=[])], orelse=[])])], orelse=[], finalbody=[]), If(test=Attribute(value=Name(id='hook_impl', ctx=Load()), attr='hookwrapper', ctx=Load()), body=[Assign(targets=[Name(id='only_new_style_wrappers', ctx=Store())], value=Constant(value=False)), Try(body=[Assign(targets=[Name(id='res', ctx=Store())], value=Call(func=Attribute(value=Name(id='hook_impl', ctx=Load()), attr='function', ctx=Load()), args=[Starred(value=Name(id='args', ctx=Load()), ctx=Load())], keywords=[])), Assign(targets=[Name(id='wrapper_gen', ctx=Store())], value=Call(func=Name(id='cast', ctx=Load()), args=[Subscript(value=Name(id='Generator', ctx=Load()), slice=Tuple(elts=[Constant(value=None), Subscript(value=Name(id='Result', ctx=Load()), slice=Name(id='object', ctx=Load()), ctx=Load()), Constant(value=None)], ctx=Load()), ctx=Load()), Name(id='res', ctx=Load())], keywords=[])), Expr(value=Call(func=Name(id='next', ctx=Load()), args=[Name(id='wrapper_gen', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='teardowns', ctx=Load()), attr='append', ctx=Load()), args=[Tuple(elts=[Name(id='wrapper_gen', ctx=Load())], ctx=Load())], keywords=[]))], handlers=[ExceptHandler(type=Name(id='StopIteration', ctx=Load()), body=[Expr(value=Call(func=Name(id='_raise_wrapfail', ctx=Load()), args=[Name(id='wrapper_gen', ctx=Load()), Constant(value='did not yield')], keywords=[]))])], orelse=[], finalbody=[])], orelse=[If(test=Attribute(value=Name(id='hook_impl', ctx=Load()), attr='wrapper', ctx=Load()), body=[Try(body=[Assign(targets=[Name(id='res', ctx=Store())], value=Call(func=Attribute(value=Name(id='hook_impl', ctx=Load()), attr='function', ctx=Load()), args=[Starred(value=Name(id='args', ctx=Load()), ctx=Load())], keywords=[])), Assign(targets=[Name(id='function_gen', ctx=Store())], value=Call(func=Name(id='cast', ctx=Load()), args=[Subscript(value=Name(id='Generator', ctx=Load()), slice=Tuple(elts=[Constant(value=None), Name(id='object', ctx=Load()), Name(id='object', ctx=Load())], ctx=Load()), ctx=Load()), Name(id='res', ctx=Load())], keywords=[])), Expr(value=Call(func=Name(id='next', ctx=Load()), args=[Name(id='function_gen', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='teardowns', ctx=Load()), attr='append', ctx=Load()), args=[Name(id='function_gen', ctx=Load())], keywords=[]))], handlers=[ExceptHandler(type=Name(id='StopIteration', ctx=Load()), body=[Expr(value=Call(func=Name(id='_raise_wrapfail', ctx=Load()), args=[Name(id='function_gen', ctx=Load()), Constant(value='did not yield')], keywords=[]))])], orelse=[], finalbody=[])], orelse=[Assign(targets=[Name(id='res', ctx=Store())], value=Call(func=Attribute(value=Name(id='hook_impl', ctx=Load()), attr='function', ctx=Load()), args=[Starred(value=Name(id='args', ctx=Load()), ctx=Load())], keywords=[])), If(test=Compare(left=Name(id='res', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[Expr(value=Call(func=Attribute(value=Name(id='results', ctx=Load()), attr='append', ctx=Load()), args=[Name(id='res', ctx=Load())], keywords=[])), If(test=Name(id='firstresult', ctx=Load()), body=[Break()], orelse=[])], orelse=[])])])], orelse=[])], handlers=[ExceptHandler(type=Name(id='BaseException', ctx=Load()), name='exc', body=[Assign(targets=[Name(id='exception', ctx=Store())], value=Name(id='exc', ctx=Load()))])], orelse=[], finalbody=[])], handlers=[], orelse=[], finalbody=[If(test=Name(id='only_new_style_wrappers', ctx=Load()), body=[If(test=Name(id='firstresult', ctx=Load()), body=[Assign(targets=[Name(id='result', ctx=Store())], value=IfExp(test=Name(id='results', ctx=Load()), body=Subscript(value=Name(id='results', ctx=Load()), slice=Constant(value=0), ctx=Load()), orelse=Constant(value=None)))], orelse=[Assign(targets=[Name(id='result', ctx=Store())], value=Name(id='results', ctx=Load()))]), For(target=Name(id='teardown', ctx=Store()), iter=Call(func=Name(id='reversed', ctx=Load()), args=[Name(id='teardowns', ctx=Load())], keywords=[]), body=[Try(body=[If(test=Compare(left=Name(id='exception', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[Expr(value=Call(func=Attribute(value=Name(id='teardown', ctx=Load()), attr='throw', ctx=Load()), args=[Name(id='exception', ctx=Load())], keywords=[]))], orelse=[Expr(value=Call(func=Attribute(value=Name(id='teardown', ctx=Load()), attr='send', ctx=Load()), args=[Name(id='result', ctx=Load())], keywords=[]))]), Expr(value=Call(func=Attribute(value=Name(id='teardown', ctx=Load()), attr='close', ctx=Load()), args=[], keywords=[]))], handlers=[ExceptHandler(type=Name(id='StopIteration', ctx=Load()), name='si', body=[Assign(targets=[Name(id='result', ctx=Store())], value=Attribute(value=Name(id='si', ctx=Load()), attr='value', ctx=Load())), Assign(targets=[Name(id='exception', ctx=Store())], value=Constant(value=None)), Continue()]), ExceptHandler(type=Name(id='BaseException', ctx=Load()), name='e', body=[Assign(targets=[Name(id='exception', ctx=Store())], value=Name(id='e', ctx=Load())), Continue()])], orelse=[], finalbody=[]), Expr(value=Call(func=Name(id='_raise_wrapfail', ctx=Load()), args=[Name(id='teardown', ctx=Load()), Constant(value='has second yield')], keywords=[]))], orelse=[]), If(test=Compare(left=Name(id='exception', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[Raise(exc=Call(func=Attribute(value=Name(id='exception', ctx=Load()), attr='with_traceback', ctx=Load()), args=[Attribute(value=Name(id='exception', ctx=Load()), attr='__traceback__', ctx=Load())], keywords=[]))], orelse=[Return(value=Name(id='result', ctx=Load()))])], orelse=[If(test=Name(id='firstresult', ctx=Load()), body=[AnnAssign(target=Name(id='outcome', ctx=Store()), annotation=Subscript(value=Name(id='Result', ctx=Load()), slice=BinOp(left=Name(id='object', ctx=Load()), op=BitOr(), right=Subscript(value=Name(id='list', ctx=Load()), slice=Name(id='object', ctx=Load()), ctx=Load())), ctx=Load()), value=Call(func=Name(id='Result', ctx=Load()), args=[IfExp(test=Name(id='results', ctx=Load()), body=Subscript(value=Name(id='results', ctx=Load()), slice=Constant(value=0), ctx=Load()), orelse=Constant(value=None)), Name(id='exception', ctx=Load())], keywords=[]), simple=1)], orelse=[Assign(targets=[Name(id='outcome', ctx=Store())], value=Call(func=Name(id='Result', ctx=Load()), args=[Name(id='results', ctx=Load()), Name(id='exception', ctx=Load())], keywords=[]))]), For(target=Name(id='teardown', ctx=Store()), iter=Call(func=Name(id='reversed', ctx=Load()), args=[Name(id='teardowns', ctx=Load())], keywords=[]), body=[If(test=Call(func=Name(id='isinstance', ctx=Load()), args=[Name(id='teardown', ctx=Load()), Name(id='tuple', ctx=Load())], keywords=[]), body=[Try(body=[Expr(value=Call(func=Attribute(value=Subscript(value=Name(id='teardown', ctx=Load()), slice=Constant(value=0), ctx=Load()), attr='send', ctx=Load()), args=[Name(id='outcome', ctx=Load())], keywords=[])), Expr(value=Call(func=Name(id='_raise_wrapfail', ctx=Load()), args=[Subscript(value=Name(id='teardown', ctx=Load()), slice=Constant(value=0), ctx=Load()), Constant(value='has second yield')], keywords=[]))], handlers=[ExceptHandler(type=Name(id='StopIteration', ctx=Load()), body=[Pass()])], orelse=[], finalbody=[])], orelse=[Try(body=[If(test=Compare(left=Attribute(value=Name(id='outcome', ctx=Load()), attr='_exception', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[Expr(value=Call(func=Attribute(value=Name(id='teardown', ctx=Load()), attr='throw', ctx=Load()), args=[Attribute(value=Name(id='outcome', ctx=Load()), attr='_exception', ctx=Load())], keywords=[]))], orelse=[Expr(value=Call(func=Attribute(value=Name(id='teardown', ctx=Load()), attr='send', ctx=Load()), args=[Attribute(value=Name(id='outcome', ctx=Load()), attr='_result', ctx=Load())], keywords=[]))]), Expr(value=Call(func=Attribute(value=Name(id='teardown', ctx=Load()), attr='close', ctx=Load()), args=[], keywords=[]))], handlers=[ExceptHandler(type=Name(id='StopIteration', ctx=Load()), name='si', body=[Expr(value=Call(func=Attribute(value=Name(id='outcome', ctx=Load()), attr='force_result', ctx=Load()), args=[Attribute(value=Name(id='si', ctx=Load()), attr='value', ctx=Load())], keywords=[])), Continue()]), ExceptHandler(type=Name(id='BaseException', ctx=Load()), name='e', body=[Expr(value=Call(func=Attribute(value=Name(id='outcome', ctx=Load()), attr='force_exception', ctx=Load()), args=[Name(id='e', ctx=Load())], keywords=[])), Continue()])], orelse=[], finalbody=[]), Expr(value=Call(func=Name(id='_raise_wrapfail', ctx=Load()), args=[Name(id='teardown', ctx=Load()), Constant(value='has second yield')], keywords=[]))])], orelse=[]), Return(value=Call(func=Attribute(value=Name(id='outcome', ctx=Load()), attr='get_result', ctx=Load()), args=[], keywords=[]))])])], decorator_list=[], returns=BinOp(left=Name(id='object', ctx=Load()), op=BitOr(), right=Subscript(value=Name(id='list', ctx=Load()), slice=Name(id='object', ctx=Load()), ctx=Load())))], type_ignores=[])