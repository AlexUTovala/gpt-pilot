Module(body=[Expr(value=Constant(value='Compiles nodes from the parser into Python code.')), Import(names=[alias(name='typing', asname='t')]), ImportFrom(module='contextlib', names=[alias(name='contextmanager')], level=0), ImportFrom(module='functools', names=[alias(name='update_wrapper')], level=0), ImportFrom(module='io', names=[alias(name='StringIO')], level=0), ImportFrom(module='itertools', names=[alias(name='chain')], level=0), ImportFrom(module='keyword', names=[alias(name='iskeyword', asname='is_python_keyword')], level=0), ImportFrom(module='markupsafe', names=[alias(name='escape')], level=0), ImportFrom(module='markupsafe', names=[alias(name='Markup')], level=0), ImportFrom(names=[alias(name='nodes')], level=1), ImportFrom(module='exceptions', names=[alias(name='TemplateAssertionError')], level=1), ImportFrom(module='idtracking', names=[alias(name='Symbols')], level=1), ImportFrom(module='idtracking', names=[alias(name='VAR_LOAD_ALIAS')], level=1), ImportFrom(module='idtracking', names=[alias(name='VAR_LOAD_PARAMETER')], level=1), ImportFrom(module='idtracking', names=[alias(name='VAR_LOAD_RESOLVE')], level=1), ImportFrom(module='idtracking', names=[alias(name='VAR_LOAD_UNDEFINED')], level=1), ImportFrom(module='nodes', names=[alias(name='EvalContext')], level=1), ImportFrom(module='optimizer', names=[alias(name='Optimizer')], level=1), ImportFrom(module='utils', names=[alias(name='_PassArg')], level=1), ImportFrom(module='utils', names=[alias(name='concat')], level=1), ImportFrom(module='visitor', names=[alias(name='NodeVisitor')], level=1), If(test=Attribute(value=Name(id='t', ctx=Load()), attr='TYPE_CHECKING', ctx=Load()), body=[Import(names=[alias(name='typing_extensions', asname='te')]), ImportFrom(module='environment', names=[alias(name='Environment')], level=1)], orelse=[]), Assign(targets=[Name(id='F', ctx=Store())], value=Call(func=Attribute(value=Name(id='t', ctx=Load()), attr='TypeVar', ctx=Load()), args=[Constant(value='F')], keywords=[keyword(arg='bound', value=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Callable', ctx=Load()), slice=Tuple(elts=[Constant(value=Ellipsis), Attribute(value=Name(id='t', ctx=Load()), attr='Any', ctx=Load())], ctx=Load()), ctx=Load()))])), Assign(targets=[Name(id='operators', ctx=Store())], value=Dict(keys=[Constant(value='eq'), Constant(value='ne'), Constant(value='gt'), Constant(value='gteq'), Constant(value='lt'), Constant(value='lteq'), Constant(value='in'), Constant(value='notin')], values=[Constant(value='=='), Constant(value='!='), Constant(value='>'), Constant(value='>='), Constant(value='<'), Constant(value='<='), Constant(value='in'), Constant(value='not in')])), FunctionDef(name='optimizeconst', args=arguments(posonlyargs=[], args=[arg(arg='f', annotation=Name(id='F', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[FunctionDef(name='new_func', args=arguments(posonlyargs=[], args=[arg(arg='self', annotation=Constant(value='CodeGenerator')), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Expr', ctx=Load())), arg(arg='frame', annotation=Constant(value='Frame'))], kwonlyargs=[], kw_defaults=[], kwarg=arg(arg='kwargs', annotation=Attribute(value=Name(id='t', ctx=Load()), attr='Any', ctx=Load())), defaults=[]), body=[If(test=BoolOp(op=And(), values=[Compare(left=Attribute(value=Name(id='self', ctx=Load()), attr='optimizer', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), UnaryOp(op=Not(), operand=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='eval_ctx', ctx=Load()), attr='volatile', ctx=Load()))]), body=[Assign(targets=[Name(id='new_node', ctx=Store())], value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='optimizer', ctx=Load()), attr='visit', ctx=Load()), args=[Name(id='node', ctx=Load()), Attribute(value=Name(id='frame', ctx=Load()), attr='eval_ctx', ctx=Load())], keywords=[])), If(test=Compare(left=Name(id='new_node', ctx=Load()), ops=[NotEq()], comparators=[Name(id='node', ctx=Load())]), body=[Return(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Name(id='new_node', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[]))], orelse=[])], orelse=[]), Return(value=Call(func=Name(id='f', ctx=Load()), args=[Name(id='self', ctx=Load()), Name(id='node', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[keyword(value=Name(id='kwargs', ctx=Load()))]))], decorator_list=[], returns=Attribute(value=Name(id='t', ctx=Load()), attr='Any', ctx=Load())), Return(value=Call(func=Name(id='update_wrapper', ctx=Load()), args=[Call(func=Attribute(value=Name(id='t', ctx=Load()), attr='cast', ctx=Load()), args=[Name(id='F', ctx=Load()), Name(id='new_func', ctx=Load())], keywords=[]), Name(id='f', ctx=Load())], keywords=[]))], decorator_list=[], returns=Name(id='F', ctx=Load())), FunctionDef(name='_make_binop', args=arguments(posonlyargs=[], args=[arg(arg='op', annotation=Name(id='str', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[FunctionDef(name='visitor', args=arguments(posonlyargs=[], args=[arg(arg='self', annotation=Constant(value='CodeGenerator')), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='BinExpr', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[If(test=BoolOp(op=And(), values=[Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), attr='sandboxed', ctx=Load()), Compare(left=Name(id='op', ctx=Load()), ops=[In()], comparators=[Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), attr='intercepted_binops', ctx=Load())])]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[Constant(value='environment.call_binop(context, '), FormattedValue(value=Name(id='op', ctx=Load()), conversion=114), Constant(value=', ')])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='left', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=', ')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='right', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[]))], orelse=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='(')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='left', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[Constant(value=' '), FormattedValue(value=Name(id='op', ctx=Load()), conversion=-1), Constant(value=' ')])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='right', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[]))]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=')')], keywords=[]))], decorator_list=[Name(id='optimizeconst', ctx=Load())], returns=Constant(value=None)), Return(value=Name(id='visitor', ctx=Load()))], decorator_list=[], returns=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Callable', ctx=Load()), slice=Tuple(elts=[List(elts=[Constant(value='CodeGenerator'), Attribute(value=Name(id='nodes', ctx=Load()), attr='BinExpr', ctx=Load()), Constant(value='Frame')], ctx=Load()), Constant(value=None)], ctx=Load()), ctx=Load())), FunctionDef(name='_make_unop', args=arguments(posonlyargs=[], args=[arg(arg='op', annotation=Name(id='str', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[FunctionDef(name='visitor', args=arguments(posonlyargs=[], args=[arg(arg='self', annotation=Constant(value='CodeGenerator')), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='UnaryExpr', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[If(test=BoolOp(op=And(), values=[Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), attr='sandboxed', ctx=Load()), Compare(left=Name(id='op', ctx=Load()), ops=[In()], comparators=[Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), attr='intercepted_unops', ctx=Load())])]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[Constant(value='environment.call_unop(context, '), FormattedValue(value=Name(id='op', ctx=Load()), conversion=114), Constant(value=', ')])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='node', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[]))], orelse=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[BinOp(left=Constant(value='('), op=Add(), right=Name(id='op', ctx=Load()))], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='node', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[]))]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=')')], keywords=[]))], decorator_list=[Name(id='optimizeconst', ctx=Load())], returns=Constant(value=None)), Return(value=Name(id='visitor', ctx=Load()))], decorator_list=[], returns=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Callable', ctx=Load()), slice=Tuple(elts=[List(elts=[Constant(value='CodeGenerator'), Attribute(value=Name(id='nodes', ctx=Load()), attr='UnaryExpr', ctx=Load()), Constant(value='Frame')], ctx=Load()), Constant(value=None)], ctx=Load()), ctx=Load())), FunctionDef(name='generate', args=arguments(posonlyargs=[], args=[arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Template', ctx=Load())), arg(arg='environment', annotation=Constant(value='Environment')), arg(arg='name', annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Optional', ctx=Load()), slice=Name(id='str', ctx=Load()), ctx=Load())), arg(arg='filename', annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Optional', ctx=Load()), slice=Name(id='str', ctx=Load()), ctx=Load())), arg(arg='stream', annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Optional', ctx=Load()), slice=Attribute(value=Name(id='t', ctx=Load()), attr='TextIO', ctx=Load()), ctx=Load())), arg(arg='defer_init', annotation=Name(id='bool', ctx=Load())), arg(arg='optimized', annotation=Name(id='bool', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[Constant(value=None), Constant(value=False), Constant(value=True)]), body=[Expr(value=Constant(value='Generate the python source for a node tree.')), If(test=UnaryOp(op=Not(), operand=Call(func=Name(id='isinstance', ctx=Load()), args=[Name(id='node', ctx=Load()), Attribute(value=Name(id='nodes', ctx=Load()), attr='Template', ctx=Load())], keywords=[])), body=[Raise(exc=Call(func=Name(id='TypeError', ctx=Load()), args=[Constant(value="Can't compile non template nodes")], keywords=[]))], orelse=[]), Assign(targets=[Name(id='generator', ctx=Store())], value=Call(func=Attribute(value=Name(id='environment', ctx=Load()), attr='code_generator_class', ctx=Load()), args=[Name(id='environment', ctx=Load()), Name(id='name', ctx=Load()), Name(id='filename', ctx=Load()), Name(id='stream', ctx=Load()), Name(id='defer_init', ctx=Load()), Name(id='optimized', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='generator', ctx=Load()), attr='visit', ctx=Load()), args=[Name(id='node', ctx=Load())], keywords=[])), If(test=Compare(left=Name(id='stream', ctx=Load()), ops=[Is()], comparators=[Constant(value=None)]), body=[Return(value=Call(func=Attribute(value=Attribute(value=Name(id='generator', ctx=Load()), attr='stream', ctx=Load()), attr='getvalue', ctx=Load()), args=[], keywords=[]))], orelse=[]), Return(value=Constant(value=None))], decorator_list=[], returns=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Optional', ctx=Load()), slice=Name(id='str', ctx=Load()), ctx=Load())), FunctionDef(name='has_safe_repr', args=arguments(posonlyargs=[], args=[arg(arg='value', annotation=Attribute(value=Name(id='t', ctx=Load()), attr='Any', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Does the node have a safe representation?')), If(test=BoolOp(op=Or(), values=[Compare(left=Name(id='value', ctx=Load()), ops=[Is()], comparators=[Constant(value=None)]), Compare(left=Name(id='value', ctx=Load()), ops=[Is()], comparators=[Name(id='NotImplemented', ctx=Load())]), Compare(left=Name(id='value', ctx=Load()), ops=[Is()], comparators=[Name(id='Ellipsis', ctx=Load())])]), body=[Return(value=Constant(value=True))], orelse=[]), If(test=Compare(left=Call(func=Name(id='type', ctx=Load()), args=[Name(id='value', ctx=Load())], keywords=[]), ops=[In()], comparators=[Set(elts=[Name(id='bool', ctx=Load()), Name(id='int', ctx=Load()), Name(id='float', ctx=Load()), Name(id='complex', ctx=Load()), Name(id='range', ctx=Load()), Name(id='str', ctx=Load()), Name(id='Markup', ctx=Load())])]), body=[Return(value=Constant(value=True))], orelse=[]), If(test=Compare(left=Call(func=Name(id='type', ctx=Load()), args=[Name(id='value', ctx=Load())], keywords=[]), ops=[In()], comparators=[Set(elts=[Name(id='tuple', ctx=Load()), Name(id='list', ctx=Load()), Name(id='set', ctx=Load()), Name(id='frozenset', ctx=Load())])]), body=[Return(value=Call(func=Name(id='all', ctx=Load()), args=[GeneratorExp(elt=Call(func=Name(id='has_safe_repr', ctx=Load()), args=[Name(id='v', ctx=Load())], keywords=[]), generators=[comprehension(target=Name(id='v', ctx=Store()), iter=Name(id='value', ctx=Load()), ifs=[], is_async=0)])], keywords=[]))], orelse=[]), If(test=Compare(left=Call(func=Name(id='type', ctx=Load()), args=[Name(id='value', ctx=Load())], keywords=[]), ops=[Is()], comparators=[Name(id='dict', ctx=Load())]), body=[Return(value=Call(func=Name(id='all', ctx=Load()), args=[GeneratorExp(elt=BoolOp(op=And(), values=[Call(func=Name(id='has_safe_repr', ctx=Load()), args=[Name(id='k', ctx=Load())], keywords=[]), Call(func=Name(id='has_safe_repr', ctx=Load()), args=[Name(id='v', ctx=Load())], keywords=[])]), generators=[comprehension(target=Tuple(elts=[Name(id='k', ctx=Store()), Name(id='v', ctx=Store())], ctx=Store()), iter=Call(func=Attribute(value=Name(id='value', ctx=Load()), attr='items', ctx=Load()), args=[], keywords=[]), ifs=[], is_async=0)])], keywords=[]))], orelse=[]), Return(value=Constant(value=False))], decorator_list=[], returns=Name(id='bool', ctx=Load())), FunctionDef(name='find_undeclared', args=arguments(posonlyargs=[], args=[arg(arg='nodes', annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Iterable', ctx=Load()), slice=Attribute(value=Name(id='nodes', ctx=Load()), attr='Node', ctx=Load()), ctx=Load())), arg(arg='names', annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Iterable', ctx=Load()), slice=Name(id='str', ctx=Load()), ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Check if the names passed are accessed undeclared.  The return value\n    is a set of all the undeclared names from the sequence of names found.\n    ')), Assign(targets=[Name(id='visitor', ctx=Store())], value=Call(func=Name(id='UndeclaredNameVisitor', ctx=Load()), args=[Name(id='names', ctx=Load())], keywords=[])), Try(body=[For(target=Name(id='node', ctx=Store()), iter=Name(id='nodes', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='visitor', ctx=Load()), attr='visit', ctx=Load()), args=[Name(id='node', ctx=Load())], keywords=[]))], orelse=[])], handlers=[ExceptHandler(type=Name(id='VisitorExit', ctx=Load()), body=[Pass()])], orelse=[], finalbody=[]), Return(value=Attribute(value=Name(id='visitor', ctx=Load()), attr='undeclared', ctx=Load()))], decorator_list=[], returns=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Set', ctx=Load()), slice=Name(id='str', ctx=Load()), ctx=Load())), ClassDef(name='MacroRef', bases=[], keywords=[], body=[FunctionDef(name='__init__', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Union', ctx=Load()), slice=Tuple(elts=[Attribute(value=Name(id='nodes', ctx=Load()), attr='Macro', ctx=Load()), Attribute(value=Name(id='nodes', ctx=Load()), attr='CallBlock', ctx=Load())], ctx=Load()), ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='node', ctx=Store())], value=Name(id='node', ctx=Load())), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='accesses_caller', ctx=Store())], value=Constant(value=False)), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='accesses_kwargs', ctx=Store())], value=Constant(value=False)), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='accesses_varargs', ctx=Store())], value=Constant(value=False))], decorator_list=[], returns=Constant(value=None))], decorator_list=[]), ClassDef(name='Frame', bases=[], keywords=[], body=[Expr(value=Constant(value='Holds compile time information for us.')), FunctionDef(name='__init__', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='eval_ctx', annotation=Name(id='EvalContext', ctx=Load())), arg(arg='parent', annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Optional', ctx=Load()), slice=Constant(value='Frame'), ctx=Load())), arg(arg='level', annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Optional', ctx=Load()), slice=Name(id='int', ctx=Load()), ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[Constant(value=None), Constant(value=None)]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='eval_ctx', ctx=Store())], value=Name(id='eval_ctx', ctx=Load())), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='parent', ctx=Store())], value=Name(id='parent', ctx=Load())), If(test=Compare(left=Name(id='parent', ctx=Load()), ops=[Is()], comparators=[Constant(value=None)]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='symbols', ctx=Store())], value=Call(func=Name(id='Symbols', ctx=Load()), args=[], keywords=[keyword(arg='level', value=Name(id='level', ctx=Load()))])), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='require_output_check', ctx=Store())], value=Constant(value=False)), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load()), attr='buffer', ctx=Store()), annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Optional', ctx=Load()), slice=Name(id='str', ctx=Load()), ctx=Load()), value=Constant(value=None), simple=0), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load()), attr='block', ctx=Store()), annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Optional', ctx=Load()), slice=Name(id='str', ctx=Load()), ctx=Load()), value=Constant(value=None), simple=0)], orelse=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='symbols', ctx=Store())], value=Call(func=Name(id='Symbols', ctx=Load()), args=[Attribute(value=Name(id='parent', ctx=Load()), attr='symbols', ctx=Load())], keywords=[keyword(arg='level', value=Name(id='level', ctx=Load()))])), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='require_output_check', ctx=Store())], value=Attribute(value=Name(id='parent', ctx=Load()), attr='require_output_check', ctx=Load())), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='buffer', ctx=Store())], value=Attribute(value=Name(id='parent', ctx=Load()), attr='buffer', ctx=Load())), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='block', ctx=Store())], value=Attribute(value=Name(id='parent', ctx=Load()), attr='block', ctx=Load()))]), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='toplevel', ctx=Store())], value=Constant(value=False)), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='rootlevel', ctx=Store())], value=Constant(value=False)), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='loop_frame', ctx=Store())], value=Constant(value=False)), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='block_frame', ctx=Store())], value=Constant(value=False)), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='soft_frame', ctx=Store())], value=Constant(value=False))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='copy', args=arguments(posonlyargs=[], args=[arg(arg='self')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Create a copy of the current one.')), Assign(targets=[Name(id='rv', ctx=Store())], value=Call(func=Attribute(value=Name(id='object', ctx=Load()), attr='__new__', ctx=Load()), args=[Attribute(value=Name(id='self', ctx=Load()), attr='__class__', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='rv', ctx=Load()), attr='__dict__', ctx=Load()), attr='update', ctx=Load()), args=[Attribute(value=Name(id='self', ctx=Load()), attr='__dict__', ctx=Load())], keywords=[])), Assign(targets=[Attribute(value=Name(id='rv', ctx=Load()), attr='symbols', ctx=Store())], value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='symbols', ctx=Load()), attr='copy', ctx=Load()), args=[], keywords=[])), Return(value=Name(id='rv', ctx=Load()))], decorator_list=[], returns=Constant(value='Frame')), FunctionDef(name='inner', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='isolated', annotation=Name(id='bool', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[Constant(value=False)]), body=[Expr(value=Constant(value='Return an inner frame.')), If(test=Name(id='isolated', ctx=Load()), body=[Return(value=Call(func=Name(id='Frame', ctx=Load()), args=[Attribute(value=Name(id='self', ctx=Load()), attr='eval_ctx', ctx=Load())], keywords=[keyword(arg='level', value=BinOp(left=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='symbols', ctx=Load()), attr='level', ctx=Load()), op=Add(), right=Constant(value=1)))]))], orelse=[]), Return(value=Call(func=Name(id='Frame', ctx=Load()), args=[Attribute(value=Name(id='self', ctx=Load()), attr='eval_ctx', ctx=Load()), Name(id='self', ctx=Load())], keywords=[]))], decorator_list=[], returns=Constant(value='Frame')), FunctionDef(name='soft', args=arguments(posonlyargs=[], args=[arg(arg='self')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value="Return a soft frame.  A soft frame may not be modified as\n        standalone thing as it shares the resources with the frame it\n        was created of, but it's not a rootlevel frame any longer.\n\n        This is only used to implement if-statements and conditional\n        expressions.\n        ")), Assign(targets=[Name(id='rv', ctx=Store())], value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='copy', ctx=Load()), args=[], keywords=[])), Assign(targets=[Attribute(value=Name(id='rv', ctx=Load()), attr='rootlevel', ctx=Store())], value=Constant(value=False)), Assign(targets=[Attribute(value=Name(id='rv', ctx=Load()), attr='soft_frame', ctx=Store())], value=Constant(value=True)), Return(value=Name(id='rv', ctx=Load()))], decorator_list=[], returns=Constant(value='Frame')), Assign(targets=[Name(id='__copy__', ctx=Store())], value=Name(id='copy', ctx=Load()))], decorator_list=[]), ClassDef(name='VisitorExit', bases=[Name(id='RuntimeError', ctx=Load())], keywords=[], body=[Expr(value=Constant(value='Exception used by the `UndeclaredNameVisitor` to signal a stop.'))], decorator_list=[]), ClassDef(name='DependencyFinderVisitor', bases=[Name(id='NodeVisitor', ctx=Load())], keywords=[], body=[Expr(value=Constant(value='A visitor that collects filter and test calls.')), FunctionDef(name='__init__', args=arguments(posonlyargs=[], args=[arg(arg='self')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[AnnAssign(target=Attribute(value=Name(id='self', ctx=Load()), attr='filters', ctx=Store()), annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Set', ctx=Load()), slice=Name(id='str', ctx=Load()), ctx=Load()), value=Call(func=Name(id='set', ctx=Load()), args=[], keywords=[]), simple=0), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load()), attr='tests', ctx=Store()), annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Set', ctx=Load()), slice=Name(id='str', ctx=Load()), ctx=Load()), value=Call(func=Name(id='set', ctx=Load()), args=[], keywords=[]), simple=0)], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_Filter', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Filter', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='generic_visit', ctx=Load()), args=[Name(id='node', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='filters', ctx=Load()), attr='add', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='name', ctx=Load())], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_Test', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Test', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='generic_visit', ctx=Load()), args=[Name(id='node', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='tests', ctx=Load()), attr='add', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='name', ctx=Load())], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_Block', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Block', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Stop visiting at blocks.'))], decorator_list=[], returns=Constant(value=None))], decorator_list=[]), ClassDef(name='UndeclaredNameVisitor', bases=[Name(id='NodeVisitor', ctx=Load())], keywords=[], body=[Expr(value=Constant(value='A visitor that checks if a name is accessed without being\n    declared.  This is different from the frame visitor as it will\n    not stop at closure frames.\n    ')), FunctionDef(name='__init__', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='names', annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Iterable', ctx=Load()), slice=Name(id='str', ctx=Load()), ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='names', ctx=Store())], value=Call(func=Name(id='set', ctx=Load()), args=[Name(id='names', ctx=Load())], keywords=[])), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load()), attr='undeclared', ctx=Store()), annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Set', ctx=Load()), slice=Name(id='str', ctx=Load()), ctx=Load()), value=Call(func=Name(id='set', ctx=Load()), args=[], keywords=[]), simple=0)], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_Name', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Name', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[If(test=BoolOp(op=And(), values=[Compare(left=Attribute(value=Name(id='node', ctx=Load()), attr='ctx', ctx=Load()), ops=[Eq()], comparators=[Constant(value='load')]), Compare(left=Attribute(value=Name(id='node', ctx=Load()), attr='name', ctx=Load()), ops=[In()], comparators=[Attribute(value=Name(id='self', ctx=Load()), attr='names', ctx=Load())])]), body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='undeclared', ctx=Load()), attr='add', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='name', ctx=Load())], keywords=[])), If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load()), attr='undeclared', ctx=Load()), ops=[Eq()], comparators=[Attribute(value=Name(id='self', ctx=Load()), attr='names', ctx=Load())]), body=[Raise(exc=Call(func=Name(id='VisitorExit', ctx=Load()), args=[], keywords=[]))], orelse=[])], orelse=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='names', ctx=Load()), attr='discard', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='name', ctx=Load())], keywords=[]))])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_Block', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Block', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Stop visiting a blocks.'))], decorator_list=[], returns=Constant(value=None))], decorator_list=[]), ClassDef(name='CompilerExit', bases=[Name(id='Exception', ctx=Load())], keywords=[], body=[Expr(value=Constant(value="Raised if the compiler encountered a situation where it just\n    doesn't make sense to further process the code.  Any block that\n    raises such an exception is not further processed.\n    "))], decorator_list=[]), ClassDef(name='CodeGenerator', bases=[Name(id='NodeVisitor', ctx=Load())], keywords=[], body=[FunctionDef(name='__init__', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='environment', annotation=Constant(value='Environment')), arg(arg='name', annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Optional', ctx=Load()), slice=Name(id='str', ctx=Load()), ctx=Load())), arg(arg='filename', annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Optional', ctx=Load()), slice=Name(id='str', ctx=Load()), ctx=Load())), arg(arg='stream', annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Optional', ctx=Load()), slice=Attribute(value=Name(id='t', ctx=Load()), attr='TextIO', ctx=Load()), ctx=Load())), arg(arg='defer_init', annotation=Name(id='bool', ctx=Load())), arg(arg='optimized', annotation=Name(id='bool', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[Constant(value=None), Constant(value=False), Constant(value=True)]), body=[If(test=Compare(left=Name(id='stream', ctx=Load()), ops=[Is()], comparators=[Constant(value=None)]), body=[Assign(targets=[Name(id='stream', ctx=Store())], value=Call(func=Name(id='StringIO', ctx=Load()), args=[], keywords=[]))], orelse=[]), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Store())], value=Name(id='environment', ctx=Load())), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='name', ctx=Store())], value=Name(id='name', ctx=Load())), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='filename', ctx=Store())], value=Name(id='filename', ctx=Load())), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='stream', ctx=Store())], value=Name(id='stream', ctx=Load())), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='created_block_context', ctx=Store())], value=Constant(value=False)), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='defer_init', ctx=Store())], value=Name(id='defer_init', ctx=Load())), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load()), attr='optimizer', ctx=Store()), annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Optional', ctx=Load()), slice=Name(id='Optimizer', ctx=Load()), ctx=Load()), value=Constant(value=None), simple=0), If(test=Name(id='optimized', ctx=Load()), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='optimizer', ctx=Store())], value=Call(func=Name(id='Optimizer', ctx=Load()), args=[Name(id='environment', ctx=Load())], keywords=[]))], orelse=[]), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load()), attr='import_aliases', ctx=Store()), annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Dict', ctx=Load()), slice=Tuple(elts=[Name(id='str', ctx=Load()), Name(id='str', ctx=Load())], ctx=Load()), ctx=Load()), value=Dict(keys=[], values=[]), simple=0), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load()), attr='blocks', ctx=Store()), annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Dict', ctx=Load()), slice=Tuple(elts=[Name(id='str', ctx=Load()), Attribute(value=Name(id='nodes', ctx=Load()), attr='Block', ctx=Load())], ctx=Load()), ctx=Load()), value=Dict(keys=[], values=[]), simple=0), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='extends_so_far', ctx=Store())], value=Constant(value=0)), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='has_known_extends', ctx=Store())], value=Constant(value=False)), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='code_lineno', ctx=Store())], value=Constant(value=1)), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load()), attr='tests', ctx=Store()), annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Dict', ctx=Load()), slice=Tuple(elts=[Name(id='str', ctx=Load()), Name(id='str', ctx=Load())], ctx=Load()), ctx=Load()), value=Dict(keys=[], values=[]), simple=0), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load()), attr='filters', ctx=Store()), annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Dict', ctx=Load()), slice=Tuple(elts=[Name(id='str', ctx=Load()), Name(id='str', ctx=Load())], ctx=Load()), ctx=Load()), value=Dict(keys=[], values=[]), simple=0), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load()), attr='debug_info', ctx=Store()), annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='List', ctx=Load()), slice=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Tuple', ctx=Load()), slice=Tuple(elts=[Name(id='int', ctx=Load()), Name(id='int', ctx=Load())], ctx=Load()), ctx=Load()), ctx=Load()), value=List(elts=[], ctx=Load()), simple=0), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load()), attr='_write_debug_info', ctx=Store()), annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Optional', ctx=Load()), slice=Name(id='int', ctx=Load()), ctx=Load()), value=Constant(value=None), simple=0), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='_new_lines', ctx=Store())], value=Constant(value=0)), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='_last_line', ctx=Store())], value=Constant(value=0)), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='_first_write', ctx=Store())], value=Constant(value=True)), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='_last_identifier', ctx=Store())], value=Constant(value=0)), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='_indentation', ctx=Store())], value=Constant(value=0)), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load()), attr='_assign_stack', ctx=Store()), annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='List', ctx=Load()), slice=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Set', ctx=Load()), slice=Name(id='str', ctx=Load()), ctx=Load()), ctx=Load()), value=List(elts=[], ctx=Load()), simple=0), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load()), attr='_param_def_block', ctx=Store()), annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='List', ctx=Load()), slice=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Set', ctx=Load()), slice=Name(id='str', ctx=Load()), ctx=Load()), ctx=Load()), value=List(elts=[], ctx=Load()), simple=0), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='_context_reference_stack', ctx=Store())], value=List(elts=[Constant(value='context')], ctx=Load()))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='optimized', args=arguments(posonlyargs=[], args=[arg(arg='self')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Return(value=Compare(left=Attribute(value=Name(id='self', ctx=Load()), attr='optimizer', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]))], decorator_list=[Name(id='property', ctx=Load())], returns=Name(id='bool', ctx=Load())), FunctionDef(name='fail', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='msg', annotation=Name(id='str', ctx=Load())), arg(arg='lineno', annotation=Name(id='int', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Fail with a :exc:`TemplateAssertionError`.')), Raise(exc=Call(func=Name(id='TemplateAssertionError', ctx=Load()), args=[Name(id='msg', ctx=Load()), Name(id='lineno', ctx=Load()), Attribute(value=Name(id='self', ctx=Load()), attr='name', ctx=Load()), Attribute(value=Name(id='self', ctx=Load()), attr='filename', ctx=Load())], keywords=[]))], decorator_list=[], returns=Constant(value='te.NoReturn')), FunctionDef(name='temporary_identifier', args=arguments(posonlyargs=[], args=[arg(arg='self')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Get a new unique identifier.')), AugAssign(target=Attribute(value=Name(id='self', ctx=Load()), attr='_last_identifier', ctx=Store()), op=Add(), value=Constant(value=1)), Return(value=JoinedStr(values=[Constant(value='t_'), FormattedValue(value=Attribute(value=Name(id='self', ctx=Load()), attr='_last_identifier', ctx=Load()), conversion=-1)]))], decorator_list=[], returns=Name(id='str', ctx=Load())), FunctionDef(name='buffer', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Enable buffering for the frame from that point onwards.')), Assign(targets=[Attribute(value=Name(id='frame', ctx=Load()), attr='buffer', ctx=Store())], value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='temporary_identifier', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Attribute(value=Name(id='frame', ctx=Load()), attr='buffer', ctx=Load()), conversion=-1), Constant(value=' = []')])], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='return_buffer_contents', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='frame', annotation=Name(id='Frame', ctx=Load())), arg(arg='force_unescaped', annotation=Name(id='bool', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[Constant(value=False)]), body=[Expr(value=Constant(value='Return the buffer contents of the frame.')), If(test=UnaryOp(op=Not(), operand=Name(id='force_unescaped', ctx=Load())), body=[If(test=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='eval_ctx', ctx=Load()), attr='volatile', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='if context.eval_ctx.autoescape:')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='return Markup(concat('), FormattedValue(value=Attribute(value=Name(id='frame', ctx=Load()), attr='buffer', ctx=Load()), conversion=-1), Constant(value='))')])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='else:')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='return concat('), FormattedValue(value=Attribute(value=Name(id='frame', ctx=Load()), attr='buffer', ctx=Load()), conversion=-1), Constant(value=')')])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[])), Return()], orelse=[If(test=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='eval_ctx', ctx=Load()), attr='autoescape', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='return Markup(concat('), FormattedValue(value=Attribute(value=Name(id='frame', ctx=Load()), attr='buffer', ctx=Load()), conversion=-1), Constant(value='))')])], keywords=[])), Return()], orelse=[])])], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='return concat('), FormattedValue(value=Attribute(value=Name(id='frame', ctx=Load()), attr='buffer', ctx=Load()), conversion=-1), Constant(value=')')])], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='indent', args=arguments(posonlyargs=[], args=[arg(arg='self')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Indent by one.')), AugAssign(target=Attribute(value=Name(id='self', ctx=Load()), attr='_indentation', ctx=Store()), op=Add(), value=Constant(value=1))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='outdent', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='step', annotation=Name(id='int', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[Constant(value=1)]), body=[Expr(value=Constant(value='Outdent by step.')), AugAssign(target=Attribute(value=Name(id='self', ctx=Load()), attr='_indentation', ctx=Store()), op=Sub(), value=Name(id='step', ctx=Load()))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='start_write', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='frame', annotation=Name(id='Frame', ctx=Load())), arg(arg='node', annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Optional', ctx=Load()), slice=Attribute(value=Name(id='nodes', ctx=Load()), attr='Node', ctx=Load()), ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[Constant(value=None)]), body=[Expr(value=Constant(value='Yield or write into the frame buffer.')), If(test=Compare(left=Attribute(value=Name(id='frame', ctx=Load()), attr='buffer', ctx=Load()), ops=[Is()], comparators=[Constant(value=None)]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='yield '), Name(id='node', ctx=Load())], keywords=[]))], orelse=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Attribute(value=Name(id='frame', ctx=Load()), attr='buffer', ctx=Load()), conversion=-1), Constant(value='.append(')]), Name(id='node', ctx=Load())], keywords=[]))])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='end_write', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='End the writing process started by `start_write`.')), If(test=Compare(left=Attribute(value=Name(id='frame', ctx=Load()), attr='buffer', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=')')], keywords=[]))], orelse=[])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='simple_write', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='s', annotation=Name(id='str', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load())), arg(arg='node', annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Optional', ctx=Load()), slice=Attribute(value=Name(id='nodes', ctx=Load()), attr='Node', ctx=Load()), ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[Constant(value=None)]), body=[Expr(value=Constant(value='Simple shortcut for start_write + write + end_write.')), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='start_write', ctx=Load()), args=[Name(id='frame', ctx=Load()), Name(id='node', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Name(id='s', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='end_write', ctx=Load()), args=[Name(id='frame', ctx=Load())], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='blockvisit', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='nodes', annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Iterable', ctx=Load()), slice=Attribute(value=Name(id='nodes', ctx=Load()), attr='Node', ctx=Load()), ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Visit a list of nodes as block in a frame.  If the current frame\n        is no buffer a dummy ``if 0: yield None`` is written automatically.\n        ')), Try(body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='pass')], keywords=[])), For(target=Name(id='node', ctx=Store()), iter=Name(id='nodes', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Name(id='node', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[]))], orelse=[])], handlers=[ExceptHandler(type=Name(id='CompilerExit', ctx=Load()), body=[Pass()])], orelse=[], finalbody=[])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='write', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='x', annotation=Name(id='str', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Write a string into the output stream.')), If(test=Attribute(value=Name(id='self', ctx=Load()), attr='_new_lines', ctx=Load()), body=[If(test=UnaryOp(op=Not(), operand=Attribute(value=Name(id='self', ctx=Load()), attr='_first_write', ctx=Load())), body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='stream', ctx=Load()), attr='write', ctx=Load()), args=[BinOp(left=Constant(value='\n'), op=Mult(), right=Attribute(value=Name(id='self', ctx=Load()), attr='_new_lines', ctx=Load()))], keywords=[])), AugAssign(target=Attribute(value=Name(id='self', ctx=Load()), attr='code_lineno', ctx=Store()), op=Add(), value=Attribute(value=Name(id='self', ctx=Load()), attr='_new_lines', ctx=Load())), If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load()), attr='_write_debug_info', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='debug_info', ctx=Load()), attr='append', ctx=Load()), args=[Tuple(elts=[Attribute(value=Name(id='self', ctx=Load()), attr='_write_debug_info', ctx=Load()), Attribute(value=Name(id='self', ctx=Load()), attr='code_lineno', ctx=Load())], ctx=Load())], keywords=[])), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='_write_debug_info', ctx=Store())], value=Constant(value=None))], orelse=[])], orelse=[]), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='_first_write', ctx=Store())], value=Constant(value=False)), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='stream', ctx=Load()), attr='write', ctx=Load()), args=[BinOp(left=Constant(value='    '), op=Mult(), right=Attribute(value=Name(id='self', ctx=Load()), attr='_indentation', ctx=Load()))], keywords=[])), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='_new_lines', ctx=Store())], value=Constant(value=0))], orelse=[]), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='stream', ctx=Load()), attr='write', ctx=Load()), args=[Name(id='x', ctx=Load())], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='writeline', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='x', annotation=Name(id='str', ctx=Load())), arg(arg='node', annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Optional', ctx=Load()), slice=Attribute(value=Name(id='nodes', ctx=Load()), attr='Node', ctx=Load()), ctx=Load())), arg(arg='extra', annotation=Name(id='int', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[Constant(value=None), Constant(value=0)]), body=[Expr(value=Constant(value='Combination of newline and write.')), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='newline', ctx=Load()), args=[Name(id='node', ctx=Load()), Name(id='extra', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Name(id='x', ctx=Load())], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='newline', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Optional', ctx=Load()), slice=Attribute(value=Name(id='nodes', ctx=Load()), attr='Node', ctx=Load()), ctx=Load())), arg(arg='extra', annotation=Name(id='int', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[Constant(value=None), Constant(value=0)]), body=[Expr(value=Constant(value='Add one or more newlines before the next write.')), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='_new_lines', ctx=Store())], value=Call(func=Name(id='max', ctx=Load()), args=[Attribute(value=Name(id='self', ctx=Load()), attr='_new_lines', ctx=Load()), BinOp(left=Constant(value=1), op=Add(), right=Name(id='extra', ctx=Load()))], keywords=[])), If(test=BoolOp(op=And(), values=[Compare(left=Name(id='node', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), Compare(left=Attribute(value=Name(id='node', ctx=Load()), attr='lineno', ctx=Load()), ops=[NotEq()], comparators=[Attribute(value=Name(id='self', ctx=Load()), attr='_last_line', ctx=Load())])]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='_write_debug_info', ctx=Store())], value=Attribute(value=Name(id='node', ctx=Load()), attr='lineno', ctx=Load())), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='_last_line', ctx=Store())], value=Attribute(value=Name(id='node', ctx=Load()), attr='lineno', ctx=Load()))], orelse=[])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='signature', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Union', ctx=Load()), slice=Tuple(elts=[Attribute(value=Name(id='nodes', ctx=Load()), attr='Call', ctx=Load()), Attribute(value=Name(id='nodes', ctx=Load()), attr='Filter', ctx=Load()), Attribute(value=Name(id='nodes', ctx=Load()), attr='Test', ctx=Load())], ctx=Load()), ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load())), arg(arg='extra_kwargs', annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Optional', ctx=Load()), slice=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Mapping', ctx=Load()), slice=Tuple(elts=[Name(id='str', ctx=Load()), Attribute(value=Name(id='t', ctx=Load()), attr='Any', ctx=Load())], ctx=Load()), ctx=Load()), ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[Constant(value=None)]), body=[Expr(value=Constant(value='Writes a function call to the stream for the current node.\n        A leading comma is added automatically.  The extra keyword\n        arguments may not include python keywords otherwise a syntax\n        error could occur.  The extra keyword arguments should be given\n        as python dict.\n        ')), Assign(targets=[Name(id='kwarg_workaround', ctx=Store())], value=Call(func=Name(id='any', ctx=Load()), args=[GeneratorExp(elt=Call(func=Name(id='is_python_keyword', ctx=Load()), args=[Call(func=Attribute(value=Name(id='t', ctx=Load()), attr='cast', ctx=Load()), args=[Name(id='str', ctx=Load()), Name(id='k', ctx=Load())], keywords=[])], keywords=[]), generators=[comprehension(target=Name(id='k', ctx=Store()), iter=Call(func=Name(id='chain', ctx=Load()), args=[GeneratorExp(elt=Attribute(value=Name(id='x', ctx=Load()), attr='key', ctx=Load()), generators=[comprehension(target=Name(id='x', ctx=Store()), iter=Attribute(value=Name(id='node', ctx=Load()), attr='kwargs', ctx=Load()), ifs=[], is_async=0)]), BoolOp(op=Or(), values=[Name(id='extra_kwargs', ctx=Load()), Tuple(elts=[], ctx=Load())])], keywords=[]), ifs=[], is_async=0)])], keywords=[])), For(target=Name(id='arg', ctx=Store()), iter=Attribute(value=Name(id='node', ctx=Load()), attr='args', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=', ')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Name(id='arg', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[]))], orelse=[]), If(test=UnaryOp(op=Not(), operand=Name(id='kwarg_workaround', ctx=Load())), body=[For(target=Name(id='kwarg', ctx=Store()), iter=Attribute(value=Name(id='node', ctx=Load()), attr='kwargs', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=', ')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Name(id='kwarg', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[]))], orelse=[]), If(test=Compare(left=Name(id='extra_kwargs', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[For(target=Tuple(elts=[Name(id='key', ctx=Store()), Name(id='value', ctx=Store())], ctx=Store()), iter=Call(func=Attribute(value=Name(id='extra_kwargs', ctx=Load()), attr='items', ctx=Load()), args=[], keywords=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[Constant(value=', '), FormattedValue(value=Name(id='key', ctx=Load()), conversion=-1), Constant(value='='), FormattedValue(value=Name(id='value', ctx=Load()), conversion=-1)])], keywords=[]))], orelse=[])], orelse=[])], orelse=[]), If(test=Attribute(value=Name(id='node', ctx=Load()), attr='dyn_args', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=', *')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='dyn_args', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[]))], orelse=[]), If(test=Name(id='kwarg_workaround', ctx=Load()), body=[If(test=Compare(left=Attribute(value=Name(id='node', ctx=Load()), attr='dyn_kwargs', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=', **dict({')], keywords=[]))], orelse=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=', **{')], keywords=[]))]), For(target=Name(id='kwarg', ctx=Store()), iter=Attribute(value=Name(id='node', ctx=Load()), attr='kwargs', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Attribute(value=Name(id='kwarg', ctx=Load()), attr='key', ctx=Load()), conversion=114), Constant(value=': ')])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='kwarg', ctx=Load()), attr='value', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=', ')], keywords=[]))], orelse=[]), If(test=Compare(left=Name(id='extra_kwargs', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[For(target=Tuple(elts=[Name(id='key', ctx=Store()), Name(id='value', ctx=Store())], ctx=Store()), iter=Call(func=Attribute(value=Name(id='extra_kwargs', ctx=Load()), attr='items', ctx=Load()), args=[], keywords=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Name(id='key', ctx=Load()), conversion=114), Constant(value=': '), FormattedValue(value=Name(id='value', ctx=Load()), conversion=-1), Constant(value=', ')])], keywords=[]))], orelse=[])], orelse=[]), If(test=Compare(left=Attribute(value=Name(id='node', ctx=Load()), attr='dyn_kwargs', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='}, **')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='dyn_kwargs', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=')')], keywords=[]))], orelse=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='}')], keywords=[]))])], orelse=[If(test=Compare(left=Attribute(value=Name(id='node', ctx=Load()), attr='dyn_kwargs', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=', **')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='dyn_kwargs', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[]))], orelse=[])])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='pull_dependencies', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='nodes', annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Iterable', ctx=Load()), slice=Attribute(value=Name(id='nodes', ctx=Load()), attr='Node', ctx=Load()), ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Find all filter and test names used in the template and\n        assign them to variables in the compiled namespace. Checking\n        that the names are registered with the environment is done when\n        compiling the Filter and Test nodes. If the node is in an If or\n        CondExpr node, the check is done at runtime instead.\n\n        .. versionchanged:: 3.0\n            Filters and tests in If and CondExpr nodes are checked at\n            runtime instead of compile time.\n        ')), Assign(targets=[Name(id='visitor', ctx=Store())], value=Call(func=Name(id='DependencyFinderVisitor', ctx=Load()), args=[], keywords=[])), For(target=Name(id='node', ctx=Store()), iter=Name(id='nodes', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='visitor', ctx=Load()), attr='visit', ctx=Load()), args=[Name(id='node', ctx=Load())], keywords=[]))], orelse=[]), For(target=Tuple(elts=[Name(id='id_map', ctx=Store()), Name(id='names', ctx=Store()), Name(id='dependency', ctx=Store())], ctx=Store()), iter=Tuple(elts=[Tuple(elts=[Attribute(value=Name(id='self', ctx=Load()), attr='filters', ctx=Load()), Attribute(value=Name(id='visitor', ctx=Load()), attr='filters', ctx=Load()), Constant(value='filters')], ctx=Load()), Tuple(elts=[Attribute(value=Name(id='self', ctx=Load()), attr='tests', ctx=Load()), Attribute(value=Name(id='visitor', ctx=Load()), attr='tests', ctx=Load()), Constant(value='tests')], ctx=Load())], ctx=Load()), body=[For(target=Name(id='name', ctx=Store()), iter=Call(func=Name(id='sorted', ctx=Load()), args=[Name(id='names', ctx=Load())], keywords=[]), body=[If(test=Compare(left=Name(id='name', ctx=Load()), ops=[NotIn()], comparators=[Name(id='id_map', ctx=Load())]), body=[Assign(targets=[Subscript(value=Name(id='id_map', ctx=Load()), slice=Name(id='name', ctx=Load()), ctx=Store())], value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='temporary_identifier', ctx=Load()), args=[], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='try:')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Subscript(value=Name(id='id_map', ctx=Load()), slice=Name(id='name', ctx=Load()), ctx=Load()), conversion=-1), Constant(value=' = environment.'), FormattedValue(value=Name(id='dependency', ctx=Load()), conversion=-1), Constant(value='['), FormattedValue(value=Name(id='name', ctx=Load()), conversion=114), Constant(value=']')])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='except KeyError:')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='@internalcode')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='def '), FormattedValue(value=Subscript(value=Name(id='id_map', ctx=Load()), slice=Name(id='name', ctx=Load()), ctx=Load()), conversion=-1), Constant(value='(*unused):')])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='raise TemplateRuntimeError("No '), FormattedValue(value=Subscript(value=Name(id='dependency', ctx=Load()), slice=Slice(upper=UnaryOp(op=USub(), operand=Constant(value=1))), ctx=Load()), conversion=-1), Constant(value=' named '), FormattedValue(value=Name(id='name', ctx=Load()), conversion=114), Constant(value=' found.")')])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[]))], orelse=[])], orelse=[])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='enter_frame', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='undefs', ctx=Store())], value=List(elts=[], ctx=Load())), For(target=Tuple(elts=[Name(id='target', ctx=Store()), Tuple(elts=[Name(id='action', ctx=Store()), Name(id='param', ctx=Store())], ctx=Store())], ctx=Store()), iter=Call(func=Attribute(value=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='symbols', ctx=Load()), attr='loads', ctx=Load()), attr='items', ctx=Load()), args=[], keywords=[]), body=[If(test=Compare(left=Name(id='action', ctx=Load()), ops=[Eq()], comparators=[Name(id='VAR_LOAD_PARAMETER', ctx=Load())]), body=[Pass()], orelse=[If(test=Compare(left=Name(id='action', ctx=Load()), ops=[Eq()], comparators=[Name(id='VAR_LOAD_RESOLVE', ctx=Load())]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Name(id='target', ctx=Load()), conversion=-1), Constant(value=' = '), FormattedValue(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='get_resolve_func', ctx=Load()), args=[], keywords=[]), conversion=-1), Constant(value='('), FormattedValue(value=Name(id='param', ctx=Load()), conversion=114), Constant(value=')')])], keywords=[]))], orelse=[If(test=Compare(left=Name(id='action', ctx=Load()), ops=[Eq()], comparators=[Name(id='VAR_LOAD_ALIAS', ctx=Load())]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Name(id='target', ctx=Load()), conversion=-1), Constant(value=' = '), FormattedValue(value=Name(id='param', ctx=Load()), conversion=-1)])], keywords=[]))], orelse=[If(test=Compare(left=Name(id='action', ctx=Load()), ops=[Eq()], comparators=[Name(id='VAR_LOAD_UNDEFINED', ctx=Load())]), body=[Expr(value=Call(func=Attribute(value=Name(id='undefs', ctx=Load()), attr='append', ctx=Load()), args=[Name(id='target', ctx=Load())], keywords=[]))], orelse=[Raise(exc=Call(func=Name(id='NotImplementedError', ctx=Load()), args=[Constant(value='unknown load instruction')], keywords=[]))])])])])], orelse=[]), If(test=Name(id='undefs', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Call(func=Attribute(value=Constant(value=' = '), attr='join', ctx=Load()), args=[Name(id='undefs', ctx=Load())], keywords=[]), conversion=-1), Constant(value=' = missing')])], keywords=[]))], orelse=[])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='leave_frame', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='frame', annotation=Name(id='Frame', ctx=Load())), arg(arg='with_python_scope', annotation=Name(id='bool', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[Constant(value=False)]), body=[If(test=UnaryOp(op=Not(), operand=Name(id='with_python_scope', ctx=Load())), body=[Assign(targets=[Name(id='undefs', ctx=Store())], value=List(elts=[], ctx=Load())), For(target=Name(id='target', ctx=Store()), iter=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='symbols', ctx=Load()), attr='loads', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='undefs', ctx=Load()), attr='append', ctx=Load()), args=[Name(id='target', ctx=Load())], keywords=[]))], orelse=[]), If(test=Name(id='undefs', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Call(func=Attribute(value=Constant(value=' = '), attr='join', ctx=Load()), args=[Name(id='undefs', ctx=Load())], keywords=[]), conversion=-1), Constant(value=' = missing')])], keywords=[]))], orelse=[])], orelse=[])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='choose_async', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='async_value', annotation=Name(id='str', ctx=Load())), arg(arg='sync_value', annotation=Name(id='str', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[Constant(value='async '), Constant(value='')]), body=[Return(value=IfExp(test=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), attr='is_async', ctx=Load()), body=Name(id='async_value', ctx=Load()), orelse=Name(id='sync_value', ctx=Load())))], decorator_list=[], returns=Name(id='str', ctx=Load())), FunctionDef(name='func', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='name', annotation=Name(id='str', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Return(value=JoinedStr(values=[FormattedValue(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='choose_async', ctx=Load()), args=[], keywords=[]), conversion=-1), Constant(value='def '), FormattedValue(value=Name(id='name', ctx=Load()), conversion=-1)]))], decorator_list=[], returns=Name(id='str', ctx=Load())), FunctionDef(name='macro_body', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Union', ctx=Load()), slice=Tuple(elts=[Attribute(value=Name(id='nodes', ctx=Load()), attr='Macro', ctx=Load()), Attribute(value=Name(id='nodes', ctx=Load()), attr='CallBlock', ctx=Load())], ctx=Load()), ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Dump the function def of a macro or call block.')), Assign(targets=[Name(id='frame', ctx=Store())], value=Call(func=Attribute(value=Name(id='frame', ctx=Load()), attr='inner', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='symbols', ctx=Load()), attr='analyze_node', ctx=Load()), args=[Name(id='node', ctx=Load())], keywords=[])), Assign(targets=[Name(id='macro_ref', ctx=Store())], value=Call(func=Name(id='MacroRef', ctx=Load()), args=[Name(id='node', ctx=Load())], keywords=[])), Assign(targets=[Name(id='explicit_caller', ctx=Store())], value=Constant(value=None)), Assign(targets=[Name(id='skip_special_params', ctx=Store())], value=Call(func=Name(id='set', ctx=Load()), args=[], keywords=[])), Assign(targets=[Name(id='args', ctx=Store())], value=List(elts=[], ctx=Load())), For(target=Tuple(elts=[Name(id='idx', ctx=Store()), Name(id='arg', ctx=Store())], ctx=Store()), iter=Call(func=Name(id='enumerate', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='args', ctx=Load())], keywords=[]), body=[If(test=Compare(left=Attribute(value=Name(id='arg', ctx=Load()), attr='name', ctx=Load()), ops=[Eq()], comparators=[Constant(value='caller')]), body=[Assign(targets=[Name(id='explicit_caller', ctx=Store())], value=Name(id='idx', ctx=Load()))], orelse=[]), If(test=Compare(left=Attribute(value=Name(id='arg', ctx=Load()), attr='name', ctx=Load()), ops=[In()], comparators=[Tuple(elts=[Constant(value='kwargs'), Constant(value='varargs')], ctx=Load())]), body=[Expr(value=Call(func=Attribute(value=Name(id='skip_special_params', ctx=Load()), attr='add', ctx=Load()), args=[Attribute(value=Name(id='arg', ctx=Load()), attr='name', ctx=Load())], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='args', ctx=Load()), attr='append', ctx=Load()), args=[Call(func=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='symbols', ctx=Load()), attr='ref', ctx=Load()), args=[Attribute(value=Name(id='arg', ctx=Load()), attr='name', ctx=Load())], keywords=[])], keywords=[]))], orelse=[]), Assign(targets=[Name(id='undeclared', ctx=Store())], value=Call(func=Name(id='find_undeclared', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='body', ctx=Load()), Tuple(elts=[Constant(value='caller'), Constant(value='kwargs'), Constant(value='varargs')], ctx=Load())], keywords=[])), If(test=Compare(left=Constant(value='caller'), ops=[In()], comparators=[Name(id='undeclared', ctx=Load())]), body=[If(test=Compare(left=Name(id='explicit_caller', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[Try(body=[Expr(value=Subscript(value=Attribute(value=Name(id='node', ctx=Load()), attr='defaults', ctx=Load()), slice=BinOp(left=Name(id='explicit_caller', ctx=Load()), op=Sub(), right=Call(func=Name(id='len', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='args', ctx=Load())], keywords=[])), ctx=Load()))], handlers=[ExceptHandler(type=Name(id='IndexError', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='fail', ctx=Load()), args=[Constant(value='When defining macros or call blocks the special "caller" argument must be omitted or be given a default.'), Attribute(value=Name(id='node', ctx=Load()), attr='lineno', ctx=Load())], keywords=[]))])], orelse=[], finalbody=[])], orelse=[Expr(value=Call(func=Attribute(value=Name(id='args', ctx=Load()), attr='append', ctx=Load()), args=[Call(func=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='symbols', ctx=Load()), attr='declare_parameter', ctx=Load()), args=[Constant(value='caller')], keywords=[])], keywords=[]))]), Assign(targets=[Attribute(value=Name(id='macro_ref', ctx=Load()), attr='accesses_caller', ctx=Store())], value=Constant(value=True))], orelse=[]), If(test=BoolOp(op=And(), values=[Compare(left=Constant(value='kwargs'), ops=[In()], comparators=[Name(id='undeclared', ctx=Load())]), Compare(left=Constant(value='kwargs'), ops=[NotIn()], comparators=[Name(id='skip_special_params', ctx=Load())])]), body=[Expr(value=Call(func=Attribute(value=Name(id='args', ctx=Load()), attr='append', ctx=Load()), args=[Call(func=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='symbols', ctx=Load()), attr='declare_parameter', ctx=Load()), args=[Constant(value='kwargs')], keywords=[])], keywords=[])), Assign(targets=[Attribute(value=Name(id='macro_ref', ctx=Load()), attr='accesses_kwargs', ctx=Store())], value=Constant(value=True))], orelse=[]), If(test=BoolOp(op=And(), values=[Compare(left=Constant(value='varargs'), ops=[In()], comparators=[Name(id='undeclared', ctx=Load())]), Compare(left=Constant(value='varargs'), ops=[NotIn()], comparators=[Name(id='skip_special_params', ctx=Load())])]), body=[Expr(value=Call(func=Attribute(value=Name(id='args', ctx=Load()), attr='append', ctx=Load()), args=[Call(func=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='symbols', ctx=Load()), attr='declare_parameter', ctx=Load()), args=[Constant(value='varargs')], keywords=[])], keywords=[])), Assign(targets=[Attribute(value=Name(id='macro_ref', ctx=Load()), attr='accesses_varargs', ctx=Store())], value=Constant(value=True))], orelse=[]), Assign(targets=[Attribute(value=Name(id='frame', ctx=Load()), attr='require_output_check', ctx=Store())], value=Constant(value=False)), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='symbols', ctx=Load()), attr='analyze_node', ctx=Load()), args=[Name(id='node', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='func', ctx=Load()), args=[Constant(value='macro')], keywords=[]), conversion=-1), Constant(value='('), FormattedValue(value=Call(func=Attribute(value=Constant(value=', '), attr='join', ctx=Load()), args=[Name(id='args', ctx=Load())], keywords=[]), conversion=-1), Constant(value='):')]), Name(id='node', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='buffer', ctx=Load()), args=[Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='enter_frame', ctx=Load()), args=[Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='push_parameter_definitions', ctx=Load()), args=[Name(id='frame', ctx=Load())], keywords=[])), For(target=Tuple(elts=[Name(id='idx', ctx=Store()), Name(id='arg', ctx=Store())], ctx=Store()), iter=Call(func=Name(id='enumerate', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='args', ctx=Load())], keywords=[]), body=[Assign(targets=[Name(id='ref', ctx=Store())], value=Call(func=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='symbols', ctx=Load()), attr='ref', ctx=Load()), args=[Attribute(value=Name(id='arg', ctx=Load()), attr='name', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='if '), FormattedValue(value=Name(id='ref', ctx=Load()), conversion=-1), Constant(value=' is missing:')])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Try(body=[Assign(targets=[Name(id='default', ctx=Store())], value=Subscript(value=Attribute(value=Name(id='node', ctx=Load()), attr='defaults', ctx=Load()), slice=BinOp(left=Name(id='idx', ctx=Load()), op=Sub(), right=Call(func=Name(id='len', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='args', ctx=Load())], keywords=[])), ctx=Load()))], handlers=[ExceptHandler(type=Name(id='IndexError', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Name(id='ref', ctx=Load()), conversion=-1), Constant(value=' = undefined("parameter '), FormattedValue(value=Attribute(value=Name(id='arg', ctx=Load()), attr='name', ctx=Load()), conversion=114), Constant(value=' was not provided", name='), FormattedValue(value=Attribute(value=Name(id='arg', ctx=Load()), attr='name', ctx=Load()), conversion=114), Constant(value=')')])], keywords=[]))])], orelse=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Name(id='ref', ctx=Load()), conversion=-1), Constant(value=' = ')])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Name(id='default', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[]))], finalbody=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='mark_parameter_stored', ctx=Load()), args=[Name(id='ref', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='pop_parameter_definitions', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='blockvisit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='body', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='return_buffer_contents', ctx=Load()), args=[Name(id='frame', ctx=Load())], keywords=[keyword(arg='force_unescaped', value=Constant(value=True))])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='leave_frame', ctx=Load()), args=[Name(id='frame', ctx=Load())], keywords=[keyword(arg='with_python_scope', value=Constant(value=True))])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[])), Return(value=Tuple(elts=[Name(id='frame', ctx=Load()), Name(id='macro_ref', ctx=Load())], ctx=Load()))], decorator_list=[], returns=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Tuple', ctx=Load()), slice=Tuple(elts=[Name(id='Frame', ctx=Load()), Name(id='MacroRef', ctx=Load())], ctx=Load()), ctx=Load())), FunctionDef(name='macro_def', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='macro_ref', annotation=Name(id='MacroRef', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Dump the macro definition for the def created by macro_body.')), Assign(targets=[Name(id='arg_tuple', ctx=Store())], value=Call(func=Attribute(value=Constant(value=', '), attr='join', ctx=Load()), args=[GeneratorExp(elt=Call(func=Name(id='repr', ctx=Load()), args=[Attribute(value=Name(id='x', ctx=Load()), attr='name', ctx=Load())], keywords=[]), generators=[comprehension(target=Name(id='x', ctx=Store()), iter=Attribute(value=Attribute(value=Name(id='macro_ref', ctx=Load()), attr='node', ctx=Load()), attr='args', ctx=Load()), ifs=[], is_async=0)])], keywords=[])), Assign(targets=[Name(id='name', ctx=Store())], value=Call(func=Name(id='getattr', ctx=Load()), args=[Attribute(value=Name(id='macro_ref', ctx=Load()), attr='node', ctx=Load()), Constant(value='name'), Constant(value=None)], keywords=[])), If(test=Compare(left=Call(func=Name(id='len', ctx=Load()), args=[Attribute(value=Attribute(value=Name(id='macro_ref', ctx=Load()), attr='node', ctx=Load()), attr='args', ctx=Load())], keywords=[]), ops=[Eq()], comparators=[Constant(value=1)]), body=[AugAssign(target=Name(id='arg_tuple', ctx=Store()), op=Add(), value=Constant(value=','))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[Constant(value='Macro(environment, macro, '), FormattedValue(value=Name(id='name', ctx=Load()), conversion=114), Constant(value=', ('), FormattedValue(value=Name(id='arg_tuple', ctx=Load()), conversion=-1), Constant(value='), '), FormattedValue(value=Attribute(value=Name(id='macro_ref', ctx=Load()), attr='accesses_kwargs', ctx=Load()), conversion=114), Constant(value=', '), FormattedValue(value=Attribute(value=Name(id='macro_ref', ctx=Load()), attr='accesses_varargs', ctx=Load()), conversion=114), Constant(value=', '), FormattedValue(value=Attribute(value=Name(id='macro_ref', ctx=Load()), attr='accesses_caller', ctx=Load()), conversion=114), Constant(value=', context.eval_ctx.autoescape)')])], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='position', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Node', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Return a human readable position for the node.')), Assign(targets=[Name(id='rv', ctx=Store())], value=JoinedStr(values=[Constant(value='line '), FormattedValue(value=Attribute(value=Name(id='node', ctx=Load()), attr='lineno', ctx=Load()), conversion=-1)])), If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load()), attr='name', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[Assign(targets=[Name(id='rv', ctx=Store())], value=JoinedStr(values=[FormattedValue(value=Name(id='rv', ctx=Load()), conversion=-1), Constant(value=' in '), FormattedValue(value=Attribute(value=Name(id='self', ctx=Load()), attr='name', ctx=Load()), conversion=114)]))], orelse=[]), Return(value=Name(id='rv', ctx=Load()))], decorator_list=[], returns=Name(id='str', ctx=Load())), FunctionDef(name='dump_local_context', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='items_kv', ctx=Store())], value=Call(func=Attribute(value=Constant(value=', '), attr='join', ctx=Load()), args=[GeneratorExp(elt=JoinedStr(values=[FormattedValue(value=Name(id='name', ctx=Load()), conversion=114), Constant(value=': '), FormattedValue(value=Name(id='target', ctx=Load()), conversion=-1)]), generators=[comprehension(target=Tuple(elts=[Name(id='name', ctx=Store()), Name(id='target', ctx=Store())], ctx=Store()), iter=Call(func=Attribute(value=Call(func=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='symbols', ctx=Load()), attr='dump_stores', ctx=Load()), args=[], keywords=[]), attr='items', ctx=Load()), args=[], keywords=[]), ifs=[], is_async=0)])], keywords=[])), Return(value=JoinedStr(values=[Constant(value='{'), FormattedValue(value=Name(id='items_kv', ctx=Load()), conversion=-1), Constant(value='}')]))], decorator_list=[], returns=Name(id='str', ctx=Load())), FunctionDef(name='write_commons', args=arguments(posonlyargs=[], args=[arg(arg='self')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Writes a common preamble that is used by root and block functions.\n        Primarily this sets up common local helpers and enforces a generator\n        through a dead branch.\n        ')), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='resolve = context.resolve_or_missing')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='undefined = environment.undefined')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='concat = environment.concat')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='cond_expr_undefined = Undefined')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='if 0: yield None')], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='push_parameter_definitions', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Pushes all parameter targets from the given frame into a local\n        stack that permits tracking of yet to be assigned parameters.  In\n        particular this enables the optimization from `visit_Name` to skip\n        undefined expressions for parameters in macros as macros can reference\n        otherwise unbound parameters.\n        ')), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='_param_def_block', ctx=Load()), attr='append', ctx=Load()), args=[Call(func=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='symbols', ctx=Load()), attr='dump_param_targets', ctx=Load()), args=[], keywords=[])], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='pop_parameter_definitions', args=arguments(posonlyargs=[], args=[arg(arg='self')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Pops the current parameter definitions set.')), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='_param_def_block', ctx=Load()), attr='pop', ctx=Load()), args=[], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='mark_parameter_stored', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='target', annotation=Name(id='str', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Marks a parameter in the current parameter definitions as stored.\n        This will skip the enforced undefined checks.\n        ')), If(test=Attribute(value=Name(id='self', ctx=Load()), attr='_param_def_block', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Subscript(value=Attribute(value=Name(id='self', ctx=Load()), attr='_param_def_block', ctx=Load()), slice=UnaryOp(op=USub(), operand=Constant(value=1)), ctx=Load()), attr='discard', ctx=Load()), args=[Name(id='target', ctx=Load())], keywords=[]))], orelse=[])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='push_context_reference', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='target', annotation=Name(id='str', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='_context_reference_stack', ctx=Load()), attr='append', ctx=Load()), args=[Name(id='target', ctx=Load())], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='pop_context_reference', args=arguments(posonlyargs=[], args=[arg(arg='self')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='_context_reference_stack', ctx=Load()), attr='pop', ctx=Load()), args=[], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='get_context_ref', args=arguments(posonlyargs=[], args=[arg(arg='self')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Return(value=Subscript(value=Attribute(value=Name(id='self', ctx=Load()), attr='_context_reference_stack', ctx=Load()), slice=UnaryOp(op=USub(), operand=Constant(value=1)), ctx=Load()))], decorator_list=[], returns=Name(id='str', ctx=Load())), FunctionDef(name='get_resolve_func', args=arguments(posonlyargs=[], args=[arg(arg='self')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='target', ctx=Store())], value=Subscript(value=Attribute(value=Name(id='self', ctx=Load()), attr='_context_reference_stack', ctx=Load()), slice=UnaryOp(op=USub(), operand=Constant(value=1)), ctx=Load())), If(test=Compare(left=Name(id='target', ctx=Load()), ops=[Eq()], comparators=[Constant(value='context')]), body=[Return(value=Constant(value='resolve'))], orelse=[]), Return(value=JoinedStr(values=[FormattedValue(value=Name(id='target', ctx=Load()), conversion=-1), Constant(value='.resolve')]))], decorator_list=[], returns=Name(id='str', ctx=Load())), FunctionDef(name='derive_context', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Return(value=JoinedStr(values=[FormattedValue(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='get_context_ref', ctx=Load()), args=[], keywords=[]), conversion=-1), Constant(value='.derived('), FormattedValue(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='dump_local_context', ctx=Load()), args=[Name(id='frame', ctx=Load())], keywords=[]), conversion=-1), Constant(value=')')]))], decorator_list=[], returns=Name(id='str', ctx=Load())), FunctionDef(name='parameter_is_undeclared', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='target', annotation=Name(id='str', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Checks if a given target is an undeclared parameter.')), If(test=UnaryOp(op=Not(), operand=Attribute(value=Name(id='self', ctx=Load()), attr='_param_def_block', ctx=Load())), body=[Return(value=Constant(value=False))], orelse=[]), Return(value=Compare(left=Name(id='target', ctx=Load()), ops=[In()], comparators=[Subscript(value=Attribute(value=Name(id='self', ctx=Load()), attr='_param_def_block', ctx=Load()), slice=UnaryOp(op=USub(), operand=Constant(value=1)), ctx=Load())]))], decorator_list=[], returns=Name(id='bool', ctx=Load())), FunctionDef(name='push_assign_tracking', args=arguments(posonlyargs=[], args=[arg(arg='self')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Pushes a new layer for assignment tracking.')), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='_assign_stack', ctx=Load()), attr='append', ctx=Load()), args=[Call(func=Name(id='set', ctx=Load()), args=[], keywords=[])], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='pop_assign_tracking', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Pops the topmost level for assignment tracking and updates the\n        context variables if necessary.\n        ')), Assign(targets=[Name(id='vars', ctx=Store())], value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='_assign_stack', ctx=Load()), attr='pop', ctx=Load()), args=[], keywords=[])), If(test=BoolOp(op=Or(), values=[BoolOp(op=And(), values=[UnaryOp(op=Not(), operand=Attribute(value=Name(id='frame', ctx=Load()), attr='block_frame', ctx=Load())), UnaryOp(op=Not(), operand=Attribute(value=Name(id='frame', ctx=Load()), attr='loop_frame', ctx=Load())), UnaryOp(op=Not(), operand=Attribute(value=Name(id='frame', ctx=Load()), attr='toplevel', ctx=Load()))]), UnaryOp(op=Not(), operand=Name(id='vars', ctx=Load()))]), body=[Return()], orelse=[]), Assign(targets=[Name(id='public_names', ctx=Store())], value=ListComp(elt=Name(id='x', ctx=Load()), generators=[comprehension(target=Name(id='x', ctx=Store()), iter=Name(id='vars', ctx=Load()), ifs=[Compare(left=Subscript(value=Name(id='x', ctx=Load()), slice=Slice(upper=Constant(value=1)), ctx=Load()), ops=[NotEq()], comparators=[Constant(value='_')])], is_async=0)])), If(test=Compare(left=Call(func=Name(id='len', ctx=Load()), args=[Name(id='vars', ctx=Load())], keywords=[]), ops=[Eq()], comparators=[Constant(value=1)]), body=[Assign(targets=[Name(id='name', ctx=Store())], value=Call(func=Name(id='next', ctx=Load()), args=[Call(func=Name(id='iter', ctx=Load()), args=[Name(id='vars', ctx=Load())], keywords=[])], keywords=[])), Assign(targets=[Name(id='ref', ctx=Store())], value=Call(func=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='symbols', ctx=Load()), attr='ref', ctx=Load()), args=[Name(id='name', ctx=Load())], keywords=[])), If(test=Attribute(value=Name(id='frame', ctx=Load()), attr='loop_frame', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='_loop_vars['), FormattedValue(value=Name(id='name', ctx=Load()), conversion=114), Constant(value='] = '), FormattedValue(value=Name(id='ref', ctx=Load()), conversion=-1)])], keywords=[])), Return()], orelse=[]), If(test=Attribute(value=Name(id='frame', ctx=Load()), attr='block_frame', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='_block_vars['), FormattedValue(value=Name(id='name', ctx=Load()), conversion=114), Constant(value='] = '), FormattedValue(value=Name(id='ref', ctx=Load()), conversion=-1)])], keywords=[])), Return()], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='context.vars['), FormattedValue(value=Name(id='name', ctx=Load()), conversion=114), Constant(value='] = '), FormattedValue(value=Name(id='ref', ctx=Load()), conversion=-1)])], keywords=[]))], orelse=[If(test=Attribute(value=Name(id='frame', ctx=Load()), attr='loop_frame', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='_loop_vars.update({')], keywords=[]))], orelse=[If(test=Attribute(value=Name(id='frame', ctx=Load()), attr='block_frame', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='_block_vars.update({')], keywords=[]))], orelse=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='context.vars.update({')], keywords=[]))])]), For(target=Tuple(elts=[Name(id='idx', ctx=Store()), Name(id='name', ctx=Store())], ctx=Store()), iter=Call(func=Name(id='enumerate', ctx=Load()), args=[Name(id='vars', ctx=Load())], keywords=[]), body=[If(test=Name(id='idx', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=', ')], keywords=[]))], orelse=[]), Assign(targets=[Name(id='ref', ctx=Store())], value=Call(func=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='symbols', ctx=Load()), attr='ref', ctx=Load()), args=[Name(id='name', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Name(id='name', ctx=Load()), conversion=114), Constant(value=': '), FormattedValue(value=Name(id='ref', ctx=Load()), conversion=-1)])], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='})')], keywords=[]))]), If(test=BoolOp(op=And(), values=[UnaryOp(op=Not(), operand=Attribute(value=Name(id='frame', ctx=Load()), attr='block_frame', ctx=Load())), UnaryOp(op=Not(), operand=Attribute(value=Name(id='frame', ctx=Load()), attr='loop_frame', ctx=Load())), Name(id='public_names', ctx=Load())]), body=[If(test=Compare(left=Call(func=Name(id='len', ctx=Load()), args=[Name(id='public_names', ctx=Load())], keywords=[]), ops=[Eq()], comparators=[Constant(value=1)]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='context.exported_vars.add('), FormattedValue(value=Subscript(value=Name(id='public_names', ctx=Load()), slice=Constant(value=0), ctx=Load()), conversion=114), Constant(value=')')])], keywords=[]))], orelse=[Assign(targets=[Name(id='names_str', ctx=Store())], value=Call(func=Attribute(value=Constant(value=', '), attr='join', ctx=Load()), args=[Call(func=Name(id='map', ctx=Load()), args=[Name(id='repr', ctx=Load()), Name(id='public_names', ctx=Load())], keywords=[])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='context.exported_vars.update(('), FormattedValue(value=Name(id='names_str', ctx=Load()), conversion=-1), Constant(value='))')])], keywords=[]))])], orelse=[])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_Template', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Template', ctx=Load())), arg(arg='frame', annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Optional', ctx=Load()), slice=Name(id='Frame', ctx=Load()), ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[Constant(value=None)]), body=[Assert(test=Compare(left=Name(id='frame', ctx=Load()), ops=[Is()], comparators=[Constant(value=None)]), msg=Constant(value='no root frame allowed')), Assign(targets=[Name(id='eval_ctx', ctx=Store())], value=Call(func=Name(id='EvalContext', ctx=Load()), args=[Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), Attribute(value=Name(id='self', ctx=Load()), attr='name', ctx=Load())], keywords=[])), ImportFrom(module='runtime', names=[alias(name='exported'), alias(name='async_exported')], level=1), If(test=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), attr='is_async', ctx=Load()), body=[Assign(targets=[Name(id='exported_names', ctx=Store())], value=Call(func=Name(id='sorted', ctx=Load()), args=[BinOp(left=Name(id='exported', ctx=Load()), op=Add(), right=Name(id='async_exported', ctx=Load()))], keywords=[]))], orelse=[Assign(targets=[Name(id='exported_names', ctx=Store())], value=Call(func=Name(id='sorted', ctx=Load()), args=[Name(id='exported', ctx=Load())], keywords=[]))]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[BinOp(left=Constant(value='from jinja2.runtime import '), op=Add(), right=Call(func=Attribute(value=Constant(value=', '), attr='join', ctx=Load()), args=[Name(id='exported_names', ctx=Load())], keywords=[]))], keywords=[])), Assign(targets=[Name(id='envenv', ctx=Store())], value=IfExp(test=Attribute(value=Name(id='self', ctx=Load()), attr='defer_init', ctx=Load()), body=Constant(value=''), orelse=Constant(value=', environment=environment'))), Assign(targets=[Name(id='have_extends', ctx=Store())], value=Compare(left=Call(func=Attribute(value=Name(id='node', ctx=Load()), attr='find', ctx=Load()), args=[Attribute(value=Name(id='nodes', ctx=Load()), attr='Extends', ctx=Load())], keywords=[]), ops=[IsNot()], comparators=[Constant(value=None)])), For(target=Name(id='block', ctx=Store()), iter=Call(func=Attribute(value=Name(id='node', ctx=Load()), attr='find_all', ctx=Load()), args=[Attribute(value=Name(id='nodes', ctx=Load()), attr='Block', ctx=Load())], keywords=[]), body=[If(test=Compare(left=Attribute(value=Name(id='block', ctx=Load()), attr='name', ctx=Load()), ops=[In()], comparators=[Attribute(value=Name(id='self', ctx=Load()), attr='blocks', ctx=Load())]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='fail', ctx=Load()), args=[JoinedStr(values=[Constant(value='block '), FormattedValue(value=Attribute(value=Name(id='block', ctx=Load()), attr='name', ctx=Load()), conversion=114), Constant(value=' defined twice')]), Attribute(value=Name(id='block', ctx=Load()), attr='lineno', ctx=Load())], keywords=[]))], orelse=[]), Assign(targets=[Subscript(value=Attribute(value=Name(id='self', ctx=Load()), attr='blocks', ctx=Load()), slice=Attribute(value=Name(id='block', ctx=Load()), attr='name', ctx=Load()), ctx=Store())], value=Name(id='block', ctx=Load()))], orelse=[]), For(target=Name(id='import_', ctx=Store()), iter=Call(func=Attribute(value=Name(id='node', ctx=Load()), attr='find_all', ctx=Load()), args=[Attribute(value=Name(id='nodes', ctx=Load()), attr='ImportedName', ctx=Load())], keywords=[]), body=[If(test=Compare(left=Attribute(value=Name(id='import_', ctx=Load()), attr='importname', ctx=Load()), ops=[NotIn()], comparators=[Attribute(value=Name(id='self', ctx=Load()), attr='import_aliases', ctx=Load())]), body=[Assign(targets=[Name(id='imp', ctx=Store())], value=Attribute(value=Name(id='import_', ctx=Load()), attr='importname', ctx=Load())), Assign(targets=[Subscript(value=Attribute(value=Name(id='self', ctx=Load()), attr='import_aliases', ctx=Load()), slice=Name(id='imp', ctx=Load()), ctx=Store()), Name(id='alias', ctx=Store())], value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='temporary_identifier', ctx=Load()), args=[], keywords=[])), If(test=Compare(left=Constant(value='.'), ops=[In()], comparators=[Name(id='imp', ctx=Load())]), body=[Assign(targets=[Tuple(elts=[Name(id='module', ctx=Store()), Name(id='obj', ctx=Store())], ctx=Store())], value=Call(func=Attribute(value=Name(id='imp', ctx=Load()), attr='rsplit', ctx=Load()), args=[Constant(value='.'), Constant(value=1)], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='from '), FormattedValue(value=Name(id='module', ctx=Load()), conversion=-1), Constant(value=' import '), FormattedValue(value=Name(id='obj', ctx=Load()), conversion=-1), Constant(value=' as '), FormattedValue(value=Name(id='alias', ctx=Load()), conversion=-1)])], keywords=[]))], orelse=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='import '), FormattedValue(value=Name(id='imp', ctx=Load()), conversion=-1), Constant(value=' as '), FormattedValue(value=Name(id='alias', ctx=Load()), conversion=-1)])], keywords=[]))])], orelse=[])], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='name = '), FormattedValue(value=Attribute(value=Name(id='self', ctx=Load()), attr='name', ctx=Load()), conversion=114)])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='func', ctx=Load()), args=[Constant(value='root')], keywords=[]), conversion=-1), Constant(value='(context, missing=missing'), FormattedValue(value=Name(id='envenv', ctx=Load()), conversion=-1), Constant(value='):')])], keywords=[keyword(arg='extra', value=Constant(value=1))])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write_commons', ctx=Load()), args=[], keywords=[])), Assign(targets=[Name(id='frame', ctx=Store())], value=Call(func=Name(id='Frame', ctx=Load()), args=[Name(id='eval_ctx', ctx=Load())], keywords=[])), If(test=Compare(left=Constant(value='self'), ops=[In()], comparators=[Call(func=Name(id='find_undeclared', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='body', ctx=Load()), Tuple(elts=[Constant(value='self')], ctx=Load())], keywords=[])]), body=[Assign(targets=[Name(id='ref', ctx=Store())], value=Call(func=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='symbols', ctx=Load()), attr='declare_parameter', ctx=Load()), args=[Constant(value='self')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Name(id='ref', ctx=Load()), conversion=-1), Constant(value=' = TemplateReference(context)')])], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='symbols', ctx=Load()), attr='analyze_node', ctx=Load()), args=[Name(id='node', ctx=Load())], keywords=[])), Assign(targets=[Attribute(value=Name(id='frame', ctx=Load()), attr='toplevel', ctx=Store()), Attribute(value=Name(id='frame', ctx=Load()), attr='rootlevel', ctx=Store())], value=Constant(value=True)), Assign(targets=[Attribute(value=Name(id='frame', ctx=Load()), attr='require_output_check', ctx=Store())], value=BoolOp(op=And(), values=[Name(id='have_extends', ctx=Load()), UnaryOp(op=Not(), operand=Attribute(value=Name(id='self', ctx=Load()), attr='has_known_extends', ctx=Load()))])), If(test=Name(id='have_extends', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='parent_template = None')], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='enter_frame', ctx=Load()), args=[Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='pull_dependencies', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='body', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='blockvisit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='body', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='leave_frame', ctx=Load()), args=[Name(id='frame', ctx=Load())], keywords=[keyword(arg='with_python_scope', value=Constant(value=True))])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[])), If(test=Name(id='have_extends', ctx=Load()), body=[If(test=UnaryOp(op=Not(), operand=Attribute(value=Name(id='self', ctx=Load()), attr='has_known_extends', ctx=Load())), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='if parent_template is not None:')], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), If(test=UnaryOp(op=Not(), operand=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), attr='is_async', ctx=Load())), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='yield from parent_template.root_render_func(context)')], keywords=[]))], orelse=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='async for event in parent_template.root_render_func(context):')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='yield event')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[]))]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[BinOp(left=Constant(value=1), op=Add(), right=UnaryOp(op=Not(), operand=Attribute(value=Name(id='self', ctx=Load()), attr='has_known_extends', ctx=Load())))], keywords=[]))], orelse=[]), For(target=Tuple(elts=[Name(id='name', ctx=Store()), Name(id='block', ctx=Store())], ctx=Store()), iter=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='blocks', ctx=Load()), attr='items', ctx=Load()), args=[], keywords=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='func', ctx=Load()), args=[BinOp(left=Constant(value='block_'), op=Add(), right=Name(id='name', ctx=Load()))], keywords=[]), conversion=-1), Constant(value='(context, missing=missing'), FormattedValue(value=Name(id='envenv', ctx=Load()), conversion=-1), Constant(value='):')]), Name(id='block', ctx=Load()), Constant(value=1)], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write_commons', ctx=Load()), args=[], keywords=[])), Assign(targets=[Name(id='block_frame', ctx=Store())], value=Call(func=Name(id='Frame', ctx=Load()), args=[Name(id='eval_ctx', ctx=Load())], keywords=[])), Assign(targets=[Attribute(value=Name(id='block_frame', ctx=Load()), attr='block_frame', ctx=Store())], value=Constant(value=True)), Assign(targets=[Name(id='undeclared', ctx=Store())], value=Call(func=Name(id='find_undeclared', ctx=Load()), args=[Attribute(value=Name(id='block', ctx=Load()), attr='body', ctx=Load()), Tuple(elts=[Constant(value='self'), Constant(value='super')], ctx=Load())], keywords=[])), If(test=Compare(left=Constant(value='self'), ops=[In()], comparators=[Name(id='undeclared', ctx=Load())]), body=[Assign(targets=[Name(id='ref', ctx=Store())], value=Call(func=Attribute(value=Attribute(value=Name(id='block_frame', ctx=Load()), attr='symbols', ctx=Load()), attr='declare_parameter', ctx=Load()), args=[Constant(value='self')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Name(id='ref', ctx=Load()), conversion=-1), Constant(value=' = TemplateReference(context)')])], keywords=[]))], orelse=[]), If(test=Compare(left=Constant(value='super'), ops=[In()], comparators=[Name(id='undeclared', ctx=Load())]), body=[Assign(targets=[Name(id='ref', ctx=Store())], value=Call(func=Attribute(value=Attribute(value=Name(id='block_frame', ctx=Load()), attr='symbols', ctx=Load()), attr='declare_parameter', ctx=Load()), args=[Constant(value='super')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Name(id='ref', ctx=Load()), conversion=-1), Constant(value=' = context.super('), FormattedValue(value=Name(id='name', ctx=Load()), conversion=114), Constant(value=', block_'), FormattedValue(value=Name(id='name', ctx=Load()), conversion=-1), Constant(value=')')])], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='block_frame', ctx=Load()), attr='symbols', ctx=Load()), attr='analyze_node', ctx=Load()), args=[Name(id='block', ctx=Load())], keywords=[])), Assign(targets=[Attribute(value=Name(id='block_frame', ctx=Load()), attr='block', ctx=Store())], value=Name(id='name', ctx=Load())), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='_block_vars = {}')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='enter_frame', ctx=Load()), args=[Name(id='block_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='pull_dependencies', ctx=Load()), args=[Attribute(value=Name(id='block', ctx=Load()), attr='body', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='blockvisit', ctx=Load()), args=[Attribute(value=Name(id='block', ctx=Load()), attr='body', ctx=Load()), Name(id='block_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='leave_frame', ctx=Load()), args=[Name(id='block_frame', ctx=Load())], keywords=[keyword(arg='with_python_scope', value=Constant(value=True))])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[]))], orelse=[]), Assign(targets=[Name(id='blocks_kv_str', ctx=Store())], value=Call(func=Attribute(value=Constant(value=', '), attr='join', ctx=Load()), args=[GeneratorExp(elt=JoinedStr(values=[FormattedValue(value=Name(id='x', ctx=Load()), conversion=114), Constant(value=': block_'), FormattedValue(value=Name(id='x', ctx=Load()), conversion=-1)]), generators=[comprehension(target=Name(id='x', ctx=Store()), iter=Attribute(value=Name(id='self', ctx=Load()), attr='blocks', ctx=Load()), ifs=[], is_async=0)])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='blocks = {'), FormattedValue(value=Name(id='blocks_kv_str', ctx=Load()), conversion=-1), Constant(value='}')])], keywords=[keyword(arg='extra', value=Constant(value=1))])), Assign(targets=[Name(id='debug_kv_str', ctx=Store())], value=Call(func=Attribute(value=Constant(value='&'), attr='join', ctx=Load()), args=[GeneratorExp(elt=JoinedStr(values=[FormattedValue(value=Name(id='k', ctx=Load()), conversion=-1), Constant(value='='), FormattedValue(value=Name(id='v', ctx=Load()), conversion=-1)]), generators=[comprehension(target=Tuple(elts=[Name(id='k', ctx=Store()), Name(id='v', ctx=Store())], ctx=Store()), iter=Attribute(value=Name(id='self', ctx=Load()), attr='debug_info', ctx=Load()), ifs=[], is_async=0)])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='debug_info = '), FormattedValue(value=Name(id='debug_kv_str', ctx=Load()), conversion=114)])], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_Block', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Block', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Call a block and register it for the template.')), Assign(targets=[Name(id='level', ctx=Store())], value=Constant(value=0)), If(test=Attribute(value=Name(id='frame', ctx=Load()), attr='toplevel', ctx=Load()), body=[If(test=Attribute(value=Name(id='self', ctx=Load()), attr='has_known_extends', ctx=Load()), body=[Return()], orelse=[]), If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load()), attr='extends_so_far', ctx=Load()), ops=[Gt()], comparators=[Constant(value=0)]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='if parent_template is None:')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), AugAssign(target=Name(id='level', ctx=Store()), op=Add(), value=Constant(value=1))], orelse=[])], orelse=[]), If(test=Attribute(value=Name(id='node', ctx=Load()), attr='scoped', ctx=Load()), body=[Assign(targets=[Name(id='context', ctx=Store())], value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='derive_context', ctx=Load()), args=[Name(id='frame', ctx=Load())], keywords=[]))], orelse=[Assign(targets=[Name(id='context', ctx=Store())], value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='get_context_ref', ctx=Load()), args=[], keywords=[]))]), If(test=Attribute(value=Name(id='node', ctx=Load()), attr='required', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='if len(context.blocks['), FormattedValue(value=Attribute(value=Name(id='node', ctx=Load()), attr='name', ctx=Load()), conversion=114), Constant(value=']) <= 1:')]), Name(id='node', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='raise TemplateRuntimeError("Required block '), FormattedValue(value=Attribute(value=Name(id='node', ctx=Load()), attr='name', ctx=Load()), conversion=114), Constant(value=' not found")')]), Name(id='node', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[]))], orelse=[]), If(test=BoolOp(op=And(), values=[UnaryOp(op=Not(), operand=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), attr='is_async', ctx=Load())), Compare(left=Attribute(value=Name(id='frame', ctx=Load()), attr='buffer', ctx=Load()), ops=[Is()], comparators=[Constant(value=None)])]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='yield from context.blocks['), FormattedValue(value=Attribute(value=Name(id='node', ctx=Load()), attr='name', ctx=Load()), conversion=114), Constant(value='][0]('), FormattedValue(value=Name(id='context', ctx=Load()), conversion=-1), Constant(value=')')]), Name(id='node', ctx=Load())], keywords=[]))], orelse=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='choose_async', ctx=Load()), args=[], keywords=[]), conversion=-1), Constant(value='for event in context.blocks['), FormattedValue(value=Attribute(value=Name(id='node', ctx=Load()), attr='name', ctx=Load()), conversion=114), Constant(value='][0]('), FormattedValue(value=Name(id='context', ctx=Load()), conversion=-1), Constant(value='):')]), Name(id='node', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='simple_write', ctx=Load()), args=[Constant(value='event'), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[]))]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[Name(id='level', ctx=Load())], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_Extends', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Extends', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Calls the extender.')), If(test=UnaryOp(op=Not(), operand=Attribute(value=Name(id='frame', ctx=Load()), attr='toplevel', ctx=Load())), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='fail', ctx=Load()), args=[Constant(value='cannot use extend from a non top-level scope'), Attribute(value=Name(id='node', ctx=Load()), attr='lineno', ctx=Load())], keywords=[]))], orelse=[]), If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load()), attr='extends_so_far', ctx=Load()), ops=[Gt()], comparators=[Constant(value=0)]), body=[If(test=UnaryOp(op=Not(), operand=Attribute(value=Name(id='self', ctx=Load()), attr='has_known_extends', ctx=Load())), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='if parent_template is not None:')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='raise TemplateRuntimeError("extended multiple times")')], keywords=[])), If(test=Attribute(value=Name(id='self', ctx=Load()), attr='has_known_extends', ctx=Load()), body=[Raise(exc=Call(func=Name(id='CompilerExit', ctx=Load()), args=[], keywords=[]))], orelse=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[]))])], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='parent_template = environment.get_template('), Name(id='node', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='template', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[Constant(value=', '), FormattedValue(value=Attribute(value=Name(id='self', ctx=Load()), attr='name', ctx=Load()), conversion=114), Constant(value=')')])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='for name, parent_block in parent_template.blocks.items():')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='context.blocks.setdefault(name, []).append(parent_block)')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[])), If(test=Attribute(value=Name(id='frame', ctx=Load()), attr='rootlevel', ctx=Load()), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='has_known_extends', ctx=Store())], value=Constant(value=True))], orelse=[]), AugAssign(target=Attribute(value=Name(id='self', ctx=Load()), attr='extends_so_far', ctx=Store()), op=Add(), value=Constant(value=1))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_Include', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Include', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Handles includes.')), If(test=Attribute(value=Name(id='node', ctx=Load()), attr='ignore_missing', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='try:')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[]))], orelse=[]), Assign(targets=[Name(id='func_name', ctx=Store())], value=Constant(value='get_or_select_template')), If(test=Call(func=Name(id='isinstance', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='template', ctx=Load()), Attribute(value=Name(id='nodes', ctx=Load()), attr='Const', ctx=Load())], keywords=[]), body=[If(test=Call(func=Name(id='isinstance', ctx=Load()), args=[Attribute(value=Attribute(value=Name(id='node', ctx=Load()), attr='template', ctx=Load()), attr='value', ctx=Load()), Name(id='str', ctx=Load())], keywords=[]), body=[Assign(targets=[Name(id='func_name', ctx=Store())], value=Constant(value='get_template'))], orelse=[If(test=Call(func=Name(id='isinstance', ctx=Load()), args=[Attribute(value=Attribute(value=Name(id='node', ctx=Load()), attr='template', ctx=Load()), attr='value', ctx=Load()), Tuple(elts=[Name(id='tuple', ctx=Load()), Name(id='list', ctx=Load())], ctx=Load())], keywords=[]), body=[Assign(targets=[Name(id='func_name', ctx=Store())], value=Constant(value='select_template'))], orelse=[])])], orelse=[If(test=Call(func=Name(id='isinstance', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='template', ctx=Load()), Tuple(elts=[Attribute(value=Name(id='nodes', ctx=Load()), attr='Tuple', ctx=Load()), Attribute(value=Name(id='nodes', ctx=Load()), attr='List', ctx=Load())], ctx=Load())], keywords=[]), body=[Assign(targets=[Name(id='func_name', ctx=Store())], value=Constant(value='select_template'))], orelse=[])]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='template = environment.'), FormattedValue(value=Name(id='func_name', ctx=Load()), conversion=-1), Constant(value='(')]), Name(id='node', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='template', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[Constant(value=', '), FormattedValue(value=Attribute(value=Name(id='self', ctx=Load()), attr='name', ctx=Load()), conversion=114), Constant(value=')')])], keywords=[])), If(test=Attribute(value=Name(id='node', ctx=Load()), attr='ignore_missing', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='except TemplateNotFound:')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='pass')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='else:')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[]))], orelse=[]), Assign(targets=[Name(id='skip_event_yield', ctx=Store())], value=Constant(value=False)), If(test=Attribute(value=Name(id='node', ctx=Load()), attr='with_context', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='choose_async', ctx=Load()), args=[], keywords=[]), conversion=-1), Constant(value='for event in template.root_render_func(template.new_context(context.get_all(), True, '), FormattedValue(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='dump_local_context', ctx=Load()), args=[Name(id='frame', ctx=Load())], keywords=[]), conversion=-1), Constant(value=')):')])], keywords=[]))], orelse=[If(test=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), attr='is_async', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='for event in (await template._get_default_module_async())._body_stream:')], keywords=[]))], orelse=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='yield from template._get_default_module()._body_stream')], keywords=[])), Assign(targets=[Name(id='skip_event_yield', ctx=Store())], value=Constant(value=True))])]), If(test=UnaryOp(op=Not(), operand=Name(id='skip_event_yield', ctx=Load())), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='simple_write', ctx=Load()), args=[Constant(value='event'), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[]))], orelse=[]), If(test=Attribute(value=Name(id='node', ctx=Load()), attr='ignore_missing', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[]))], orelse=[])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='_import_common', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Union', ctx=Load()), slice=Tuple(elts=[Attribute(value=Name(id='nodes', ctx=Load()), attr='Import', ctx=Load()), Attribute(value=Name(id='nodes', ctx=Load()), attr='FromImport', ctx=Load())], ctx=Load()), ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='choose_async', ctx=Load()), args=[Constant(value='await ')], keywords=[]), conversion=-1), Constant(value='environment.get_template(')])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='template', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[Constant(value=', '), FormattedValue(value=Attribute(value=Name(id='self', ctx=Load()), attr='name', ctx=Load()), conversion=114), Constant(value=').')])], keywords=[])), If(test=Attribute(value=Name(id='node', ctx=Load()), attr='with_context', ctx=Load()), body=[Assign(targets=[Name(id='f_name', ctx=Store())], value=JoinedStr(values=[Constant(value='make_module'), FormattedValue(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='choose_async', ctx=Load()), args=[Constant(value='_async')], keywords=[]), conversion=-1)])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Name(id='f_name', ctx=Load()), conversion=-1), Constant(value='(context.get_all(), True, '), FormattedValue(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='dump_local_context', ctx=Load()), args=[Name(id='frame', ctx=Load())], keywords=[]), conversion=-1), Constant(value=')')])], keywords=[]))], orelse=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[Constant(value='_get_default_module'), FormattedValue(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='choose_async', ctx=Load()), args=[Constant(value='_async')], keywords=[]), conversion=-1), Constant(value='(context)')])], keywords=[]))])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_Import', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Import', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Visit regular imports.')), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Call(func=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='symbols', ctx=Load()), attr='ref', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='target', ctx=Load())], keywords=[]), conversion=-1), Constant(value=' = ')]), Name(id='node', ctx=Load())], keywords=[])), If(test=Attribute(value=Name(id='frame', ctx=Load()), attr='toplevel', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[Constant(value='context.vars['), FormattedValue(value=Attribute(value=Name(id='node', ctx=Load()), attr='target', ctx=Load()), conversion=114), Constant(value='] = ')])], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='_import_common', ctx=Load()), args=[Name(id='node', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), If(test=BoolOp(op=And(), values=[Attribute(value=Name(id='frame', ctx=Load()), attr='toplevel', ctx=Load()), UnaryOp(op=Not(), operand=Call(func=Attribute(value=Attribute(value=Name(id='node', ctx=Load()), attr='target', ctx=Load()), attr='startswith', ctx=Load()), args=[Constant(value='_')], keywords=[]))]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='context.exported_vars.discard('), FormattedValue(value=Attribute(value=Name(id='node', ctx=Load()), attr='target', ctx=Load()), conversion=114), Constant(value=')')])], keywords=[]))], orelse=[])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_FromImport', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='FromImport', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Visit named imports.')), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='newline', ctx=Load()), args=[Name(id='node', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='included_template = ')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='_import_common', ctx=Load()), args=[Name(id='node', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Assign(targets=[Name(id='var_names', ctx=Store())], value=List(elts=[], ctx=Load())), Assign(targets=[Name(id='discarded_names', ctx=Store())], value=List(elts=[], ctx=Load())), For(target=Name(id='name', ctx=Store()), iter=Attribute(value=Name(id='node', ctx=Load()), attr='names', ctx=Load()), body=[If(test=Call(func=Name(id='isinstance', ctx=Load()), args=[Name(id='name', ctx=Load()), Name(id='tuple', ctx=Load())], keywords=[]), body=[Assign(targets=[Tuple(elts=[Name(id='name', ctx=Store()), Name(id='alias', ctx=Store())], ctx=Store())], value=Name(id='name', ctx=Load()))], orelse=[Assign(targets=[Name(id='alias', ctx=Store())], value=Name(id='name', ctx=Load()))]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Call(func=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='symbols', ctx=Load()), attr='ref', ctx=Load()), args=[Name(id='alias', ctx=Load())], keywords=[]), conversion=-1), Constant(value=' = getattr(included_template, '), FormattedValue(value=Name(id='name', ctx=Load()), conversion=114), Constant(value=', missing)')])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='if '), FormattedValue(value=Call(func=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='symbols', ctx=Load()), attr='ref', ctx=Load()), args=[Name(id='alias', ctx=Load())], keywords=[]), conversion=-1), Constant(value=' is missing:')])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Assign(targets=[Name(id='message', ctx=Store())], value=JoinedStr(values=[Constant(value='the template {included_template.__name__!r} (imported on '), FormattedValue(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='position', ctx=Load()), args=[Name(id='node', ctx=Load())], keywords=[]), conversion=-1), Constant(value=') does not export the requested name '), FormattedValue(value=Name(id='name', ctx=Load()), conversion=114)])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Call(func=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='symbols', ctx=Load()), attr='ref', ctx=Load()), args=[Name(id='alias', ctx=Load())], keywords=[]), conversion=-1), Constant(value=' = undefined(f'), FormattedValue(value=Name(id='message', ctx=Load()), conversion=114), Constant(value=', name='), FormattedValue(value=Name(id='name', ctx=Load()), conversion=114), Constant(value=')')])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[])), If(test=Attribute(value=Name(id='frame', ctx=Load()), attr='toplevel', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='var_names', ctx=Load()), attr='append', ctx=Load()), args=[Name(id='alias', ctx=Load())], keywords=[])), If(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='alias', ctx=Load()), attr='startswith', ctx=Load()), args=[Constant(value='_')], keywords=[])), body=[Expr(value=Call(func=Attribute(value=Name(id='discarded_names', ctx=Load()), attr='append', ctx=Load()), args=[Name(id='alias', ctx=Load())], keywords=[]))], orelse=[])], orelse=[])], orelse=[]), If(test=Name(id='var_names', ctx=Load()), body=[If(test=Compare(left=Call(func=Name(id='len', ctx=Load()), args=[Name(id='var_names', ctx=Load())], keywords=[]), ops=[Eq()], comparators=[Constant(value=1)]), body=[Assign(targets=[Name(id='name', ctx=Store())], value=Subscript(value=Name(id='var_names', ctx=Load()), slice=Constant(value=0), ctx=Load())), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='context.vars['), FormattedValue(value=Name(id='name', ctx=Load()), conversion=114), Constant(value='] = '), FormattedValue(value=Call(func=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='symbols', ctx=Load()), attr='ref', ctx=Load()), args=[Name(id='name', ctx=Load())], keywords=[]), conversion=-1)])], keywords=[]))], orelse=[Assign(targets=[Name(id='names_kv', ctx=Store())], value=Call(func=Attribute(value=Constant(value=', '), attr='join', ctx=Load()), args=[GeneratorExp(elt=JoinedStr(values=[FormattedValue(value=Name(id='name', ctx=Load()), conversion=114), Constant(value=': '), FormattedValue(value=Call(func=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='symbols', ctx=Load()), attr='ref', ctx=Load()), args=[Name(id='name', ctx=Load())], keywords=[]), conversion=-1)]), generators=[comprehension(target=Name(id='name', ctx=Store()), iter=Name(id='var_names', ctx=Load()), ifs=[], is_async=0)])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='context.vars.update({'), FormattedValue(value=Name(id='names_kv', ctx=Load()), conversion=-1), Constant(value='})')])], keywords=[]))])], orelse=[]), If(test=Name(id='discarded_names', ctx=Load()), body=[If(test=Compare(left=Call(func=Name(id='len', ctx=Load()), args=[Name(id='discarded_names', ctx=Load())], keywords=[]), ops=[Eq()], comparators=[Constant(value=1)]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='context.exported_vars.discard('), FormattedValue(value=Subscript(value=Name(id='discarded_names', ctx=Load()), slice=Constant(value=0), ctx=Load()), conversion=114), Constant(value=')')])], keywords=[]))], orelse=[Assign(targets=[Name(id='names_str', ctx=Store())], value=Call(func=Attribute(value=Constant(value=', '), attr='join', ctx=Load()), args=[Call(func=Name(id='map', ctx=Load()), args=[Name(id='repr', ctx=Load()), Name(id='discarded_names', ctx=Load())], keywords=[])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='context.exported_vars.difference_update(('), FormattedValue(value=Name(id='names_str', ctx=Load()), conversion=-1), Constant(value='))')])], keywords=[]))])], orelse=[])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_For', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='For', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='loop_frame', ctx=Store())], value=Call(func=Attribute(value=Name(id='frame', ctx=Load()), attr='inner', ctx=Load()), args=[], keywords=[])), Assign(targets=[Attribute(value=Name(id='loop_frame', ctx=Load()), attr='loop_frame', ctx=Store())], value=Constant(value=True)), Assign(targets=[Name(id='test_frame', ctx=Store())], value=Call(func=Attribute(value=Name(id='frame', ctx=Load()), attr='inner', ctx=Load()), args=[], keywords=[])), Assign(targets=[Name(id='else_frame', ctx=Store())], value=Call(func=Attribute(value=Name(id='frame', ctx=Load()), attr='inner', ctx=Load()), args=[], keywords=[])), Assign(targets=[Name(id='extended_loop', ctx=Store())], value=BoolOp(op=Or(), values=[Attribute(value=Name(id='node', ctx=Load()), attr='recursive', ctx=Load()), Compare(left=Constant(value='loop'), ops=[In()], comparators=[Call(func=Name(id='find_undeclared', ctx=Load()), args=[Call(func=Attribute(value=Name(id='node', ctx=Load()), attr='iter_child_nodes', ctx=Load()), args=[], keywords=[keyword(arg='only', value=Tuple(elts=[Constant(value='body')], ctx=Load()))]), Tuple(elts=[Constant(value='loop')], ctx=Load())], keywords=[])]), Call(func=Name(id='any', ctx=Load()), args=[GeneratorExp(elt=Attribute(value=Name(id='block', ctx=Load()), attr='scoped', ctx=Load()), generators=[comprehension(target=Name(id='block', ctx=Store()), iter=Call(func=Attribute(value=Name(id='node', ctx=Load()), attr='find_all', ctx=Load()), args=[Attribute(value=Name(id='nodes', ctx=Load()), attr='Block', ctx=Load())], keywords=[]), ifs=[], is_async=0)])], keywords=[])])), Assign(targets=[Name(id='loop_ref', ctx=Store())], value=Constant(value=None)), If(test=Name(id='extended_loop', ctx=Load()), body=[Assign(targets=[Name(id='loop_ref', ctx=Store())], value=Call(func=Attribute(value=Attribute(value=Name(id='loop_frame', ctx=Load()), attr='symbols', ctx=Load()), attr='declare_parameter', ctx=Load()), args=[Constant(value='loop')], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='loop_frame', ctx=Load()), attr='symbols', ctx=Load()), attr='analyze_node', ctx=Load()), args=[Name(id='node', ctx=Load())], keywords=[keyword(arg='for_branch', value=Constant(value='body'))])), If(test=Attribute(value=Name(id='node', ctx=Load()), attr='else_', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='else_frame', ctx=Load()), attr='symbols', ctx=Load()), attr='analyze_node', ctx=Load()), args=[Name(id='node', ctx=Load())], keywords=[keyword(arg='for_branch', value=Constant(value='else'))]))], orelse=[]), If(test=Attribute(value=Name(id='node', ctx=Load()), attr='test', ctx=Load()), body=[Assign(targets=[Name(id='loop_filter_func', ctx=Store())], value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='temporary_identifier', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='test_frame', ctx=Load()), attr='symbols', ctx=Load()), attr='analyze_node', ctx=Load()), args=[Name(id='node', ctx=Load())], keywords=[keyword(arg='for_branch', value=Constant(value='test'))])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='func', ctx=Load()), args=[Name(id='loop_filter_func', ctx=Load())], keywords=[]), conversion=-1), Constant(value='(fiter):')]), Attribute(value=Name(id='node', ctx=Load()), attr='test', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='enter_frame', ctx=Load()), args=[Name(id='test_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='choose_async', ctx=Load()), args=[Constant(value='async for '), Constant(value='for ')], keywords=[])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='target', ctx=Load()), Name(id='loop_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=' in ')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='choose_async', ctx=Load()), args=[Constant(value='auto_aiter(fiter)'), Constant(value='fiter')], keywords=[])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=':')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='if '), Attribute(value=Name(id='node', ctx=Load()), attr='test', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='test', ctx=Load()), Name(id='test_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=':')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='yield ')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='target', ctx=Load()), Name(id='loop_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[Constant(value=3)], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='leave_frame', ctx=Load()), args=[Name(id='test_frame', ctx=Load())], keywords=[keyword(arg='with_python_scope', value=Constant(value=True))]))], orelse=[]), If(test=Attribute(value=Name(id='node', ctx=Load()), attr='recursive', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='func', ctx=Load()), args=[Constant(value='loop')], keywords=[]), conversion=-1), Constant(value='(reciter, loop_render_func, depth=0):')]), Name(id='node', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='buffer', ctx=Load()), args=[Name(id='loop_frame', ctx=Load())], keywords=[])), Assign(targets=[Attribute(value=Name(id='else_frame', ctx=Load()), attr='buffer', ctx=Store())], value=Attribute(value=Name(id='loop_frame', ctx=Load()), attr='buffer', ctx=Load()))], orelse=[]), If(test=Name(id='extended_loop', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Name(id='loop_ref', ctx=Load()), conversion=-1), Constant(value=' = missing')])], keywords=[]))], orelse=[]), For(target=Name(id='name', ctx=Store()), iter=Call(func=Attribute(value=Name(id='node', ctx=Load()), attr='find_all', ctx=Load()), args=[Attribute(value=Name(id='nodes', ctx=Load()), attr='Name', ctx=Load())], keywords=[]), body=[If(test=BoolOp(op=And(), values=[Compare(left=Attribute(value=Name(id='name', ctx=Load()), attr='ctx', ctx=Load()), ops=[Eq()], comparators=[Constant(value='store')]), Compare(left=Attribute(value=Name(id='name', ctx=Load()), attr='name', ctx=Load()), ops=[Eq()], comparators=[Constant(value='loop')])]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='fail', ctx=Load()), args=[Constant(value="Can't assign to special loop variable in for-loop target"), Attribute(value=Name(id='name', ctx=Load()), attr='lineno', ctx=Load())], keywords=[]))], orelse=[])], orelse=[]), If(test=Attribute(value=Name(id='node', ctx=Load()), attr='else_', ctx=Load()), body=[Assign(targets=[Name(id='iteration_indicator', ctx=Store())], value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='temporary_identifier', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Name(id='iteration_indicator', ctx=Load()), conversion=-1), Constant(value=' = 1')])], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='choose_async', ctx=Load()), args=[Constant(value='async for '), Constant(value='for ')], keywords=[]), Name(id='node', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='target', ctx=Load()), Name(id='loop_frame', ctx=Load())], keywords=[])), If(test=Name(id='extended_loop', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[Constant(value=', '), FormattedValue(value=Name(id='loop_ref', ctx=Load()), conversion=-1), Constant(value=' in '), FormattedValue(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='choose_async', ctx=Load()), args=[Constant(value='Async')], keywords=[]), conversion=-1), Constant(value='LoopContext(')])], keywords=[]))], orelse=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=' in ')], keywords=[]))]), If(test=Attribute(value=Name(id='node', ctx=Load()), attr='test', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Name(id='loop_filter_func', ctx=Load()), conversion=-1), Constant(value='(')])], keywords=[]))], orelse=[]), If(test=Attribute(value=Name(id='node', ctx=Load()), attr='recursive', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='reciter')], keywords=[]))], orelse=[If(test=BoolOp(op=And(), values=[Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), attr='is_async', ctx=Load()), UnaryOp(op=Not(), operand=Name(id='extended_loop', ctx=Load()))]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='auto_aiter(')], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='iter', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), If(test=BoolOp(op=And(), values=[Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), attr='is_async', ctx=Load()), UnaryOp(op=Not(), operand=Name(id='extended_loop', ctx=Load()))]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=')')], keywords=[]))], orelse=[])]), If(test=Attribute(value=Name(id='node', ctx=Load()), attr='test', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=')')], keywords=[]))], orelse=[]), If(test=Attribute(value=Name(id='node', ctx=Load()), attr='recursive', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=', undefined, loop_render_func, depth):')], keywords=[]))], orelse=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[IfExp(test=Name(id='extended_loop', ctx=Load()), body=Constant(value=', undefined):'), orelse=Constant(value=':'))], keywords=[]))]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='enter_frame', ctx=Load()), args=[Name(id='loop_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='_loop_vars = {}')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='blockvisit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='body', ctx=Load()), Name(id='loop_frame', ctx=Load())], keywords=[])), If(test=Attribute(value=Name(id='node', ctx=Load()), attr='else_', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Name(id='iteration_indicator', ctx=Load()), conversion=-1), Constant(value=' = 0')])], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='leave_frame', ctx=Load()), args=[Name(id='loop_frame', ctx=Load())], keywords=[keyword(arg='with_python_scope', value=BoolOp(op=And(), values=[Attribute(value=Name(id='node', ctx=Load()), attr='recursive', ctx=Load()), UnaryOp(op=Not(), operand=Attribute(value=Name(id='node', ctx=Load()), attr='else_', ctx=Load()))]))])), If(test=Attribute(value=Name(id='node', ctx=Load()), attr='else_', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='if '), FormattedValue(value=Name(id='iteration_indicator', ctx=Load()), conversion=-1), Constant(value=':')])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='enter_frame', ctx=Load()), args=[Name(id='else_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='blockvisit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='else_', ctx=Load()), Name(id='else_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='leave_frame', ctx=Load()), args=[Name(id='else_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[]))], orelse=[]), If(test=Attribute(value=Name(id='node', ctx=Load()), attr='recursive', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='return_buffer_contents', ctx=Load()), args=[Name(id='loop_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='start_write', ctx=Load()), args=[Name(id='frame', ctx=Load()), Name(id='node', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='choose_async', ctx=Load()), args=[Constant(value='await ')], keywords=[]), conversion=-1), Constant(value='loop(')])], keywords=[])), If(test=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), attr='is_async', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='auto_aiter(')], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='iter', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), If(test=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), attr='is_async', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=')')], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=', loop)')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='end_write', ctx=Load()), args=[Name(id='frame', ctx=Load())], keywords=[]))], orelse=[]), If(test=Attribute(value=Name(id='self', ctx=Load()), attr='_assign_stack', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Subscript(value=Attribute(value=Name(id='self', ctx=Load()), attr='_assign_stack', ctx=Load()), slice=UnaryOp(op=USub(), operand=Constant(value=1)), ctx=Load()), attr='difference_update', ctx=Load()), args=[Attribute(value=Attribute(value=Name(id='loop_frame', ctx=Load()), attr='symbols', ctx=Load()), attr='stores', ctx=Load())], keywords=[]))], orelse=[])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_If', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='If', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='if_frame', ctx=Store())], value=Call(func=Attribute(value=Name(id='frame', ctx=Load()), attr='soft', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='if '), Name(id='node', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='test', ctx=Load()), Name(id='if_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=':')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='blockvisit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='body', ctx=Load()), Name(id='if_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[])), For(target=Name(id='elif_', ctx=Store()), iter=Attribute(value=Name(id='node', ctx=Load()), attr='elif_', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='elif '), Name(id='elif_', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='elif_', ctx=Load()), attr='test', ctx=Load()), Name(id='if_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=':')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='blockvisit', ctx=Load()), args=[Attribute(value=Name(id='elif_', ctx=Load()), attr='body', ctx=Load()), Name(id='if_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[]))], orelse=[]), If(test=Attribute(value=Name(id='node', ctx=Load()), attr='else_', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='else:')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='blockvisit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='else_', ctx=Load()), Name(id='if_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[]))], orelse=[])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_Macro', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Macro', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Tuple(elts=[Name(id='macro_frame', ctx=Store()), Name(id='macro_ref', ctx=Store())], ctx=Store())], value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='macro_body', ctx=Load()), args=[Name(id='node', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='newline', ctx=Load()), args=[], keywords=[])), If(test=Attribute(value=Name(id='frame', ctx=Load()), attr='toplevel', ctx=Load()), body=[If(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Attribute(value=Name(id='node', ctx=Load()), attr='name', ctx=Load()), attr='startswith', ctx=Load()), args=[Constant(value='_')], keywords=[])), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[Constant(value='context.exported_vars.add('), FormattedValue(value=Attribute(value=Name(id='node', ctx=Load()), attr='name', ctx=Load()), conversion=114), Constant(value=')')])], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='context.vars['), FormattedValue(value=Attribute(value=Name(id='node', ctx=Load()), attr='name', ctx=Load()), conversion=114), Constant(value='] = ')])], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Call(func=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='symbols', ctx=Load()), attr='ref', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='name', ctx=Load())], keywords=[]), conversion=-1), Constant(value=' = ')])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='macro_def', ctx=Load()), args=[Name(id='macro_ref', ctx=Load()), Name(id='macro_frame', ctx=Load())], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_CallBlock', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='CallBlock', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Tuple(elts=[Name(id='call_frame', ctx=Store()), Name(id='macro_ref', ctx=Store())], ctx=Store())], value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='macro_body', ctx=Load()), args=[Name(id='node', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='caller = ')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='macro_def', ctx=Load()), args=[Name(id='macro_ref', ctx=Load()), Name(id='call_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='start_write', ctx=Load()), args=[Name(id='frame', ctx=Load()), Name(id='node', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit_Call', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='call', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[keyword(arg='forward_caller', value=Constant(value=True))])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='end_write', ctx=Load()), args=[Name(id='frame', ctx=Load())], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_FilterBlock', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='FilterBlock', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='filter_frame', ctx=Store())], value=Call(func=Attribute(value=Name(id='frame', ctx=Load()), attr='inner', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='filter_frame', ctx=Load()), attr='symbols', ctx=Load()), attr='analyze_node', ctx=Load()), args=[Name(id='node', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='enter_frame', ctx=Load()), args=[Name(id='filter_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='buffer', ctx=Load()), args=[Name(id='filter_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='blockvisit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='body', ctx=Load()), Name(id='filter_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='start_write', ctx=Load()), args=[Name(id='frame', ctx=Load()), Name(id='node', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit_Filter', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='filter', ctx=Load()), Name(id='filter_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='end_write', ctx=Load()), args=[Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='leave_frame', ctx=Load()), args=[Name(id='filter_frame', ctx=Load())], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_With', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='With', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='with_frame', ctx=Store())], value=Call(func=Attribute(value=Name(id='frame', ctx=Load()), attr='inner', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='with_frame', ctx=Load()), attr='symbols', ctx=Load()), attr='analyze_node', ctx=Load()), args=[Name(id='node', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='enter_frame', ctx=Load()), args=[Name(id='with_frame', ctx=Load())], keywords=[])), For(target=Tuple(elts=[Name(id='target', ctx=Store()), Name(id='expr', ctx=Store())], ctx=Store()), iter=Call(func=Name(id='zip', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='targets', ctx=Load()), Attribute(value=Name(id='node', ctx=Load()), attr='values', ctx=Load())], keywords=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='newline', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Name(id='target', ctx=Load()), Name(id='with_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=' = ')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Name(id='expr', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='blockvisit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='body', ctx=Load()), Name(id='with_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='leave_frame', ctx=Load()), args=[Name(id='with_frame', ctx=Load())], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_ExprStmt', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='ExprStmt', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='newline', ctx=Load()), args=[Name(id='node', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='node', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[]))], decorator_list=[], returns=Constant(value=None)), ClassDef(name='_FinalizeInfo', bases=[Attribute(value=Name(id='t', ctx=Load()), attr='NamedTuple', ctx=Load())], keywords=[], body=[AnnAssign(target=Name(id='const', ctx=Store()), annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Optional', ctx=Load()), slice=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Callable', ctx=Load()), slice=Tuple(elts=[Constant(value=Ellipsis), Name(id='str', ctx=Load())], ctx=Load()), ctx=Load()), ctx=Load()), simple=1), AnnAssign(target=Name(id='src', ctx=Store()), annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Optional', ctx=Load()), slice=Name(id='str', ctx=Load()), ctx=Load()), simple=1)], decorator_list=[]), FunctionDef(name='_default_finalize', args=arguments(posonlyargs=[], args=[arg(arg='value', annotation=Attribute(value=Name(id='t', ctx=Load()), attr='Any', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value="The default finalize function if the environment isn't\n        configured with one. Or, if the environment has one, this is\n        called on that function's output for constants.\n        ")), Return(value=Call(func=Name(id='str', ctx=Load()), args=[Name(id='value', ctx=Load())], keywords=[]))], decorator_list=[Name(id='staticmethod', ctx=Load())], returns=Attribute(value=Name(id='t', ctx=Load()), attr='Any', ctx=Load())), AnnAssign(target=Name(id='_finalize', ctx=Store()), annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Optional', ctx=Load()), slice=Name(id='_FinalizeInfo', ctx=Load()), ctx=Load()), value=Constant(value=None), simple=1), FunctionDef(name='_make_finalize', args=arguments(posonlyargs=[], args=[arg(arg='self')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value="Build the finalize function to be used on constants and at\n        runtime. Cached so it's only created once for all output nodes.\n\n        Returns a ``namedtuple`` with the following attributes:\n\n        ``const``\n            A function to finalize constant data at compile time.\n\n        ``src``\n            Source code to output around nodes to be evaluated at\n            runtime.\n        ")), If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load()), attr='_finalize', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[Return(value=Attribute(value=Name(id='self', ctx=Load()), attr='_finalize', ctx=Load()))], orelse=[]), AnnAssign(target=Name(id='finalize', ctx=Store()), annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Optional', ctx=Load()), slice=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Callable', ctx=Load()), slice=Tuple(elts=[Constant(value=Ellipsis), Attribute(value=Name(id='t', ctx=Load()), attr='Any', ctx=Load())], ctx=Load()), ctx=Load()), ctx=Load()), simple=1), Assign(targets=[Name(id='finalize', ctx=Store()), Name(id='default', ctx=Store())], value=Attribute(value=Name(id='self', ctx=Load()), attr='_default_finalize', ctx=Load())), Assign(targets=[Name(id='src', ctx=Store())], value=Constant(value=None)), If(test=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), attr='finalize', ctx=Load()), body=[Assign(targets=[Name(id='src', ctx=Store())], value=Constant(value='environment.finalize(')), Assign(targets=[Name(id='env_finalize', ctx=Store())], value=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), attr='finalize', ctx=Load())), Assign(targets=[Name(id='pass_arg', ctx=Store())], value=Call(func=Attribute(value=Dict(keys=[Attribute(value=Name(id='_PassArg', ctx=Load()), attr='context', ctx=Load()), Attribute(value=Name(id='_PassArg', ctx=Load()), attr='eval_context', ctx=Load()), Attribute(value=Name(id='_PassArg', ctx=Load()), attr='environment', ctx=Load())], values=[Constant(value='context'), Constant(value='context.eval_ctx'), Constant(value='environment')]), attr='get', ctx=Load()), args=[Call(func=Attribute(value=Name(id='_PassArg', ctx=Load()), attr='from_obj', ctx=Load()), args=[Name(id='env_finalize', ctx=Load())], keywords=[])], keywords=[])), Assign(targets=[Name(id='finalize', ctx=Store())], value=Constant(value=None)), If(test=Compare(left=Name(id='pass_arg', ctx=Load()), ops=[Is()], comparators=[Constant(value=None)]), body=[FunctionDef(name='finalize', args=arguments(posonlyargs=[], args=[arg(arg='value', annotation=Attribute(value=Name(id='t', ctx=Load()), attr='Any', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Return(value=Call(func=Name(id='default', ctx=Load()), args=[Call(func=Name(id='env_finalize', ctx=Load()), args=[Name(id='value', ctx=Load())], keywords=[])], keywords=[]))], decorator_list=[], returns=Attribute(value=Name(id='t', ctx=Load()), attr='Any', ctx=Load()))], orelse=[Assign(targets=[Name(id='src', ctx=Store())], value=JoinedStr(values=[FormattedValue(value=Name(id='src', ctx=Load()), conversion=-1), FormattedValue(value=Name(id='pass_arg', ctx=Load()), conversion=-1), Constant(value=', ')])), If(test=Compare(left=Name(id='pass_arg', ctx=Load()), ops=[Eq()], comparators=[Constant(value='environment')]), body=[FunctionDef(name='finalize', args=arguments(posonlyargs=[], args=[arg(arg='value', annotation=Attribute(value=Name(id='t', ctx=Load()), attr='Any', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Return(value=Call(func=Name(id='default', ctx=Load()), args=[Call(func=Name(id='env_finalize', ctx=Load()), args=[Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), Name(id='value', ctx=Load())], keywords=[])], keywords=[]))], decorator_list=[], returns=Attribute(value=Name(id='t', ctx=Load()), attr='Any', ctx=Load()))], orelse=[])])], orelse=[]), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='_finalize', ctx=Store())], value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='_FinalizeInfo', ctx=Load()), args=[Name(id='finalize', ctx=Load()), Name(id='src', ctx=Load())], keywords=[])), Return(value=Attribute(value=Name(id='self', ctx=Load()), attr='_finalize', ctx=Load()))], decorator_list=[], returns=Name(id='_FinalizeInfo', ctx=Load())), FunctionDef(name='_output_const_repr', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='group', annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Iterable', ctx=Load()), slice=Attribute(value=Name(id='t', ctx=Load()), attr='Any', ctx=Load()), ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Given a group of constant values converted from ``Output``\n        child nodes, produce a string to write to the template module\n        source.\n        ')), Return(value=Call(func=Name(id='repr', ctx=Load()), args=[Call(func=Name(id='concat', ctx=Load()), args=[Name(id='group', ctx=Load())], keywords=[])], keywords=[]))], decorator_list=[], returns=Name(id='str', ctx=Load())), FunctionDef(name='_output_child_to_const', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Expr', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load())), arg(arg='finalize', annotation=Name(id='_FinalizeInfo', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Try to optimize a child of an ``Output`` node by trying to\n        convert it to constant, finalized data at compile time.\n\n        If :exc:`Impossible` is raised, the node is not constant and\n        will be evaluated at runtime. Any other exception will also be\n        evaluated at runtime for easier debugging.\n        ')), Assign(targets=[Name(id='const', ctx=Store())], value=Call(func=Attribute(value=Name(id='node', ctx=Load()), attr='as_const', ctx=Load()), args=[Attribute(value=Name(id='frame', ctx=Load()), attr='eval_ctx', ctx=Load())], keywords=[])), If(test=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='eval_ctx', ctx=Load()), attr='autoescape', ctx=Load()), body=[Assign(targets=[Name(id='const', ctx=Store())], value=Call(func=Name(id='escape', ctx=Load()), args=[Name(id='const', ctx=Load())], keywords=[]))], orelse=[]), If(test=Call(func=Name(id='isinstance', ctx=Load()), args=[Name(id='node', ctx=Load()), Attribute(value=Name(id='nodes', ctx=Load()), attr='TemplateData', ctx=Load())], keywords=[]), body=[Return(value=Call(func=Name(id='str', ctx=Load()), args=[Name(id='const', ctx=Load())], keywords=[]))], orelse=[]), Return(value=Call(func=Attribute(value=Name(id='finalize', ctx=Load()), attr='const', ctx=Load()), args=[Name(id='const', ctx=Load())], keywords=[]))], decorator_list=[], returns=Name(id='str', ctx=Load())), FunctionDef(name='_output_child_pre', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Expr', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load())), arg(arg='finalize', annotation=Name(id='_FinalizeInfo', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Output extra source code before visiting a child of an\n        ``Output`` node.\n        ')), If(test=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='eval_ctx', ctx=Load()), attr='volatile', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='(escape if context.eval_ctx.autoescape else str)(')], keywords=[]))], orelse=[If(test=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='eval_ctx', ctx=Load()), attr='autoescape', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='escape(')], keywords=[]))], orelse=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='str(')], keywords=[]))])]), If(test=Compare(left=Attribute(value=Name(id='finalize', ctx=Load()), attr='src', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Attribute(value=Name(id='finalize', ctx=Load()), attr='src', ctx=Load())], keywords=[]))], orelse=[])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='_output_child_post', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Expr', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load())), arg(arg='finalize', annotation=Name(id='_FinalizeInfo', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Output extra source code after visiting a child of an\n        ``Output`` node.\n        ')), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=')')], keywords=[])), If(test=Compare(left=Attribute(value=Name(id='finalize', ctx=Load()), attr='src', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=')')], keywords=[]))], orelse=[])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_Output', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Output', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[If(test=Attribute(value=Name(id='frame', ctx=Load()), attr='require_output_check', ctx=Load()), body=[If(test=Attribute(value=Name(id='self', ctx=Load()), attr='has_known_extends', ctx=Load()), body=[Return()], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='if parent_template is None:')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[]))], orelse=[]), Assign(targets=[Name(id='finalize', ctx=Store())], value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='_make_finalize', ctx=Load()), args=[], keywords=[])), AnnAssign(target=Name(id='body', ctx=Store()), annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='List', ctx=Load()), slice=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Union', ctx=Load()), slice=Tuple(elts=[Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='List', ctx=Load()), slice=Attribute(value=Name(id='t', ctx=Load()), attr='Any', ctx=Load()), ctx=Load()), Attribute(value=Name(id='nodes', ctx=Load()), attr='Expr', ctx=Load())], ctx=Load()), ctx=Load()), ctx=Load()), value=List(elts=[], ctx=Load()), simple=1), For(target=Name(id='child', ctx=Store()), iter=Attribute(value=Name(id='node', ctx=Load()), attr='nodes', ctx=Load()), body=[Try(body=[If(test=UnaryOp(op=Not(), operand=BoolOp(op=Or(), values=[Attribute(value=Name(id='finalize', ctx=Load()), attr='const', ctx=Load()), Call(func=Name(id='isinstance', ctx=Load()), args=[Name(id='child', ctx=Load()), Attribute(value=Name(id='nodes', ctx=Load()), attr='TemplateData', ctx=Load())], keywords=[])])), body=[Raise(exc=Call(func=Attribute(value=Name(id='nodes', ctx=Load()), attr='Impossible', ctx=Load()), args=[], keywords=[]))], orelse=[]), Assign(targets=[Name(id='const', ctx=Store())], value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='_output_child_to_const', ctx=Load()), args=[Name(id='child', ctx=Load()), Name(id='frame', ctx=Load()), Name(id='finalize', ctx=Load())], keywords=[]))], handlers=[ExceptHandler(type=Tuple(elts=[Attribute(value=Name(id='nodes', ctx=Load()), attr='Impossible', ctx=Load()), Name(id='Exception', ctx=Load())], ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='body', ctx=Load()), attr='append', ctx=Load()), args=[Name(id='child', ctx=Load())], keywords=[])), Continue()])], orelse=[], finalbody=[]), If(test=BoolOp(op=And(), values=[Name(id='body', ctx=Load()), Call(func=Name(id='isinstance', ctx=Load()), args=[Subscript(value=Name(id='body', ctx=Load()), slice=UnaryOp(op=USub(), operand=Constant(value=1)), ctx=Load()), Name(id='list', ctx=Load())], keywords=[])]), body=[Expr(value=Call(func=Attribute(value=Subscript(value=Name(id='body', ctx=Load()), slice=UnaryOp(op=USub(), operand=Constant(value=1)), ctx=Load()), attr='append', ctx=Load()), args=[Name(id='const', ctx=Load())], keywords=[]))], orelse=[Expr(value=Call(func=Attribute(value=Name(id='body', ctx=Load()), attr='append', ctx=Load()), args=[List(elts=[Name(id='const', ctx=Load())], ctx=Load())], keywords=[]))])], orelse=[]), If(test=Compare(left=Attribute(value=Name(id='frame', ctx=Load()), attr='buffer', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[If(test=Compare(left=Call(func=Name(id='len', ctx=Load()), args=[Name(id='body', ctx=Load())], keywords=[]), ops=[Eq()], comparators=[Constant(value=1)]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Attribute(value=Name(id='frame', ctx=Load()), attr='buffer', ctx=Load()), conversion=-1), Constant(value='.append(')])], keywords=[]))], orelse=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Attribute(value=Name(id='frame', ctx=Load()), attr='buffer', ctx=Load()), conversion=-1), Constant(value='.extend((')])], keywords=[]))]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[]))], orelse=[]), For(target=Name(id='item', ctx=Store()), iter=Name(id='body', ctx=Load()), body=[If(test=Call(func=Name(id='isinstance', ctx=Load()), args=[Name(id='item', ctx=Load()), Name(id='list', ctx=Load())], keywords=[]), body=[Assign(targets=[Name(id='val', ctx=Store())], value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='_output_const_repr', ctx=Load()), args=[Name(id='item', ctx=Load())], keywords=[])), If(test=Compare(left=Attribute(value=Name(id='frame', ctx=Load()), attr='buffer', ctx=Load()), ops=[Is()], comparators=[Constant(value=None)]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[BinOp(left=Constant(value='yield '), op=Add(), right=Name(id='val', ctx=Load()))], keywords=[]))], orelse=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[BinOp(left=Name(id='val', ctx=Load()), op=Add(), right=Constant(value=','))], keywords=[]))])], orelse=[If(test=Compare(left=Attribute(value=Name(id='frame', ctx=Load()), attr='buffer', ctx=Load()), ops=[Is()], comparators=[Constant(value=None)]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='yield '), Name(id='item', ctx=Load())], keywords=[]))], orelse=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='newline', ctx=Load()), args=[Name(id='item', ctx=Load())], keywords=[]))]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='_output_child_pre', ctx=Load()), args=[Name(id='item', ctx=Load()), Name(id='frame', ctx=Load()), Name(id='finalize', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Name(id='item', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='_output_child_post', ctx=Load()), args=[Name(id='item', ctx=Load()), Name(id='frame', ctx=Load()), Name(id='finalize', ctx=Load())], keywords=[])), If(test=Compare(left=Attribute(value=Name(id='frame', ctx=Load()), attr='buffer', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=',')], keywords=[]))], orelse=[])])], orelse=[]), If(test=Compare(left=Attribute(value=Name(id='frame', ctx=Load()), attr='buffer', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[IfExp(test=Compare(left=Call(func=Name(id='len', ctx=Load()), args=[Name(id='body', ctx=Load())], keywords=[]), ops=[Eq()], comparators=[Constant(value=1)]), body=Constant(value=')'), orelse=Constant(value='))'))], keywords=[]))], orelse=[]), If(test=Attribute(value=Name(id='frame', ctx=Load()), attr='require_output_check', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[]))], orelse=[])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_Assign', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Assign', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='push_assign_tracking', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='newline', ctx=Load()), args=[Name(id='node', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='target', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=' = ')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='node', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='pop_assign_tracking', ctx=Load()), args=[Name(id='frame', ctx=Load())], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_AssignBlock', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='AssignBlock', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='push_assign_tracking', ctx=Load()), args=[], keywords=[])), Assign(targets=[Name(id='block_frame', ctx=Store())], value=Call(func=Attribute(value=Name(id='frame', ctx=Load()), attr='inner', ctx=Load()), args=[], keywords=[])), Assign(targets=[Attribute(value=Name(id='block_frame', ctx=Load()), attr='require_output_check', ctx=Store())], value=Constant(value=False)), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='block_frame', ctx=Load()), attr='symbols', ctx=Load()), attr='analyze_node', ctx=Load()), args=[Name(id='node', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='enter_frame', ctx=Load()), args=[Name(id='block_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='buffer', ctx=Load()), args=[Name(id='block_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='blockvisit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='body', ctx=Load()), Name(id='block_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='newline', ctx=Load()), args=[Name(id='node', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='target', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=' = (Markup if context.eval_ctx.autoescape else identity)(')], keywords=[])), If(test=Compare(left=Attribute(value=Name(id='node', ctx=Load()), attr='filter', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit_Filter', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='filter', ctx=Load()), Name(id='block_frame', ctx=Load())], keywords=[]))], orelse=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[Constant(value='concat('), FormattedValue(value=Attribute(value=Name(id='block_frame', ctx=Load()), attr='buffer', ctx=Load()), conversion=-1), Constant(value=')')])], keywords=[]))]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=')')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='pop_assign_tracking', ctx=Load()), args=[Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='leave_frame', ctx=Load()), args=[Name(id='block_frame', ctx=Load())], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_Name', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Name', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[If(test=BoolOp(op=And(), values=[Compare(left=Attribute(value=Name(id='node', ctx=Load()), attr='ctx', ctx=Load()), ops=[Eq()], comparators=[Constant(value='store')]), BoolOp(op=Or(), values=[Attribute(value=Name(id='frame', ctx=Load()), attr='toplevel', ctx=Load()), Attribute(value=Name(id='frame', ctx=Load()), attr='loop_frame', ctx=Load()), Attribute(value=Name(id='frame', ctx=Load()), attr='block_frame', ctx=Load())])]), body=[If(test=Attribute(value=Name(id='self', ctx=Load()), attr='_assign_stack', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Subscript(value=Attribute(value=Name(id='self', ctx=Load()), attr='_assign_stack', ctx=Load()), slice=UnaryOp(op=USub(), operand=Constant(value=1)), ctx=Load()), attr='add', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='name', ctx=Load())], keywords=[]))], orelse=[])], orelse=[]), Assign(targets=[Name(id='ref', ctx=Store())], value=Call(func=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='symbols', ctx=Load()), attr='ref', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='name', ctx=Load())], keywords=[])), If(test=Compare(left=Attribute(value=Name(id='node', ctx=Load()), attr='ctx', ctx=Load()), ops=[Eq()], comparators=[Constant(value='load')]), body=[Assign(targets=[Name(id='load', ctx=Store())], value=Call(func=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='symbols', ctx=Load()), attr='find_load', ctx=Load()), args=[Name(id='ref', ctx=Load())], keywords=[])), If(test=UnaryOp(op=Not(), operand=BoolOp(op=And(), values=[Compare(left=Name(id='load', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), Compare(left=Subscript(value=Name(id='load', ctx=Load()), slice=Constant(value=0), ctx=Load()), ops=[Eq()], comparators=[Name(id='VAR_LOAD_PARAMETER', ctx=Load())]), UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='parameter_is_undeclared', ctx=Load()), args=[Name(id='ref', ctx=Load())], keywords=[]))])), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[Constant(value='(undefined(name='), FormattedValue(value=Attribute(value=Name(id='node', ctx=Load()), attr='name', ctx=Load()), conversion=114), Constant(value=') if '), FormattedValue(value=Name(id='ref', ctx=Load()), conversion=-1), Constant(value=' is missing else '), FormattedValue(value=Name(id='ref', ctx=Load()), conversion=-1), Constant(value=')')])], keywords=[])), Return()], orelse=[])], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Name(id='ref', ctx=Load())], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_NSRef', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='NSRef', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='ref', ctx=Store())], value=Call(func=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='symbols', ctx=Load()), attr='ref', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='name', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='if not isinstance('), FormattedValue(value=Name(id='ref', ctx=Load()), conversion=-1), Constant(value=', Namespace):')])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='indent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='raise TemplateRuntimeError("cannot assign attribute on non-namespace object")')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='outdent', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Name(id='ref', ctx=Load()), conversion=-1), Constant(value='['), FormattedValue(value=Attribute(value=Name(id='node', ctx=Load()), attr='attr', ctx=Load()), conversion=114), Constant(value=']')])], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_Const', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Const', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='val', ctx=Store())], value=Call(func=Attribute(value=Name(id='node', ctx=Load()), attr='as_const', ctx=Load()), args=[Attribute(value=Name(id='frame', ctx=Load()), attr='eval_ctx', ctx=Load())], keywords=[])), If(test=Call(func=Name(id='isinstance', ctx=Load()), args=[Name(id='val', ctx=Load()), Name(id='float', ctx=Load())], keywords=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Call(func=Name(id='str', ctx=Load()), args=[Name(id='val', ctx=Load())], keywords=[])], keywords=[]))], orelse=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Call(func=Name(id='repr', ctx=Load()), args=[Name(id='val', ctx=Load())], keywords=[])], keywords=[]))])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_TemplateData', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='TemplateData', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Try(body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Call(func=Name(id='repr', ctx=Load()), args=[Call(func=Attribute(value=Name(id='node', ctx=Load()), attr='as_const', ctx=Load()), args=[Attribute(value=Name(id='frame', ctx=Load()), attr='eval_ctx', ctx=Load())], keywords=[])], keywords=[])], keywords=[]))], handlers=[ExceptHandler(type=Attribute(value=Name(id='nodes', ctx=Load()), attr='Impossible', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[Constant(value='(Markup if context.eval_ctx.autoescape else identity)('), FormattedValue(value=Attribute(value=Name(id='node', ctx=Load()), attr='data', ctx=Load()), conversion=114), Constant(value=')')])], keywords=[]))])], orelse=[], finalbody=[])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_Tuple', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Tuple', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='(')], keywords=[])), Assign(targets=[Name(id='idx', ctx=Store())], value=UnaryOp(op=USub(), operand=Constant(value=1))), For(target=Tuple(elts=[Name(id='idx', ctx=Store()), Name(id='item', ctx=Store())], ctx=Store()), iter=Call(func=Name(id='enumerate', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='items', ctx=Load())], keywords=[]), body=[If(test=Name(id='idx', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=', ')], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Name(id='item', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[IfExp(test=Compare(left=Name(id='idx', ctx=Load()), ops=[Eq()], comparators=[Constant(value=0)]), body=Constant(value=',)'), orelse=Constant(value=')'))], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_List', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='List', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='[')], keywords=[])), For(target=Tuple(elts=[Name(id='idx', ctx=Store()), Name(id='item', ctx=Store())], ctx=Store()), iter=Call(func=Name(id='enumerate', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='items', ctx=Load())], keywords=[]), body=[If(test=Name(id='idx', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=', ')], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Name(id='item', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=']')], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_Dict', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Dict', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='{')], keywords=[])), For(target=Tuple(elts=[Name(id='idx', ctx=Store()), Name(id='item', ctx=Store())], ctx=Store()), iter=Call(func=Name(id='enumerate', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='items', ctx=Load())], keywords=[]), body=[If(test=Name(id='idx', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=', ')], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='item', ctx=Load()), attr='key', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=': ')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='item', ctx=Load()), attr='value', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='}')], keywords=[]))], decorator_list=[], returns=Constant(value=None)), Assign(targets=[Name(id='visit_Add', ctx=Store())], value=Call(func=Name(id='_make_binop', ctx=Load()), args=[Constant(value='+')], keywords=[])), Assign(targets=[Name(id='visit_Sub', ctx=Store())], value=Call(func=Name(id='_make_binop', ctx=Load()), args=[Constant(value='-')], keywords=[])), Assign(targets=[Name(id='visit_Mul', ctx=Store())], value=Call(func=Name(id='_make_binop', ctx=Load()), args=[Constant(value='*')], keywords=[])), Assign(targets=[Name(id='visit_Div', ctx=Store())], value=Call(func=Name(id='_make_binop', ctx=Load()), args=[Constant(value='/')], keywords=[])), Assign(targets=[Name(id='visit_FloorDiv', ctx=Store())], value=Call(func=Name(id='_make_binop', ctx=Load()), args=[Constant(value='//')], keywords=[])), Assign(targets=[Name(id='visit_Pow', ctx=Store())], value=Call(func=Name(id='_make_binop', ctx=Load()), args=[Constant(value='**')], keywords=[])), Assign(targets=[Name(id='visit_Mod', ctx=Store())], value=Call(func=Name(id='_make_binop', ctx=Load()), args=[Constant(value='%')], keywords=[])), Assign(targets=[Name(id='visit_And', ctx=Store())], value=Call(func=Name(id='_make_binop', ctx=Load()), args=[Constant(value='and')], keywords=[])), Assign(targets=[Name(id='visit_Or', ctx=Store())], value=Call(func=Name(id='_make_binop', ctx=Load()), args=[Constant(value='or')], keywords=[])), Assign(targets=[Name(id='visit_Pos', ctx=Store())], value=Call(func=Name(id='_make_unop', ctx=Load()), args=[Constant(value='+')], keywords=[])), Assign(targets=[Name(id='visit_Neg', ctx=Store())], value=Call(func=Name(id='_make_unop', ctx=Load()), args=[Constant(value='-')], keywords=[])), Assign(targets=[Name(id='visit_Not', ctx=Store())], value=Call(func=Name(id='_make_unop', ctx=Load()), args=[Constant(value='not ')], keywords=[])), FunctionDef(name='visit_Concat', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Concat', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[If(test=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='eval_ctx', ctx=Load()), attr='volatile', ctx=Load()), body=[Assign(targets=[Name(id='func_name', ctx=Store())], value=Constant(value='(markup_join if context.eval_ctx.volatile else str_join)'))], orelse=[If(test=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='eval_ctx', ctx=Load()), attr='autoescape', ctx=Load()), body=[Assign(targets=[Name(id='func_name', ctx=Store())], value=Constant(value='markup_join'))], orelse=[Assign(targets=[Name(id='func_name', ctx=Store())], value=Constant(value='str_join'))])]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Name(id='func_name', ctx=Load()), conversion=-1), Constant(value='((')])], keywords=[])), For(target=Name(id='arg', ctx=Store()), iter=Attribute(value=Name(id='node', ctx=Load()), attr='nodes', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Name(id='arg', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=', ')], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='))')], keywords=[]))], decorator_list=[Name(id='optimizeconst', ctx=Load())], returns=Constant(value=None)), FunctionDef(name='visit_Compare', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Compare', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='(')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='expr', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), For(target=Name(id='op', ctx=Store()), iter=Attribute(value=Name(id='node', ctx=Load()), attr='ops', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Name(id='op', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=')')], keywords=[]))], decorator_list=[Name(id='optimizeconst', ctx=Load())], returns=Constant(value=None)), FunctionDef(name='visit_Operand', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Operand', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[Constant(value=' '), FormattedValue(value=Subscript(value=Name(id='operators', ctx=Load()), slice=Attribute(value=Name(id='node', ctx=Load()), attr='op', ctx=Load()), ctx=Load()), conversion=-1), Constant(value=' ')])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='expr', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_Getattr', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Getattr', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[If(test=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), attr='is_async', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='(await auto_await(')], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='environment.getattr(')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='node', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[Constant(value=', '), FormattedValue(value=Attribute(value=Name(id='node', ctx=Load()), attr='attr', ctx=Load()), conversion=114), Constant(value=')')])], keywords=[])), If(test=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), attr='is_async', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='))')], keywords=[]))], orelse=[])], decorator_list=[Name(id='optimizeconst', ctx=Load())], returns=Constant(value=None)), FunctionDef(name='visit_Getitem', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Getitem', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[If(test=Call(func=Name(id='isinstance', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='arg', ctx=Load()), Attribute(value=Name(id='nodes', ctx=Load()), attr='Slice', ctx=Load())], keywords=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='node', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='[')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='arg', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=']')], keywords=[]))], orelse=[If(test=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), attr='is_async', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='(await auto_await(')], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='environment.getitem(')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='node', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=', ')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='arg', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=')')], keywords=[])), If(test=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), attr='is_async', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='))')], keywords=[]))], orelse=[])])], decorator_list=[Name(id='optimizeconst', ctx=Load())], returns=Constant(value=None)), FunctionDef(name='visit_Slice', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Slice', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[If(test=Compare(left=Attribute(value=Name(id='node', ctx=Load()), attr='start', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='start', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=':')], keywords=[])), If(test=Compare(left=Attribute(value=Name(id='node', ctx=Load()), attr='stop', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='stop', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[]))], orelse=[]), If(test=Compare(left=Attribute(value=Name(id='node', ctx=Load()), attr='step', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=':')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='step', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[]))], orelse=[])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='_filter_test_common', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Union', ctx=Load()), slice=Tuple(elts=[Attribute(value=Name(id='nodes', ctx=Load()), attr='Filter', ctx=Load()), Attribute(value=Name(id='nodes', ctx=Load()), attr='Test', ctx=Load())], ctx=Load()), ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load())), arg(arg='is_filter', annotation=Name(id='bool', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[If(test=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), attr='is_async', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='(await auto_await(')], keywords=[]))], orelse=[]), If(test=Name(id='is_filter', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Subscript(value=Attribute(value=Name(id='self', ctx=Load()), attr='filters', ctx=Load()), slice=Attribute(value=Name(id='node', ctx=Load()), attr='name', ctx=Load()), ctx=Load()), conversion=-1), Constant(value='(')])], keywords=[])), Assign(targets=[Name(id='func', ctx=Store())], value=Call(func=Attribute(value=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), attr='filters', ctx=Load()), attr='get', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='name', ctx=Load())], keywords=[]))], orelse=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Subscript(value=Attribute(value=Name(id='self', ctx=Load()), attr='tests', ctx=Load()), slice=Attribute(value=Name(id='node', ctx=Load()), attr='name', ctx=Load()), ctx=Load()), conversion=-1), Constant(value='(')])], keywords=[])), Assign(targets=[Name(id='func', ctx=Store())], value=Call(func=Attribute(value=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), attr='tests', ctx=Load()), attr='get', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='name', ctx=Load())], keywords=[]))]), If(test=BoolOp(op=And(), values=[Compare(left=Name(id='func', ctx=Load()), ops=[Is()], comparators=[Constant(value=None)]), UnaryOp(op=Not(), operand=Attribute(value=Name(id='frame', ctx=Load()), attr='soft_frame', ctx=Load()))]), body=[Assign(targets=[Name(id='type_name', ctx=Store())], value=IfExp(test=Name(id='is_filter', ctx=Load()), body=Constant(value='filter'), orelse=Constant(value='test'))), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='fail', ctx=Load()), args=[JoinedStr(values=[Constant(value='No '), FormattedValue(value=Name(id='type_name', ctx=Load()), conversion=-1), Constant(value=' named '), FormattedValue(value=Attribute(value=Name(id='node', ctx=Load()), attr='name', ctx=Load()), conversion=114), Constant(value='.')]), Attribute(value=Name(id='node', ctx=Load()), attr='lineno', ctx=Load())], keywords=[]))], orelse=[]), Assign(targets=[Name(id='pass_arg', ctx=Store())], value=Call(func=Attribute(value=Dict(keys=[Attribute(value=Name(id='_PassArg', ctx=Load()), attr='context', ctx=Load()), Attribute(value=Name(id='_PassArg', ctx=Load()), attr='eval_context', ctx=Load()), Attribute(value=Name(id='_PassArg', ctx=Load()), attr='environment', ctx=Load())], values=[Constant(value='context'), Constant(value='context.eval_ctx'), Constant(value='environment')]), attr='get', ctx=Load()), args=[Call(func=Attribute(value=Name(id='_PassArg', ctx=Load()), attr='from_obj', ctx=Load()), args=[Name(id='func', ctx=Load())], keywords=[])], keywords=[])), If(test=Compare(left=Name(id='pass_arg', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Name(id='pass_arg', ctx=Load()), conversion=-1), Constant(value=', ')])], keywords=[]))], orelse=[]), Expr(value=Yield()), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='signature', ctx=Load()), args=[Name(id='node', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=')')], keywords=[])), If(test=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), attr='is_async', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='))')], keywords=[]))], orelse=[])], decorator_list=[Name(id='contextmanager', ctx=Load())], returns=Subscript(value=Attribute(value=Name(id='t', ctx=Load()), attr='Iterator', ctx=Load()), slice=Constant(value=None), ctx=Load())), FunctionDef(name='visit_Filter', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Filter', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='_filter_test_common', ctx=Load()), args=[Name(id='node', ctx=Load()), Name(id='frame', ctx=Load()), Constant(value=True)], keywords=[]))], body=[If(test=Compare(left=Attribute(value=Name(id='node', ctx=Load()), attr='node', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='node', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[]))], orelse=[If(test=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='eval_ctx', ctx=Load()), attr='volatile', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[Constant(value='(Markup(concat('), FormattedValue(value=Attribute(value=Name(id='frame', ctx=Load()), attr='buffer', ctx=Load()), conversion=-1), Constant(value=')) if context.eval_ctx.autoescape else concat('), FormattedValue(value=Attribute(value=Name(id='frame', ctx=Load()), attr='buffer', ctx=Load()), conversion=-1), Constant(value='))')])], keywords=[]))], orelse=[If(test=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='eval_ctx', ctx=Load()), attr='autoescape', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[Constant(value='Markup(concat('), FormattedValue(value=Attribute(value=Name(id='frame', ctx=Load()), attr='buffer', ctx=Load()), conversion=-1), Constant(value='))')])], keywords=[]))], orelse=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[Constant(value='concat('), FormattedValue(value=Attribute(value=Name(id='frame', ctx=Load()), attr='buffer', ctx=Load()), conversion=-1), Constant(value=')')])], keywords=[]))])])])])], decorator_list=[Name(id='optimizeconst', ctx=Load())], returns=Constant(value=None)), FunctionDef(name='visit_Test', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Test', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='_filter_test_common', ctx=Load()), args=[Name(id='node', ctx=Load()), Name(id='frame', ctx=Load()), Constant(value=False)], keywords=[]))], body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='node', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[]))])], decorator_list=[Name(id='optimizeconst', ctx=Load())], returns=Constant(value=None)), FunctionDef(name='visit_CondExpr', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='CondExpr', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='frame', ctx=Store())], value=Call(func=Attribute(value=Name(id='frame', ctx=Load()), attr='soft', ctx=Load()), args=[], keywords=[])), FunctionDef(name='write_expr2', args=arguments(posonlyargs=[], args=[], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[If(test=Compare(left=Attribute(value=Name(id='node', ctx=Load()), attr='expr2', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='expr2', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Return()], orelse=[]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[Constant(value='cond_expr_undefined("the inline if-expression on '), FormattedValue(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='position', ctx=Load()), args=[Name(id='node', ctx=Load())], keywords=[]), conversion=-1), Constant(value=' evaluated to false and no else section was defined.")')])], keywords=[]))], decorator_list=[], returns=Constant(value=None)), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='(')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='expr1', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=' if ')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='test', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=' else ')], keywords=[])), Expr(value=Call(func=Name(id='write_expr2', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=')')], keywords=[]))], decorator_list=[Name(id='optimizeconst', ctx=Load())], returns=Constant(value=None)), FunctionDef(name='visit_Call', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Call', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load())), arg(arg='forward_caller', annotation=Name(id='bool', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[Constant(value=False)]), body=[If(test=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), attr='is_async', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='(await auto_await(')], keywords=[]))], orelse=[]), If(test=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), attr='sandboxed', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='environment.call(context, ')], keywords=[]))], orelse=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='context.call(')], keywords=[]))]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='node', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Assign(targets=[Name(id='extra_kwargs', ctx=Store())], value=IfExp(test=Name(id='forward_caller', ctx=Load()), body=Dict(keys=[Constant(value='caller')], values=[Constant(value='caller')]), orelse=Constant(value=None))), Assign(targets=[Name(id='loop_kwargs', ctx=Store())], value=IfExp(test=Attribute(value=Name(id='frame', ctx=Load()), attr='loop_frame', ctx=Load()), body=Dict(keys=[Constant(value='_loop_vars')], values=[Constant(value='_loop_vars')]), orelse=Dict(keys=[], values=[]))), Assign(targets=[Name(id='block_kwargs', ctx=Store())], value=IfExp(test=Attribute(value=Name(id='frame', ctx=Load()), attr='block_frame', ctx=Load()), body=Dict(keys=[Constant(value='_block_vars')], values=[Constant(value='_block_vars')]), orelse=Dict(keys=[], values=[]))), If(test=Name(id='extra_kwargs', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='extra_kwargs', ctx=Load()), attr='update', ctx=Load()), args=[Name(id='loop_kwargs', ctx=Load())], keywords=[keyword(value=Name(id='block_kwargs', ctx=Load()))]))], orelse=[If(test=BoolOp(op=Or(), values=[Name(id='loop_kwargs', ctx=Load()), Name(id='block_kwargs', ctx=Load())]), body=[Assign(targets=[Name(id='extra_kwargs', ctx=Store())], value=Call(func=Name(id='dict', ctx=Load()), args=[Name(id='loop_kwargs', ctx=Load())], keywords=[keyword(value=Name(id='block_kwargs', ctx=Load()))]))], orelse=[])]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='signature', ctx=Load()), args=[Name(id='node', ctx=Load()), Name(id='frame', ctx=Load()), Name(id='extra_kwargs', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=')')], keywords=[])), If(test=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='environment', ctx=Load()), attr='is_async', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='))')], keywords=[]))], orelse=[])], decorator_list=[Name(id='optimizeconst', ctx=Load())], returns=Constant(value=None)), FunctionDef(name='visit_Keyword', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Keyword', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[BinOp(left=Attribute(value=Name(id='node', ctx=Load()), attr='key', ctx=Load()), op=Add(), right=Constant(value='='))], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='value', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_MarkSafe', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='MarkSafe', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='Markup(')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='expr', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=')')], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_MarkSafeIfAutoescape', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='MarkSafeIfAutoescape', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='(Markup if context.eval_ctx.autoescape else identity)(')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='expr', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value=')')], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_EnvironmentAttribute', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='EnvironmentAttribute', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[BinOp(left=Constant(value='environment.'), op=Add(), right=Attribute(value=Name(id='node', ctx=Load()), attr='name', ctx=Load()))], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_ExtensionAttribute', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='ExtensionAttribute', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[JoinedStr(values=[Constant(value='environment.extensions['), FormattedValue(value=Attribute(value=Name(id='node', ctx=Load()), attr='identifier', ctx=Load()), conversion=114), Constant(value='].'), FormattedValue(value=Attribute(value=Name(id='node', ctx=Load()), attr='name', ctx=Load()), conversion=-1)])], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_ImportedName', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='ImportedName', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Subscript(value=Attribute(value=Name(id='self', ctx=Load()), attr='import_aliases', ctx=Load()), slice=Attribute(value=Name(id='node', ctx=Load()), attr='importname', ctx=Load()), ctx=Load())], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_InternalName', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='InternalName', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='name', ctx=Load())], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_ContextReference', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='ContextReference', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Constant(value='context')], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_DerivedContextReference', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='DerivedContextReference', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='write', ctx=Load()), args=[Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='derive_context', ctx=Load()), args=[Name(id='frame', ctx=Load())], keywords=[])], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_Continue', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Continue', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='continue'), Name(id='node', ctx=Load())], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_Break', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Break', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[Constant(value='break'), Name(id='node', ctx=Load())], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_Scope', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='Scope', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='scope_frame', ctx=Store())], value=Call(func=Attribute(value=Name(id='frame', ctx=Load()), attr='inner', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='scope_frame', ctx=Load()), attr='symbols', ctx=Load()), attr='analyze_node', ctx=Load()), args=[Name(id='node', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='enter_frame', ctx=Load()), args=[Name(id='scope_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='blockvisit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='body', ctx=Load()), Name(id='scope_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='leave_frame', ctx=Load()), args=[Name(id='scope_frame', ctx=Load())], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_OverlayScope', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='OverlayScope', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='ctx', ctx=Store())], value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='temporary_identifier', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Name(id='ctx', ctx=Load()), conversion=-1), Constant(value=' = '), FormattedValue(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='derive_context', ctx=Load()), args=[Name(id='frame', ctx=Load())], keywords=[]), conversion=-1)])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Name(id='ctx', ctx=Load()), conversion=-1), Constant(value='.vars = ')])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='context', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='push_context_reference', ctx=Load()), args=[Name(id='ctx', ctx=Load())], keywords=[])), Assign(targets=[Name(id='scope_frame', ctx=Store())], value=Call(func=Attribute(value=Name(id='frame', ctx=Load()), attr='inner', ctx=Load()), args=[], keywords=[keyword(arg='isolated', value=Constant(value=True))])), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='scope_frame', ctx=Load()), attr='symbols', ctx=Load()), attr='analyze_node', ctx=Load()), args=[Name(id='node', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='enter_frame', ctx=Load()), args=[Name(id='scope_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='blockvisit', ctx=Load()), args=[Attribute(value=Name(id='node', ctx=Load()), attr='body', ctx=Load()), Name(id='scope_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='leave_frame', ctx=Load()), args=[Name(id='scope_frame', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='pop_context_reference', ctx=Load()), args=[], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_EvalContextModifier', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='EvalContextModifier', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[For(target=Name(id='keyword', ctx=Store()), iter=Attribute(value=Name(id='node', ctx=Load()), attr='options', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='context.eval_ctx.'), FormattedValue(value=Attribute(value=Name(id='keyword', ctx=Load()), attr='key', ctx=Load()), conversion=-1), Constant(value=' = ')])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Attribute(value=Name(id='keyword', ctx=Load()), attr='value', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), Try(body=[Assign(targets=[Name(id='val', ctx=Store())], value=Call(func=Attribute(value=Attribute(value=Name(id='keyword', ctx=Load()), attr='value', ctx=Load()), attr='as_const', ctx=Load()), args=[Attribute(value=Name(id='frame', ctx=Load()), attr='eval_ctx', ctx=Load())], keywords=[]))], handlers=[ExceptHandler(type=Attribute(value=Name(id='nodes', ctx=Load()), attr='Impossible', ctx=Load()), body=[Assign(targets=[Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='eval_ctx', ctx=Load()), attr='volatile', ctx=Store())], value=Constant(value=True))])], orelse=[Expr(value=Call(func=Name(id='setattr', ctx=Load()), args=[Attribute(value=Name(id='frame', ctx=Load()), attr='eval_ctx', ctx=Load()), Attribute(value=Name(id='keyword', ctx=Load()), attr='key', ctx=Load()), Name(id='val', ctx=Load())], keywords=[]))], finalbody=[])], orelse=[])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='visit_ScopedEvalContextModifier', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='node', annotation=Attribute(value=Name(id='nodes', ctx=Load()), attr='ScopedEvalContextModifier', ctx=Load())), arg(arg='frame', annotation=Name(id='Frame', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='old_ctx_name', ctx=Store())], value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='temporary_identifier', ctx=Load()), args=[], keywords=[])), Assign(targets=[Name(id='saved_ctx', ctx=Store())], value=Call(func=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='eval_ctx', ctx=Load()), attr='save', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[FormattedValue(value=Name(id='old_ctx_name', ctx=Load()), conversion=-1), Constant(value=' = context.eval_ctx.save()')])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit_EvalContextModifier', ctx=Load()), args=[Name(id='node', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[])), For(target=Name(id='child', ctx=Store()), iter=Attribute(value=Name(id='node', ctx=Load()), attr='body', ctx=Load()), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='visit', ctx=Load()), args=[Name(id='child', ctx=Load()), Name(id='frame', ctx=Load())], keywords=[]))], orelse=[]), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='frame', ctx=Load()), attr='eval_ctx', ctx=Load()), attr='revert', ctx=Load()), args=[Name(id='saved_ctx', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='writeline', ctx=Load()), args=[JoinedStr(values=[Constant(value='context.eval_ctx.revert('), FormattedValue(value=Name(id='old_ctx_name', ctx=Load()), conversion=-1), Constant(value=')')])], keywords=[]))], decorator_list=[], returns=Constant(value=None))], decorator_list=[])], type_ignores=[])