Module(body=[Expr(value=Constant(value='\nSearch operations.\n\nFor the key bindings implementation with attached filters, check\n`prompt_toolkit.key_binding.bindings.search`. (Use these for new key bindings\ninstead of calling these function directly.)\n')), ImportFrom(module='__future__', names=[alias(name='annotations')], level=0), ImportFrom(module='enum', names=[alias(name='Enum')], level=0), ImportFrom(module='typing', names=[alias(name='TYPE_CHECKING')], level=0), ImportFrom(module='application.current', names=[alias(name='get_app')], level=1), ImportFrom(module='filters', names=[alias(name='FilterOrBool'), alias(name='is_searching'), alias(name='to_filter')], level=1), ImportFrom(module='key_binding.vi_state', names=[alias(name='InputMode')], level=1), If(test=Name(id='TYPE_CHECKING', ctx=Load()), body=[ImportFrom(module='prompt_toolkit.layout.controls', names=[alias(name='BufferControl'), alias(name='SearchBufferControl')], level=0), ImportFrom(module='prompt_toolkit.layout.layout', names=[alias(name='Layout')], level=0)], orelse=[]), Assign(targets=[Name(id='__all__', ctx=Store())], value=List(elts=[Constant(value='SearchDirection'), Constant(value='start_search'), Constant(value='stop_search')], ctx=Load())), ClassDef(name='SearchDirection', bases=[Name(id='Enum', ctx=Load())], keywords=[], body=[Assign(targets=[Name(id='FORWARD', ctx=Store())], value=Constant(value='FORWARD')), Assign(targets=[Name(id='BACKWARD', ctx=Store())], value=Constant(value='BACKWARD'))], decorator_list=[]), ClassDef(name='SearchState', bases=[], keywords=[], body=[Expr(value=Constant(value="\n    A search 'query', associated with a search field (like a SearchToolbar).\n\n    Every searchable `BufferControl` points to a `search_buffer_control`\n    (another `BufferControls`) which represents the search field. The\n    `SearchState` attached to that search field is used for storing the current\n    search query.\n\n    It is possible to have one searchfield for multiple `BufferControls`. In\n    that case, they'll share the same `SearchState`.\n    If there are multiple `BufferControls` that display the same `Buffer`, then\n    they can have a different `SearchState` each (if they have a different\n    search control).\n    ")), Assign(targets=[Name(id='__slots__', ctx=Store())], value=Tuple(elts=[Constant(value='text'), Constant(value='direction'), Constant(value='ignore_case')], ctx=Load())), FunctionDef(name='__init__', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='text', annotation=Name(id='str', ctx=Load())), arg(arg='direction', annotation=Name(id='SearchDirection', ctx=Load())), arg(arg='ignore_case', annotation=Name(id='FilterOrBool', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[Constant(value=''), Attribute(value=Name(id='SearchDirection', ctx=Load()), attr='FORWARD', ctx=Load()), Constant(value=False)]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='text', ctx=Store())], value=Name(id='text', ctx=Load())), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='direction', ctx=Store())], value=Name(id='direction', ctx=Load())), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='ignore_case', ctx=Store())], value=Call(func=Name(id='to_filter', ctx=Load()), args=[Name(id='ignore_case', ctx=Load())], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='__repr__', args=arguments(posonlyargs=[], args=[arg(arg='self')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Return(value=Call(func=Attribute(value=Constant(value='{}({!r}, direction={!r}, ignore_case={!r})'), attr='format', ctx=Load()), args=[Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='__class__', ctx=Load()), attr='__name__', ctx=Load()), Attribute(value=Name(id='self', ctx=Load()), attr='text', ctx=Load()), Attribute(value=Name(id='self', ctx=Load()), attr='direction', ctx=Load()), Attribute(value=Name(id='self', ctx=Load()), attr='ignore_case', ctx=Load())], keywords=[]))], decorator_list=[], returns=Name(id='str', ctx=Load())), FunctionDef(name='__invert__', args=arguments(posonlyargs=[], args=[arg(arg='self')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='\n        Create a new SearchState where backwards becomes forwards and the other\n        way around.\n        ')), If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load()), attr='direction', ctx=Load()), ops=[Eq()], comparators=[Attribute(value=Name(id='SearchDirection', ctx=Load()), attr='BACKWARD', ctx=Load())]), body=[Assign(targets=[Name(id='direction', ctx=Store())], value=Attribute(value=Name(id='SearchDirection', ctx=Load()), attr='FORWARD', ctx=Load()))], orelse=[Assign(targets=[Name(id='direction', ctx=Store())], value=Attribute(value=Name(id='SearchDirection', ctx=Load()), attr='BACKWARD', ctx=Load()))]), Return(value=Call(func=Name(id='SearchState', ctx=Load()), args=[], keywords=[keyword(arg='text', value=Attribute(value=Name(id='self', ctx=Load()), attr='text', ctx=Load())), keyword(arg='direction', value=Name(id='direction', ctx=Load())), keyword(arg='ignore_case', value=Attribute(value=Name(id='self', ctx=Load()), attr='ignore_case', ctx=Load()))]))], decorator_list=[], returns=Name(id='SearchState', ctx=Load()))], decorator_list=[]), FunctionDef(name='start_search', args=arguments(posonlyargs=[], args=[arg(arg='buffer_control', annotation=BinOp(left=Name(id='BufferControl', ctx=Load()), op=BitOr(), right=Constant(value=None))), arg(arg='direction', annotation=Name(id='SearchDirection', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[Constant(value=None), Attribute(value=Name(id='SearchDirection', ctx=Load()), attr='FORWARD', ctx=Load())]), body=[Expr(value=Constant(value='\n    Start search through the given `buffer_control` using the\n    `search_buffer_control`.\n\n    :param buffer_control: Start search for this `BufferControl`. If not given,\n        search through the current control.\n    ')), ImportFrom(module='prompt_toolkit.layout.controls', names=[alias(name='BufferControl')], level=0), Assert(test=BoolOp(op=Or(), values=[Compare(left=Name(id='buffer_control', ctx=Load()), ops=[Is()], comparators=[Constant(value=None)]), Call(func=Name(id='isinstance', ctx=Load()), args=[Name(id='buffer_control', ctx=Load()), Name(id='BufferControl', ctx=Load())], keywords=[])])), Assign(targets=[Name(id='layout', ctx=Store())], value=Attribute(value=Call(func=Name(id='get_app', ctx=Load()), args=[], keywords=[]), attr='layout', ctx=Load())), If(test=Compare(left=Name(id='buffer_control', ctx=Load()), ops=[Is()], comparators=[Constant(value=None)]), body=[If(test=UnaryOp(op=Not(), operand=Call(func=Name(id='isinstance', ctx=Load()), args=[Attribute(value=Name(id='layout', ctx=Load()), attr='current_control', ctx=Load()), Name(id='BufferControl', ctx=Load())], keywords=[])), body=[Return()], orelse=[]), Assign(targets=[Name(id='buffer_control', ctx=Store())], value=Attribute(value=Name(id='layout', ctx=Load()), attr='current_control', ctx=Load()))], orelse=[]), Assign(targets=[Name(id='search_buffer_control', ctx=Store())], value=Attribute(value=Name(id='buffer_control', ctx=Load()), attr='search_buffer_control', ctx=Load())), If(test=Name(id='search_buffer_control', ctx=Load()), body=[Assign(targets=[Attribute(value=Attribute(value=Name(id='buffer_control', ctx=Load()), attr='search_state', ctx=Load()), attr='direction', ctx=Store())], value=Name(id='direction', ctx=Load())), Expr(value=Call(func=Attribute(value=Name(id='layout', ctx=Load()), attr='focus', ctx=Load()), args=[Name(id='search_buffer_control', ctx=Load())], keywords=[])), Assign(targets=[Subscript(value=Attribute(value=Name(id='layout', ctx=Load()), attr='search_links', ctx=Load()), slice=Name(id='search_buffer_control', ctx=Load()), ctx=Store())], value=Name(id='buffer_control', ctx=Load())), Assign(targets=[Attribute(value=Attribute(value=Call(func=Name(id='get_app', ctx=Load()), args=[], keywords=[]), attr='vi_state', ctx=Load()), attr='input_mode', ctx=Store())], value=Attribute(value=Name(id='InputMode', ctx=Load()), attr='INSERT', ctx=Load()))], orelse=[])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='stop_search', args=arguments(posonlyargs=[], args=[arg(arg='buffer_control', annotation=BinOp(left=Name(id='BufferControl', ctx=Load()), op=BitOr(), right=Constant(value=None)))], kwonlyargs=[], kw_defaults=[], defaults=[Constant(value=None)]), body=[Expr(value=Constant(value='\n    Stop search through the given `buffer_control`.\n    ')), Assign(targets=[Name(id='layout', ctx=Store())], value=Attribute(value=Call(func=Name(id='get_app', ctx=Load()), args=[], keywords=[]), attr='layout', ctx=Load())), If(test=Compare(left=Name(id='buffer_control', ctx=Load()), ops=[Is()], comparators=[Constant(value=None)]), body=[Assign(targets=[Name(id='buffer_control', ctx=Store())], value=Attribute(value=Name(id='layout', ctx=Load()), attr='search_target_buffer_control', ctx=Load())), If(test=Compare(left=Name(id='buffer_control', ctx=Load()), ops=[Is()], comparators=[Constant(value=None)]), body=[Return()], orelse=[]), Assign(targets=[Name(id='search_buffer_control', ctx=Store())], value=Attribute(value=Name(id='buffer_control', ctx=Load()), attr='search_buffer_control', ctx=Load()))], orelse=[Assert(test=Compare(left=Name(id='buffer_control', ctx=Load()), ops=[In()], comparators=[Call(func=Attribute(value=Attribute(value=Name(id='layout', ctx=Load()), attr='search_links', ctx=Load()), attr='values', ctx=Load()), args=[], keywords=[])])), Assign(targets=[Name(id='search_buffer_control', ctx=Store())], value=Subscript(value=Call(func=Name(id='_get_reverse_search_links', ctx=Load()), args=[Name(id='layout', ctx=Load())], keywords=[]), slice=Name(id='buffer_control', ctx=Load()), ctx=Load()))]), Expr(value=Call(func=Attribute(value=Name(id='layout', ctx=Load()), attr='focus', ctx=Load()), args=[Name(id='buffer_control', ctx=Load())], keywords=[])), If(test=Compare(left=Name(id='search_buffer_control', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[Delete(targets=[Subscript(value=Attribute(value=Name(id='layout', ctx=Load()), attr='search_links', ctx=Load()), slice=Name(id='search_buffer_control', ctx=Load()), ctx=Del())]), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='search_buffer_control', ctx=Load()), attr='buffer', ctx=Load()), attr='reset', ctx=Load()), args=[], keywords=[]))], orelse=[]), Assign(targets=[Attribute(value=Attribute(value=Call(func=Name(id='get_app', ctx=Load()), args=[], keywords=[]), attr='vi_state', ctx=Load()), attr='input_mode', ctx=Store())], value=Attribute(value=Name(id='InputMode', ctx=Load()), attr='NAVIGATION', ctx=Load()))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='do_incremental_search', args=arguments(posonlyargs=[], args=[arg(arg='direction', annotation=Name(id='SearchDirection', ctx=Load())), arg(arg='count', annotation=Name(id='int', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[Constant(value=1)]), body=[Expr(value=Constant(value='\n    Apply search, but keep search buffer focused.\n    ')), Assert(test=Call(func=Name(id='is_searching', ctx=Load()), args=[], keywords=[])), Assign(targets=[Name(id='layout', ctx=Store())], value=Attribute(value=Call(func=Name(id='get_app', ctx=Load()), args=[], keywords=[]), attr='layout', ctx=Load())), ImportFrom(module='prompt_toolkit.layout.controls', names=[alias(name='BufferControl')], level=0), Assign(targets=[Name(id='search_control', ctx=Store())], value=Attribute(value=Name(id='layout', ctx=Load()), attr='current_control', ctx=Load())), If(test=UnaryOp(op=Not(), operand=Call(func=Name(id='isinstance', ctx=Load()), args=[Name(id='search_control', ctx=Load()), Name(id='BufferControl', ctx=Load())], keywords=[])), body=[Return()], orelse=[]), Assign(targets=[Name(id='prev_control', ctx=Store())], value=Attribute(value=Name(id='layout', ctx=Load()), attr='search_target_buffer_control', ctx=Load())), If(test=Compare(left=Name(id='prev_control', ctx=Load()), ops=[Is()], comparators=[Constant(value=None)]), body=[Return()], orelse=[]), Assign(targets=[Name(id='search_state', ctx=Store())], value=Attribute(value=Name(id='prev_control', ctx=Load()), attr='search_state', ctx=Load())), Assign(targets=[Name(id='direction_changed', ctx=Store())], value=Compare(left=Attribute(value=Name(id='search_state', ctx=Load()), attr='direction', ctx=Load()), ops=[NotEq()], comparators=[Name(id='direction', ctx=Load())])), Assign(targets=[Attribute(value=Name(id='search_state', ctx=Load()), attr='text', ctx=Store())], value=Attribute(value=Attribute(value=Name(id='search_control', ctx=Load()), attr='buffer', ctx=Load()), attr='text', ctx=Load())), Assign(targets=[Attribute(value=Name(id='search_state', ctx=Load()), attr='direction', ctx=Store())], value=Name(id='direction', ctx=Load())), If(test=UnaryOp(op=Not(), operand=Name(id='direction_changed', ctx=Load())), body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='prev_control', ctx=Load()), attr='buffer', ctx=Load()), attr='apply_search', ctx=Load()), args=[Name(id='search_state', ctx=Load())], keywords=[keyword(arg='include_current_position', value=Constant(value=False)), keyword(arg='count', value=Name(id='count', ctx=Load()))]))], orelse=[])], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='accept_search', args=arguments(posonlyargs=[], args=[], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='\n    Accept current search query. Focus original `BufferControl` again.\n    ')), Assign(targets=[Name(id='layout', ctx=Store())], value=Attribute(value=Call(func=Name(id='get_app', ctx=Load()), args=[], keywords=[]), attr='layout', ctx=Load())), Assign(targets=[Name(id='search_control', ctx=Store())], value=Attribute(value=Name(id='layout', ctx=Load()), attr='current_control', ctx=Load())), Assign(targets=[Name(id='target_buffer_control', ctx=Store())], value=Attribute(value=Name(id='layout', ctx=Load()), attr='search_target_buffer_control', ctx=Load())), ImportFrom(module='prompt_toolkit.layout.controls', names=[alias(name='BufferControl')], level=0), If(test=UnaryOp(op=Not(), operand=Call(func=Name(id='isinstance', ctx=Load()), args=[Name(id='search_control', ctx=Load()), Name(id='BufferControl', ctx=Load())], keywords=[])), body=[Return()], orelse=[]), If(test=Compare(left=Name(id='target_buffer_control', ctx=Load()), ops=[Is()], comparators=[Constant(value=None)]), body=[Return()], orelse=[]), Assign(targets=[Name(id='search_state', ctx=Store())], value=Attribute(value=Name(id='target_buffer_control', ctx=Load()), attr='search_state', ctx=Load())), If(test=Attribute(value=Attribute(value=Name(id='search_control', ctx=Load()), attr='buffer', ctx=Load()), attr='text', ctx=Load()), body=[Assign(targets=[Attribute(value=Name(id='search_state', ctx=Load()), attr='text', ctx=Store())], value=Attribute(value=Attribute(value=Name(id='search_control', ctx=Load()), attr='buffer', ctx=Load()), attr='text', ctx=Load()))], orelse=[]), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='target_buffer_control', ctx=Load()), attr='buffer', ctx=Load()), attr='apply_search', ctx=Load()), args=[Name(id='search_state', ctx=Load())], keywords=[keyword(arg='include_current_position', value=Constant(value=True))])), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='search_control', ctx=Load()), attr='buffer', ctx=Load()), attr='append_to_history', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Name(id='stop_search', ctx=Load()), args=[Name(id='target_buffer_control', ctx=Load())], keywords=[]))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='_get_reverse_search_links', args=arguments(posonlyargs=[], args=[arg(arg='layout', annotation=Name(id='Layout', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='\n    Return mapping from BufferControl to SearchBufferControl.\n    ')), Return(value=DictComp(key=Name(id='buffer_control', ctx=Load()), value=Name(id='search_buffer_control', ctx=Load()), generators=[comprehension(target=Tuple(elts=[Name(id='search_buffer_control', ctx=Store()), Name(id='buffer_control', ctx=Store())], ctx=Store()), iter=Call(func=Attribute(value=Attribute(value=Name(id='layout', ctx=Load()), attr='search_links', ctx=Load()), attr='items', ctx=Load()), args=[], keywords=[]), ifs=[], is_async=0)]))], decorator_list=[], returns=Subscript(value=Name(id='dict', ctx=Load()), slice=Tuple(elts=[Name(id='BufferControl', ctx=Load()), Name(id='SearchBufferControl', ctx=Load())], ctx=Load()), ctx=Load()))], type_ignores=[])