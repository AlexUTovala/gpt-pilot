Module(body=[ImportFrom(module='functools', names=[alias(name='wraps')], level=0), Import(names=[alias(name='logging')]), Assign(targets=[Name(id='logger', ctx=Store())], value=Call(func=Attribute(value=Name(id='logging', ctx=Load()), attr='getLogger', ctx=Load()), args=[Constant(value='peewee')], keywords=[])), ClassDef(name='_QueryLogHandler', bases=[Attribute(value=Name(id='logging', ctx=Load()), attr='Handler', ctx=Load())], keywords=[], body=[FunctionDef(name='__init__', args=arguments(posonlyargs=[], args=[arg(arg='self')], vararg=arg(arg='args'), kwonlyargs=[], kw_defaults=[], kwarg=arg(arg='kwargs'), defaults=[]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='queries', ctx=Store())], value=List(elts=[], ctx=Load())), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='logging', ctx=Load()), attr='Handler', ctx=Load()), attr='__init__', ctx=Load()), args=[Name(id='self', ctx=Load()), Starred(value=Name(id='args', ctx=Load()), ctx=Load())], keywords=[keyword(value=Name(id='kwargs', ctx=Load()))]))], decorator_list=[]), FunctionDef(name='emit', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='record')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[If(test=Compare(left=Attribute(value=Name(id='record', ctx=Load()), attr='name', ctx=Load()), ops=[Eq()], comparators=[Constant(value='peewee')]), body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='queries', ctx=Load()), attr='append', ctx=Load()), args=[Name(id='record', ctx=Load())], keywords=[]))], orelse=[])], decorator_list=[])], decorator_list=[]), ClassDef(name='count_queries', bases=[Name(id='object', ctx=Load())], keywords=[], body=[FunctionDef(name='__init__', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='only_select')], kwonlyargs=[], kw_defaults=[], defaults=[Constant(value=False)]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='only_select', ctx=Store())], value=Name(id='only_select', ctx=Load())), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='count', ctx=Store())], value=Constant(value=0))], decorator_list=[]), FunctionDef(name='get_queries', args=arguments(posonlyargs=[], args=[arg(arg='self')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Return(value=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='_handler', ctx=Load()), attr='queries', ctx=Load()))], decorator_list=[]), FunctionDef(name='__enter__', args=arguments(posonlyargs=[], args=[arg(arg='self')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='_handler', ctx=Store())], value=Call(func=Name(id='_QueryLogHandler', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load()), attr='setLevel', ctx=Load()), args=[Attribute(value=Name(id='logging', ctx=Load()), attr='DEBUG', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load()), attr='addHandler', ctx=Load()), args=[Attribute(value=Name(id='self', ctx=Load()), attr='_handler', ctx=Load())], keywords=[])), Return(value=Name(id='self', ctx=Load()))], decorator_list=[]), FunctionDef(name='__exit__', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='exc_type'), arg(arg='exc_val'), arg(arg='exc_tb')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load()), attr='removeHandler', ctx=Load()), args=[Attribute(value=Name(id='self', ctx=Load()), attr='_handler', ctx=Load())], keywords=[])), If(test=Attribute(value=Name(id='self', ctx=Load()), attr='only_select', ctx=Load()), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='count', ctx=Store())], value=Call(func=Name(id='len', ctx=Load()), args=[ListComp(elt=Name(id='q', ctx=Load()), generators=[comprehension(target=Name(id='q', ctx=Store()), iter=Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='_handler', ctx=Load()), attr='queries', ctx=Load()), ifs=[Call(func=Attribute(value=Subscript(value=Attribute(value=Name(id='q', ctx=Load()), attr='msg', ctx=Load()), slice=Constant(value=0), ctx=Load()), attr='startswith', ctx=Load()), args=[Constant(value='SELECT ')], keywords=[])], is_async=0)])], keywords=[]))], orelse=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='count', ctx=Store())], value=Call(func=Name(id='len', ctx=Load()), args=[Attribute(value=Attribute(value=Name(id='self', ctx=Load()), attr='_handler', ctx=Load()), attr='queries', ctx=Load())], keywords=[]))])], decorator_list=[])], decorator_list=[]), ClassDef(name='assert_query_count', bases=[Name(id='count_queries', ctx=Load())], keywords=[], body=[FunctionDef(name='__init__', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='expected'), arg(arg='only_select')], kwonlyargs=[], kw_defaults=[], defaults=[Constant(value=False)]), body=[Expr(value=Call(func=Attribute(value=Call(func=Name(id='super', ctx=Load()), args=[Name(id='assert_query_count', ctx=Load()), Name(id='self', ctx=Load())], keywords=[]), attr='__init__', ctx=Load()), args=[], keywords=[keyword(arg='only_select', value=Name(id='only_select', ctx=Load()))])), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='expected', ctx=Store())], value=Name(id='expected', ctx=Load()))], decorator_list=[]), FunctionDef(name='__call__', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='f')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[FunctionDef(name='decorated', args=arguments(posonlyargs=[], args=[], vararg=arg(arg='args'), kwonlyargs=[], kw_defaults=[], kwarg=arg(arg='kwds'), defaults=[]), body=[With(items=[withitem(context_expr=Name(id='self', ctx=Load()))], body=[Assign(targets=[Name(id='ret', ctx=Store())], value=Call(func=Name(id='f', ctx=Load()), args=[Starred(value=Name(id='args', ctx=Load()), ctx=Load())], keywords=[keyword(value=Name(id='kwds', ctx=Load()))]))]), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='_assert_count', ctx=Load()), args=[], keywords=[])), Return(value=Name(id='ret', ctx=Load()))], decorator_list=[Call(func=Name(id='wraps', ctx=Load()), args=[Name(id='f', ctx=Load())], keywords=[])]), Return(value=Name(id='decorated', ctx=Load()))], decorator_list=[]), FunctionDef(name='_assert_count', args=arguments(posonlyargs=[], args=[arg(arg='self')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='error_msg', ctx=Store())], value=BinOp(left=Constant(value='%s != %s'), op=Mod(), right=Tuple(elts=[Attribute(value=Name(id='self', ctx=Load()), attr='count', ctx=Load()), Attribute(value=Name(id='self', ctx=Load()), attr='expected', ctx=Load())], ctx=Load()))), Assert(test=Compare(left=Attribute(value=Name(id='self', ctx=Load()), attr='count', ctx=Load()), ops=[Eq()], comparators=[Attribute(value=Name(id='self', ctx=Load()), attr='expected', ctx=Load())]), msg=Name(id='error_msg', ctx=Load()))], decorator_list=[]), FunctionDef(name='__exit__', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='exc_type'), arg(arg='exc_val'), arg(arg='exc_tb')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Call(func=Name(id='super', ctx=Load()), args=[Name(id='assert_query_count', ctx=Load()), Name(id='self', ctx=Load())], keywords=[]), attr='__exit__', ctx=Load()), args=[Name(id='exc_type', ctx=Load()), Name(id='exc_val', ctx=Load()), Name(id='exc_tb', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load()), attr='_assert_count', ctx=Load()), args=[], keywords=[]))], decorator_list=[])], decorator_list=[])], type_ignores=[])