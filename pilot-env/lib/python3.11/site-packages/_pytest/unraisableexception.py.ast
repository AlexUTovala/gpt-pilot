Module(body=[Import(names=[alias(name='sys')]), Import(names=[alias(name='traceback')]), Import(names=[alias(name='warnings')]), ImportFrom(module='types', names=[alias(name='TracebackType')], level=0), ImportFrom(module='typing', names=[alias(name='Any')], level=0), ImportFrom(module='typing', names=[alias(name='Callable')], level=0), ImportFrom(module='typing', names=[alias(name='Generator')], level=0), ImportFrom(module='typing', names=[alias(name='Optional')], level=0), ImportFrom(module='typing', names=[alias(name='Type')], level=0), Import(names=[alias(name='pytest')]), ClassDef(name='catch_unraisable_exception', bases=[], keywords=[], body=[Expr(value=Constant(value='Context manager catching unraisable exception using sys.unraisablehook.\n\n    Storing the exception value (cm.unraisable.exc_value) creates a reference\n    cycle. The reference cycle is broken explicitly when the context manager\n    exits.\n\n    Storing the object (cm.unraisable.object) can resurrect it if it is set to\n    an object which is being finalized. Exiting the context manager clears the\n    stored object.\n\n    Usage:\n        with catch_unraisable_exception() as cm:\n            # code creating an "unraisable exception"\n            ...\n            # check the unraisable exception: use cm.unraisable\n            ...\n        # cm.unraisable attribute no longer exists at this point\n        # (to break a reference cycle)\n    ')), FunctionDef(name='__init__', args=arguments(posonlyargs=[], args=[arg(arg='self')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[AnnAssign(target=Attribute(value=Name(id='self', ctx=Load()), attr='unraisable', ctx=Store()), annotation=Subscript(value=Name(id='Optional', ctx=Load()), slice=Constant(value='sys.UnraisableHookArgs'), ctx=Load()), value=Constant(value=None), simple=0), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load()), attr='_old_hook', ctx=Store()), annotation=Subscript(value=Name(id='Optional', ctx=Load()), slice=Subscript(value=Name(id='Callable', ctx=Load()), slice=Tuple(elts=[List(elts=[Constant(value='sys.UnraisableHookArgs')], ctx=Load()), Name(id='Any', ctx=Load())], ctx=Load()), ctx=Load()), ctx=Load()), value=Constant(value=None), simple=0)], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='_hook', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='unraisable', annotation=Constant(value='sys.UnraisableHookArgs'))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='unraisable', ctx=Store())], value=Name(id='unraisable', ctx=Load()))], decorator_list=[], returns=Constant(value=None)), FunctionDef(name='__enter__', args=arguments(posonlyargs=[], args=[arg(arg='self')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='_old_hook', ctx=Store())], value=Attribute(value=Name(id='sys', ctx=Load()), attr='unraisablehook', ctx=Load())), Assign(targets=[Attribute(value=Name(id='sys', ctx=Load()), attr='unraisablehook', ctx=Store())], value=Attribute(value=Name(id='self', ctx=Load()), attr='_hook', ctx=Load())), Return(value=Name(id='self', ctx=Load()))], decorator_list=[], returns=Constant(value='catch_unraisable_exception')), FunctionDef(name='__exit__', args=arguments(posonlyargs=[], args=[arg(arg='self'), arg(arg='exc_type', annotation=Subscript(value=Name(id='Optional', ctx=Load()), slice=Subscript(value=Name(id='Type', ctx=Load()), slice=Name(id='BaseException', ctx=Load()), ctx=Load()), ctx=Load())), arg(arg='exc_val', annotation=Subscript(value=Name(id='Optional', ctx=Load()), slice=Name(id='BaseException', ctx=Load()), ctx=Load())), arg(arg='exc_tb', annotation=Subscript(value=Name(id='Optional', ctx=Load()), slice=Name(id='TracebackType', ctx=Load()), ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assert(test=Compare(left=Attribute(value=Name(id='self', ctx=Load()), attr='_old_hook', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)])), Assign(targets=[Attribute(value=Name(id='sys', ctx=Load()), attr='unraisablehook', ctx=Store())], value=Attribute(value=Name(id='self', ctx=Load()), attr='_old_hook', ctx=Load())), Assign(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='_old_hook', ctx=Store())], value=Constant(value=None)), Delete(targets=[Attribute(value=Name(id='self', ctx=Load()), attr='unraisable', ctx=Del())])], decorator_list=[], returns=Constant(value=None))], decorator_list=[]), FunctionDef(name='unraisable_exception_runtest_hook', args=arguments(posonlyargs=[], args=[], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[With(items=[withitem(context_expr=Call(func=Name(id='catch_unraisable_exception', ctx=Load()), args=[], keywords=[]), optional_vars=Name(id='cm', ctx=Store()))], body=[Expr(value=Yield()), If(test=Attribute(value=Name(id='cm', ctx=Load()), attr='unraisable', ctx=Load()), body=[If(test=Compare(left=Attribute(value=Attribute(value=Name(id='cm', ctx=Load()), attr='unraisable', ctx=Load()), attr='err_msg', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[Assign(targets=[Name(id='err_msg', ctx=Store())], value=Attribute(value=Attribute(value=Name(id='cm', ctx=Load()), attr='unraisable', ctx=Load()), attr='err_msg', ctx=Load()))], orelse=[Assign(targets=[Name(id='err_msg', ctx=Store())], value=Constant(value='Exception ignored in'))]), Assign(targets=[Name(id='msg', ctx=Store())], value=JoinedStr(values=[FormattedValue(value=Name(id='err_msg', ctx=Load()), conversion=-1), Constant(value=': '), FormattedValue(value=Attribute(value=Attribute(value=Name(id='cm', ctx=Load()), attr='unraisable', ctx=Load()), attr='object', ctx=Load()), conversion=114), Constant(value='\n\n')])), AugAssign(target=Name(id='msg', ctx=Store()), op=Add(), value=Call(func=Attribute(value=Constant(value=''), attr='join', ctx=Load()), args=[Call(func=Attribute(value=Name(id='traceback', ctx=Load()), attr='format_exception', ctx=Load()), args=[Attribute(value=Attribute(value=Name(id='cm', ctx=Load()), attr='unraisable', ctx=Load()), attr='exc_type', ctx=Load()), Attribute(value=Attribute(value=Name(id='cm', ctx=Load()), attr='unraisable', ctx=Load()), attr='exc_value', ctx=Load()), Attribute(value=Attribute(value=Name(id='cm', ctx=Load()), attr='unraisable', ctx=Load()), attr='exc_traceback', ctx=Load())], keywords=[])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='warnings', ctx=Load()), attr='warn', ctx=Load()), args=[Call(func=Attribute(value=Name(id='pytest', ctx=Load()), attr='PytestUnraisableExceptionWarning', ctx=Load()), args=[Name(id='msg', ctx=Load())], keywords=[])], keywords=[]))], orelse=[])])], decorator_list=[], returns=Subscript(value=Name(id='Generator', ctx=Load()), slice=Tuple(elts=[Constant(value=None), Constant(value=None), Constant(value=None)], ctx=Load()), ctx=Load())), FunctionDef(name='pytest_runtest_setup', args=arguments(posonlyargs=[], args=[], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=YieldFrom(value=Call(func=Name(id='unraisable_exception_runtest_hook', ctx=Load()), args=[], keywords=[])))], decorator_list=[Call(func=Attribute(value=Name(id='pytest', ctx=Load()), attr='hookimpl', ctx=Load()), args=[], keywords=[keyword(arg='hookwrapper', value=Constant(value=True)), keyword(arg='tryfirst', value=Constant(value=True))])], returns=Subscript(value=Name(id='Generator', ctx=Load()), slice=Tuple(elts=[Constant(value=None), Constant(value=None), Constant(value=None)], ctx=Load()), ctx=Load())), FunctionDef(name='pytest_runtest_call', args=arguments(posonlyargs=[], args=[], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=YieldFrom(value=Call(func=Name(id='unraisable_exception_runtest_hook', ctx=Load()), args=[], keywords=[])))], decorator_list=[Call(func=Attribute(value=Name(id='pytest', ctx=Load()), attr='hookimpl', ctx=Load()), args=[], keywords=[keyword(arg='hookwrapper', value=Constant(value=True)), keyword(arg='tryfirst', value=Constant(value=True))])], returns=Subscript(value=Name(id='Generator', ctx=Load()), slice=Tuple(elts=[Constant(value=None), Constant(value=None), Constant(value=None)], ctx=Load()), ctx=Load())), FunctionDef(name='pytest_runtest_teardown', args=arguments(posonlyargs=[], args=[], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=YieldFrom(value=Call(func=Name(id='unraisable_exception_runtest_hook', ctx=Load()), args=[], keywords=[])))], decorator_list=[Call(func=Attribute(value=Name(id='pytest', ctx=Load()), attr='hookimpl', ctx=Load()), args=[], keywords=[keyword(arg='hookwrapper', value=Constant(value=True)), keyword(arg='tryfirst', value=Constant(value=True))])], returns=Subscript(value=Name(id='Generator', ctx=Load()), slice=Tuple(elts=[Constant(value=None), Constant(value=None), Constant(value=None)], ctx=Load()), ctx=Load()))], type_ignores=[])